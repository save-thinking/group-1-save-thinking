{"version":3,"file":"output.js","mappings":"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","sources":["webpack://group-1-save-thinking/./src/js/domain/account.js","webpack://group-1-save-thinking/./src/js/domain/exceptions.js","webpack://group-1-save-thinking/./src/js/domain/record.js","webpack://group-1-save-thinking/./src/js/storage/account.js","webpack://group-1-save-thinking/./src/js/storage/exceptions.js","webpack://group-1-save-thinking/./src/js/storage/idb.js","webpack://group-1-save-thinking/./src/js/storage/record.js","webpack://group-1-save-thinking/./src/js/storage/utils.js","webpack://group-1-save-thinking/./src/js/utils.js","webpack://group-1-save-thinking/./src/js/view/components.js","webpack://group-1-save-thinking/./src/js/view/dashboard.js","webpack://group-1-save-thinking/./src/js/view/records.js","webpack://group-1-save-thinking/./src/js/view/utility.js","webpack://group-1-save-thinking/./node_modules/dexie/dist/modern/dexie.mjs","webpack://group-1-save-thinking/webpack/bootstrap","webpack://group-1-save-thinking/webpack/runtime/define property getters","webpack://group-1-save-thinking/webpack/runtime/hasOwnProperty shorthand","webpack://group-1-save-thinking/webpack/runtime/make namespace object"],"sourcesContent":["/** Domain Service - Accounts\n @module domain/account\n */\n//  This processing js will act as an adapter between th view layer and storage layer of the app for new account creations.\n//  First, it checks that the information given from the View Layer is correct. If it is incorrect we throw a validation error.\n//  Second, if validation passes, we pass the new account information to the database where it saves this account and assigns it a database key.\n//  Third, if there was a problem storing the information, the database will throw a storing error. We will communicate this error to the user to reattempt the account creation.\n//  Fourth, if there were no validation/storage errors then the account must have been added correctly, so we pass this new account info, with its associated key, back to the view layer.\nimport * as accountStore from '../storage/account.js'\nimport { MissingFieldError, FormattingError } from './exceptions.js'\n\nconst FUND_EMOJI = {\n  'checking-account': '',\n  'savings-account': '',\n  'credit-card': '',\n  cash: ''\n}\n\n// /**\n//  * Our input is the data given from the New Account fields on the view layer. The input has the form:\n// const passedInfo = {\"name\":\"test account name\",\"account_type\":\"checking-account\",\"initial_balance\":\"12345\",\"currency\":\"USD\"}\n\n// First this function checks that the given JSON file has a valid amount, non-empty and a positive number.\n// If it doesn't, the validateNewAccount function will throw a Validation Error.\n// If it successfully validates, then we proceed to give the input to the storage layer.\n// If there is a problem in storage, then the addAccountInTable function will throw a Storage Error.\n// If we have no errors, then addAccountInTable() will return the newly added account with its key, in JSON format, which we then return.\n// */\n/**\n * An Account\n * @typedef {Object} Account\n * @property {string} id - Autogenerated ID\n * @property {date} created_at - Created Timestamp\n * @property {date} updated_at - Updated Timestamp\n * @property {string} source - Source of Account (USER)\n * @property {string} emoji - Account Emoji\n * @property {number} initial_balance - Initial Balance\n * @property {number} current_balance - Current Balance\n * @property {string} currency - Currency\n */\n/**\n * Validates input and calls Storage Service\n * @public\n * @function addAccount\n *\n * @param {Account} account\n * @returns {Account}\n */\n\nexport async function addAccount (account) {\n  validateNewAccount(account)\n  account.source = 'USER'\n  account.emoji = FUND_EMOJI[account.type]\n  account.initial_balance = Number(account.initial_balance)\n  account.current_balance = account.initial_balance\n  const result = await accountStore.storeAccount(account)\n  return result\n  // broadcast new record to all peers would be added here.\n}\n\n/**\n * Get all accounts\n * @function getAllUserAccounts\n * @returns {Array.Account}\n */\nexport async function getAllUserAccounts () {\n  const accounts = await accountStore\n    .getAccountMulti({ source: 'USER' })\n    .then((results) => results.toArray())\n  return accounts\n}\n\n/**\n * Get all accounts filtered using predicates\n * @function getAllAccounts\n * @param {Array.function} filter\n * @returns {Array.Account}\n */\nexport async function getAllAccounts (filter) {\n  const accounts = await accountStore\n    .getAccountMulti(filter)\n    .then((results) => results.toArray())\n  return accounts\n}\n\n/*\nWe assume here that the user is restricted from typing any non-number or decimal values into the initial balance field.\nThis is a hard lock out on the view layer. So the initial balance is always a string.\n */\n/**\n * Internal Method to validate input\n * @function validateNewAccount\n * @param {Account} account\n */\nfunction validateNewAccount (passedInfo) {\n  if (passedInfo.name === '') {\n    throw new MissingFieldError('Account Name')\n  }\n  if (passedInfo.initial_balance === '') {\n    throw new MissingFieldError('Initial Balance')\n  }\n  if (typeof passedInfo.name !== 'string') {\n    throw new FormattingError('Account Name')\n  }\n}\n","/** Domain Service - Exceptions\n @module domain/exceptions\n */\n/**\n * Validation Error\n * @class ValidationError\n */\nexport class ValidationError extends Error {\n  constructor (message) {\n    super(message)\n    this.name = 'ValidationError'\n  }\n}\n/**\n * MissingFieldError\n * @class MissingFieldError\n */\nexport class MissingFieldError extends ValidationError {\n  constructor (property) {\n    super('Missing: ' + property)\n    this.name = 'ValidationError'\n    this.property = property\n  }\n}\n/**\n * FormattingError\n * @class FormattingError\n */\nexport class FormattingError extends ValidationError {\n  constructor (property) {\n    super('Format Error: ' + property)\n    this.name = 'ValidationError'\n    this.property = property\n  }\n}\n\nexport class InvalidAmountError extends ValidationError {\n  constructor (property) {\n    super('Invalid Amount: ' + property)\n    this.name = 'InvalidAmountError'\n    this.property = property\n  }\n}\n","/** Domain Service - Records\n * This module will act as an adapter between th view layer and storage layer of the app for recoring transactions.\n @module domain/record\n */\n/*\nThis processing js will act as an adapter between th view layer and storage layer of the app for recoring transactions.\nFirst, it checks that the information given from the View Layer is correct. If it is incorrect we throw a validation error.\nSecond, if validation passes, we pass the new record information to the database where it saves this record, updating the account balances, and assigning the transaction a database key.\nThird, if there was a problem storing the information, the database will throw a storing error. We will communicate this error to the user to reattempt the record.\nFourth, if there were no validation/storage errors then the record must have been updated correctly, so we pass this new record, with its associated key, back to the view layer.\n*/\n\nimport * as recordStore from '../storage/record.js'\nimport * as accountStore from '../storage/account.js'\nimport { donwloadCSV } from '../utils.js'\nimport { InvalidAmountError } from './exceptions.js'\n\n/*\nOur input is the data given from the New Record fields on the view layer. The input has the form:\nconst passedInfo = {\"record_type\":\"Expense\",\"record_source_account\":\"Given Source Account\",\"record_destination_account\":\"Given Destination Account\",\"amount\":\"123456\",\"currency\":\"USD/Euro/else\",\"record_note\":\"Sample Note.\",\"record_created_time\":\"2018-07-22\",\"record_tag\":\"Sample Tag\"}\n\nFirst this function checks that the given JSON file has a valid amount, non-empty and a positive number.\nIf it doesn't, the validateNewRecord function will throw a Validation Error.\nIf it successfully validates, then we proceed to give the input to the storage layer.\nIf there is a problem in storage, then the addRecordInTable function will throw a Storage Error.\nIf we have no errors, then addRecordInTable() will return the newly added record with its database key in JSON format, which we then return.\n*/\n/**\n * Validates input and calls Storage Service\n * @public\n * @function addRecord\n *\n * @param {Record} record\n * @returns {Record}\n */\nexport async function addRecord (passedInfo) {\n  passedInfo.amount = Number(passedInfo.amount).toFixed(2)\n  validateNewRecord(passedInfo)\n  const result = await recordStore.storeRecord(passedInfo)\n  result.source_account = await accountStore.getAccount(result.source_account)\n  result.destination_account = await accountStore.getAccount(\n    result.destination_account\n  )\n  return result\n  // broadcast new record to all peers would be added here.\n}\n\n/**\n * Get all records\n * @function getAllRecords\n * @returns {Array.Record}\n */\nexport async function getAllRecords () {\n  let records = await recordStore.getAllRecords()\n  records = await records.toArray()\n  return Promise.all(\n    records.map(async (record) => {\n      record.source_account = await accountStore.getAccount(\n        record.source_account\n      )\n      record.destination_account = await accountStore.getAccount(\n        record.destination_account\n      )\n      return record\n    })\n  )\n}\n\nexport async function exportRecords () {\n  let records = await recordStore.getAllRecords()\n  records = await records.toArray()\n  records = await Promise.all(\n    records.map(async (record) => {\n      record.source_account = await accountStore.getAccount(\n        record.source_account\n      )\n      record.source_account = record.source_account.name\n      record.destination_account = await accountStore.getAccount(\n        record.destination_account\n      )\n      record.destination_account = record.destination_account.name\n      return record\n    })\n  )\n  donwloadCSV(records, 'records.csv')\n}\n\n/*\nWe assume here that the user is restricted from typing any non-number or decimal values into the record amount field.\nThis is a hard lock out on the view layer. So the initial balance is always a string.\n*/\n/**\n * Internal Method to validate input\n * @function validateNewAccount\n * @param {Account} account\n */\nfunction validateNewRecord (passedInfo) {\n  if (passedInfo.amount < 0) {\n    throw new InvalidAmountError('Record Amount')\n  }\n}\n\n/**\n * A Record\n * @typedef {Object} Record\n * @property {string} id - Autogenerated ID\n * @property {date} created_at - Created Timestamp\n * @property {date} updated_at - Updated Timestamp\n * @property {Account} source_account - Source Account\n * @property {Account} destination_account - Destincation Account\n * @property {string} emoji - Account Emoji\n * @property {number} amount - Record Amount\n * @property {string} currency - Currency\n */\n","/** Storage Service - Accounts\n @module storage/account\n */\nimport { db } from './idb.js'\nimport { StorageError } from './exceptions.js'\nimport { uuidv4 } from './utils.js'\n\n/**\n * Generates ID and saves to DB\n * @public\n * @function storeAccount\n *\n * @param {Account} account\n * @returns {Account}\n */\nexport async function storeAccount (account) {\n  account.id = uuidv4()\n  await db\n    .transaction('rw', db.accounts, async () => {\n      db.accounts.add(account)\n    })\n    .catch((e) => {\n      throw new StorageError(`Failed to store account ${e.stack}`)\n    })\n  return account\n}\n\n/**\n * Updates Account\n * @public\n * @function updateAccount\n * @param {string} id\n * @param {Account} account\n * @returns {Account}\n */\nexport async function updateAccount (id, account) {\n  await db\n    .transaction('rw', db.accounts, async () => {\n      const updated = await db.accounts.update(id, account)\n      if (!updated) {\n        throw new StorageError(`Could not find Account ${id}`)\n      }\n    })\n    .catch((e) => {\n      throw new StorageError(`Failed to update account ${e.stack}`)\n    })\n  return account\n}\n\n/**\n * Get Account\n * @public\n * @function getAccount\n * @param {string} id\n * @returns {Account}\n */\nexport async function getAccount (id) {\n  return db\n    .transaction('r', db.accounts, async () => db.accounts.get(id))\n    .catch((e) => {\n      throw new StorageError(`Could not get Account - ${e.stack}`)\n    })\n}\n/**\n * Get all Accounts\n * @public\n * @function getAllAccounts\n * @returns {Array.Account}\n */\nexport async function getAllAccounts () {\n  return db\n    .transaction('r', db.accounts, async () => {\n      return db.accounts\n    })\n    .catch((e) => {\n      throw new StorageError(`Could not get Accounts - ${e.stack}`)\n    })\n}\n/**\n * Get all Accounts given filter predicates\n * @public\n * @param {Array.Function} filters\n * @function getAccountMulti\n * @returns {Array.Account}\n */\nexport async function getAccountMulti (filters = {}) {\n  return db\n    .transaction('r', db.accounts, async () => {\n      return db.accounts.where(filters)\n    })\n    .catch((e) => {\n      throw new StorageError(`Could not get Accounts - ${e.stack}`)\n    })\n}\n/* All Seeded Accounts are pre-existing categories for Income/Expenses.\n   Each will have the following fields\n   - name\n   - fund_source => SEED\n   - fund_type\n   - initial_balance\n   - Emoji\n   Expense Categories\n*/\nconst EXPENSE = {\n  Food: '',\n  Groceries: '',\n  Alcohol: '',\n  Shopping: '',\n  Entertainment: '',\n  Learning: '',\n  Transport: '',\n  Events: '',\n  Investments: '',\n  Housing: ''\n}\n\nconst INCOME = {\n  Salary: '',\n  Interest: '',\n  Refunds: ''\n}\n\ndb.on('populate', (tx) => {\n  // Use provided transaction to populate database with initial data\n  Object.entries(EXPENSE)\n    .map(([name, emoji]) => {\n      return {\n        name,\n        emoji,\n        source: 'SEED',\n        type: 'expense',\n        initial_balance: 0.0,\n        current_balance: 0.0\n      }\n    })\n    .forEach((e) => storeAccount(e))\n  Object.entries(INCOME)\n    .map(([name, emoji]) => {\n      return {\n        name,\n        emoji,\n        source: 'SEED',\n        type: 'income',\n        initial_balance: 0.0,\n        current_balance: 0.0\n      }\n    })\n    .forEach((e) => {\n      storeAccount(e)\n    })\n})\n","/** Storage Service - Exceptions\n @module storage/exceptions\n */\n/**\n * Storage Error\n * @class StorageError\n */\nexport class StorageError extends Error {\n  constructor (message) {\n    super(message)\n    this.name = 'StorageError'\n    this.message = message\n  }\n}\n","/** Storage Service - IDB\n * Schema Definitions\n @module storage/idb\n */\nimport { StorageError } from './exceptions.js'\nimport { Dexie } from 'dexie'\n\nexport const db = new Dexie('sync-save')\ndb.version(1).stores({\n  accounts:\n    'id, name, source, type, initial_balance, current_balance, currency, created_at, updated_at',\n  records:\n    'id, source_account, destination_acount, amount, currency, type, note, tag, created_at, updated_at'\n})\ndb.open().catch((e) => {\n  throw new StorageError(`Failed to Open DB ${e.stack}`)\n})\n","/** Storage Service - Records\n @module storage/record\n */\nimport { db } from './idb.js'\nimport { StorageError } from './exceptions.js'\nimport { uuidv4 } from './utils.js'\n\n/**\n * Generates ID and saves to DB\n * @public\n * @function storeRecord\n *\n * @param {Record} record\n * @returns {Record}\n */\nexport async function storeRecord (record) {\n  record.id = uuidv4()\n  await db\n    .transaction('rw', db.records, db.accounts, async () => {\n      db.records.add(record)\n      const srcAccount = await db.accounts.get(record.source_account)\n      const destAccount = await db.accounts.get(record.destination_account)\n      await db.accounts.update(srcAccount.id, {\n        current_balance:\n          Number(srcAccount.current_balance) - Number(record.amount)\n      })\n      await db.accounts.update(destAccount.id, {\n        current_balance:\n          Number(destAccount.current_balance) + Number(record.amount)\n      })\n    })\n    .catch((e) => {\n      throw new StorageError(`Failed to store record ${e.stack}`)\n    })\n  return record\n}\n\n/**\n * Updates Record\n * @public\n * @function updateRecord\n * @param {string} id\n * @param {Record} record\n * @returns {Record}\n */\nexport async function updateRecord (id, record) {\n  await db\n    .transaction('rw', db.records, db.accounts, async () => {\n      const prev = await db.records.get(id)\n      let srcAccount = await db.accounts.get(prev.source_account)\n      let destAccount = await db.accounts.get(prev.destination_account)\n      // Undoing last record's balance\n      await db.accounts.update(srcAccount.id, {\n        current_balance: srcAccount.current_balance + prev.amount\n      })\n      await db.accounts.update(destAccount.id, {\n        current_balance: destAccount.current_balance - prev.amount\n      })\n      const updated = await db.records.update(id, record)\n      if (!updated) {\n        throw new StorageError(`Could not find Record ${id}`)\n      }\n      srcAccount = await db.accounts.get(record.source_account)\n      destAccount = await db.accounts.get(record.destination_account)\n      // Updating edited record's balance\n      await db.accounts.update(srcAccount.id, {\n        current_balance: srcAccount.current_balance + record.amount\n      })\n      await db.accounts.update(destAccount.id, {\n        current_balance: destAccount.current_balance - record.amount\n      })\n    })\n    .catch((e) => {\n      throw new StorageError(`Failed to update record ${e.stack}`)\n    })\n  return record\n}\n\n/**\n * Get Record\n * @public\n * @function getRecord\n * @param {string} id\n * @returns {Record}\n */\nexport async function getRecord (id) {\n  return db\n    .transaction('r', db.records, async () => db.records.get(id))\n    .catch((e) => {\n      throw new StorageError(`Could not get Record - ${e.stack}`)\n    })\n}\n\n/**\n * Get all Records\n * @public\n * @function getAllRecords\n * @returns {Array.Record}\n */\nexport async function getAllRecords () {\n  return db\n    .transaction('r', db.records, async () => {\n      return db.records\n    })\n    .catch((e) => {\n      throw new StorageError(`Could not get Records - ${e.stack}`)\n    })\n}\n/**\n * Get all Records given filter predicates\n * @public\n * @param {Array.Function} filters\n * @function getRecordsMulti\n * @returns {Array.Record}\n */\nexport async function getRecordsMulti (filters = {}) {\n  return db\n    .transaction('r', db.records, async () => {\n      return db.records.where(filters)\n    })\n    .catch((e) => {\n      throw new StorageError(`Could not get Records - ${e.stack}`)\n    })\n}\n","// https://stackoverflow.com/questions/105034/how-do-i-create-a-guid-uuid\nexport function uuidv4 () {\n  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>\n    (\n      c ^\n      (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))\n    ).toString(16)\n  )\n}\n","export function donwloadCSV (data, filename) {\n  const formatRow = (values) =>\n    values.map((v) => `\"${v.replace('\"', '\\\\\"')}\"`).join(',') + '\\n'\n  const download = (csvData) => {\n    const anchor = document.createElement('a')\n    anchor.setAttribute('download', filename)\n    const blob = new Blob([csvData], { type: 'text/csv' })\n    const url = URL.createObjectURL(blob)\n    anchor.setAttribute('href', url)\n    anchor.click()\n    URL.revokeObjectURL(url)\n  }\n  const headers = formatRow(Object.keys(data[0]))\n  const body = data.map((object) => formatRow(Object.values(object))).join('')\n  const csvData = [headers, body].join('')\n  download(csvData)\n}\n","/** View Service - Components\n @module view/components\n */\nimport * as util from './utility.js'\nconst RECORD_AMOUNT_COLOR_LOOKUP = {\n  expense: 'red',\n  income: 'green',\n  transfer: 'slate'\n}\n/**\n * @description recordCardComponent make an element on the Records Table\n */\nexport const recordCardComponent = (record) => {\n  const recordCard = document.createElement('div')\n  recordCard.classList = 'py-3 sm:py-4'\n  recordCard.innerHTML = `\n<div class=\"flex items-center space-x-4\">\n  <div class=\"flex\">\n    <div class=\"text-2xl rounded-full\">${record.destination_account.emoji}</div>\n  </div>\n  <div class=\"flex-1 min-w-0\">\n    <p class=\"text-sm font-medium text-gray-900 truncate\">${\n      record.destination_account.name\n    }</p>\n    <p class=\"text-sm text-gray-500 truncate\">${record.created_at}</p>\n  </div>\n  <div class=\"flex-1 min-w-0\">\n    <p class=\"text-sm font-medium text-gray-900 truncate\">\n      ${record.note}\n    </p>\n    <p class=\"text-sm text-gray-500 truncate\">${record.source_account.name}</p>\n  </div>\n  <div class=\"inline-flex items-center text-base text-${\n    RECORD_AMOUNT_COLOR_LOOKUP[record.type]\n  }-600\">\n   ${util.getBalanceWithCurrency(record.amount, record.currency)}\n  </div>\n</div>`\n  return recordCard\n}\n\n/**\n * @description accountCardComponent make an element on the Accounts Table\n */\nexport const accountCardComponent = (account) => {\n  const accountCard = document.createElement('div')\n  accountCard.classList =\n    'container p-4 m-2 h-full items-stretch max-w-xs bg-white rounded-lg border shadow-md sm:p-8 hover:bg-slate-50'\n  accountCard.innerHTML = `<div class='sm:py-4'>\n  <div class='flex items-center space-x-4'>\n    <div class='flex'>\n      <div class='text-2xl rounded-full'>${account.emoji}</div>\n    </div>\n    <div class='flex-1 min-w-0'>\n      <p class='text-sm font-medium text-gray-900 truncate'>\n      ${account.name}\n      </p>\n      <p class='text-xs text-gray-500 truncate'>${util.getAccountType(\n        account.type\n      )}</p>\n    </div>\n    <div class=\"inline-flex items-center text-base ${\n      account.current_balance > 0 ? 'text-green-600' : 'text-red-600'\n    }\">\n    ${util.getBalanceWithCurrency(account.current_balance, account.currency)}\n    </div>\n  </div>\n</div>`\n  return accountCard\n}\n\n/**\n * @description getRecordModal - Modal to add new Records\n */\nconst getRecordModal = () => {\n  const modal = document.createElement('div', {\n    id: 'add-record-modal',\n    'aria-labelledby': 'modal-title',\n    role: 'dialog',\n    'aria-modal': true\n  })\n  modal.classList.add('z-10')\n  modal.classList.add('hidden')\n  modal.innerHTML = `      <!--\n    Background backdrop, show/hide based on modal state.\n\n    Entering: \"ease-out duration-300\"\n      From: \"opacity-0\"\n      To: \"opacity-100\"\n    Leaving: \"ease-in duration-200\"\n      From: \"opacity-100\"\n      To: \"opacity-0\"\n  -->\n<div\n  class=\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\"\n></div>\n\n<div class=\"fixed inset-0 z-10 overflow-y-auto\">\n  <div\n    class=\"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0\"\n  >\n    <div\n      class=\"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg\"\n    >\n      <div class=\"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\n        <div class=\"sm:flex sm:items-start\">\n          <div class=\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left\">\n            <form id=\"add-record-form\"class=\"w-full max-w-xl mt-2\">\n              <div class=\"flex flex-wrap -mx-3 mb-6\">\n                <div class=\"w-full md:w-1/3 px-3 mb-6 md:mb-0\">\n                  <label\n                    class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2\"\n                    for=\"type\"\n                  >\n                    Record Type\n                  </label>\n                  <div class=\"relative\">\n                    <select\n                      name=\"type\"\n                      class=\"block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\n                      id=\"grid-record-type\"\n                    >\n                      <option value=\"expense\">Expense</option>\n                      <option value=\"income\">Income</option>\n                      <option value=\"transfer\">Transfer</option>\n                    </select>\n                    <div\n                      class=\"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700\"\n                    >\n                      <svg\n                        class=\"fill-current h-4 w-4\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        viewBox=\"0 0 20 20\"\n                      >\n                        <path\n                          d=\"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z\"\n                        />\n                      </svg>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"flex flex-wrap -mx-3 mb-6\">\n                <div class=\"w-full md:w-1/2 px-3 mb-6 md:mb-0\">\n                  <label\n                    class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2\"\n                    for=\"source_account\"\n                  >\n                    Source\n                  </label>\n                  <div class=\"relative\">\n                    <select\n                      name=\"source_account\"\n                      class=\"block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\n                      id=\"grid-source-account\"\n                    >\n                    </select>\n                    <div\n                      class=\"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700\"\n                    >\n                      <svg\n                        class=\"fill-current h-4 w-4\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        viewBox=\"0 0 20 20\"\n                      >\n                        <path\n                          d=\"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z\"\n                        />\n                      </svg>\n                    </div>\n                  </div>\n                  <!-- <p class=\"text-red-500 text-xs italic\">\n                      Please fill out this field.\n                    </p> -->\n                </div>\n\n                <div class=\"w-full md:w-1/2 px-3 mb-6 md:mb-0\">\n                  <label\n                    class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2\"\n                    for=\"destination_account\"\n                  >\n                    Destination\n                  </label>\n                  <div class=\"relative\">\n                    <select\n                      name=\"destination_account\"\n                      class=\"block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\n                      id=\"grid-destination-account\"\n                    >\n                    </select>\n                    <div\n                      class=\"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700\"\n                    >\n                      <svg\n                        class=\"fill-current h-4 w-4\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        viewBox=\"0 0 20 20\"\n                      >\n                        <path\n                          d=\"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z\"\n                        />\n                      </svg>\n                    </div>\n                  </div>\n                  <!-- <p class=\"text-red-500 text-xs italic\">\n                        Please fill out this field.\n                      </p> -->\n                </div>\n              </div>\n              <div class=\"flex flex-wrap -mx-3 mb-6\">\n                <div class=\"w-full md:w-1/2 px-3 mb-6 md:mb-0\">\n                  <label\n                    class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2\"\n                    for=\"amount\"\n                  >\n                    Amount\n                  </label>\n                  <input\n                    name=\"amount\"\n                    class=\"appearance-none w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\n                    id=\"grid-amount\"\n                    type=\"number\"\n                    min=\"0.01\"\n                    placeholder=\"00.00\"\n                  />\n                  <!-- <p class=\"text-red-500 text-xs italic\">\n                      Please fill out this field.\n                    </p> -->\n                </div>\n\n                <div class=\"w-full md:w-1/2 px-3 mb-6 md:mb-0\">\n                  <label\n                    class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2\"\n                    for=\"currency\"\n                  >\n                    Currency\n                  </label>\n                  <div class=\"relative\">\n                    <select\n                      name=\"currency\"\n                      class=\"block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\n                      id=\"grid-currency\"\n                    >\n                      <option>USD</option>\n                      <option>EUR</option>\n                      <option>INR</option>\n                    </select>\n                    <div\n                      class=\"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700\"\n                    >\n                      <svg\n                        class=\"fill-current h-4 w-4\"\n                        xmlns=\"http://www.w3.org/2000/svg\"\n                        viewBox=\"0 0 20 20\"\n                      >\n                        <path\n                          d=\"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z\"\n                        />\n                      </svg>\n                    </div>\n                  </div>\n                  <!-- <p class=\"text-red-500 text-xs italic\">\n                        Please fill out this field.\n                      </p> -->\n                </div>\n              </div>\n              <div class=\"flex flex-wrap -mx-3 mb-6\">\n                <div class=\"w-full px-3\">\n                  <label\n                    class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2\"\n                    for=\"note\"\n                  >\n                    Note\n                  </label>\n                  <input\n                    name=\"note\"\n                    class=\"appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\n                    id=\"grid-note\"\n                    type=\"text\"\n                    placeholder=\"Enter Note Here\"\n                  />\n                  <!-- <p class=\"text-gray-600 text-xs italic\">\n                      Make it as long and as crazy as you'd like\n                    </p> -->\n                </div>\n              </div>\n              <div class=\"flex flex-wrap -mx-3 mb-2\">\n                <div class=\"w-full md:w-1/3 px-3 mb-6 md:mb-0\">\n                  <label\n                    class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2\"\n                    for=\"created_at\"\n                  >\n                    Date\n                  </label>\n                  <input\n                    name=\"created_at\"\n                    class=\"inline-block appearance-none w-full block bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\n                    id=\"grid-created-time\"\n                    type=\"date\"\n                    value=\"2018-07-22\"\n                  />\n                </div>\n                <div class=\"w-full md:w-1/3 px-3 mb-6 md:mb-0\">\n                  <label\n                    class=\"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2\"\n                    for=\"tag\"\n                  >\n                    Tag\n                  </label>\n                  <input\n                    class=\"appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500\"\n                    id=\"grid-tag\"\n                    type=\"text\"\n                    name=\"tag\"\n                    placeholder=\"None\"\n                  />\n                </div>\n              </div>\n            </form>\n          </div>\n        </div>\n      </div>\n      <div\n        class=\"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6\"\n      >\n        <button\n          id=\"record-modal-add-btn\"\n          type=\"button\"\n          class=\"inline-flex w-full justify-center rounded-md border border-transparent bg-red-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm\"\n        >\n          Add Record\n        </button>\n        <button\n          id=\"record-modal-cancel-btn\"\n          type=\"button\"\n          class=\"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm\"\n        >\n          Cancel\n        </button>\n      </div>\n    </div>\n  </div>\n</div>`\n  return modal\n}\nexport const recordModal = getRecordModal()\n","/** View Service - Dashboard\n @module view/dashboard\n */\nimport * as accountService from '../domain/account.js'\nimport { recordModal, accountCardComponent } from './components.js'\nconst navBarQuickAdd = document.querySelector('#add-record')\nconst addAccountModal = document.querySelector('#add-account-modal')\nconst addAccountButton = document.querySelector('#add-account-btn')\nconst accountModalCancelButton = document.querySelector(\n  '#account-modal-cancel-btn'\n)\nconst accountModalAddButton = document.querySelector('#add-account-modal-btn')\nconst accountModalAddForm = document.querySelector('#add-account-form')\nconst accountList = document.querySelector('#account-list')\n\n// this function would be called every time the page is loaded\ndocument.addEventListener('DOMContentLoaded', () => {\n  document.body.appendChild(recordModal)\n  accountService.getAllUserAccounts().then((accounts) => {\n    accounts.forEach((account) => {\n      addAccountCard(account)\n    })\n  })\n})\n\n/* Utilities */\nconst toggleAddAccountModalVisibility = () => {\n  addAccountModal.classList.toggle('hidden')\n}\nconst toggleAddRecordModalVisibility = () => {\n  recordModal.classList.toggle('hidden')\n}\n\n/* Event Listeners */\naddAccountButton &&\n  addAccountButton.addEventListener('click', (e) => {\n    toggleAddAccountModalVisibility()\n  })\naccountModalCancelButton &&\n  accountModalCancelButton.addEventListener('click', (e) => {\n    toggleAddAccountModalVisibility()\n  })\n\nnavBarQuickAdd &&\n  navBarQuickAdd.addEventListener('click', (e) => {\n    toggleAddRecordModalVisibility()\n  })\n\naccountModalAddButton &&\n  accountModalAddButton.addEventListener('click', (e) => {\n    const formData = new FormData(accountModalAddForm)\n    const formJson = {}\n    for (const pair of formData.entries()) {\n      formJson[pair[0]] = pair[1]\n    }\n    accountService.addAccount(formJson).then((account) => {\n      addAccountCard(account)\n    })\n    toggleAddAccountModalVisibility()\n  })\n\ndocument.onkeyup = (e) => {\n  if (e.ctrlKey && e.key === 'q') {\n    toggleAddRecordModalVisibility()\n  }\n}\n\nconst addAccountCard = (account) => {\n  accountList && accountList.prepend(accountCardComponent(account))\n}\n","/** View Service - Records\n @module view/records\n */\nimport * as recordService from '../domain/record.js'\nimport * as accountService from '../domain/account.js'\nimport { recordModal, recordCardComponent } from './components.js'\n\nconst recordList = document.querySelector('#record-list')\nconst addRecordButton = document.querySelector('#add-record-btn')\nconst recordModalRecordType = recordModal.querySelector('#grid-record-type')\nconst dstAccountDropDown = recordModal.querySelector(\n  '#grid-destination-account'\n)\nconst srcAccountDropDown = recordModal.querySelector('#grid-source-account')\nconst recordModalCancelBtn = recordModal.querySelector(\n  '#record-modal-cancel-btn'\n)\nconst recordModalAddBtn = recordModal.querySelector('#record-modal-add-btn')\nconst recordModalForm = recordModal.querySelector('#add-record-form')\nconst exportRecordsBtn = document.querySelector('#export-records-btn')\n\nconst toggleAddRecordModalVisibility = () => {\n  recordModal.classList.toggle('hidden')\n  expenseTypeChangeHandle('expense')\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  document.body.appendChild(recordModal)\n  recordService.getAllRecords().then((records) => {\n    records.map((record) => addRecordCard(record))\n  })\n})\nrecordModalRecordType &&\n  recordModalRecordType.addEventListener('change', (e) => {\n    expenseTypeChangeHandle(e.target.value)\n  }) &&\n  recordModalRecordType.addEventListener('click', (e) => {\n    expenseTypeChangeHandle(e.target.value)\n  })\n\naddRecordButton &&\n  addRecordButton.addEventListener('click', (e) => {\n    toggleAddRecordModalVisibility()\n  })\n\nrecordModalCancelBtn &&\n  recordModalCancelBtn.addEventListener('click', (e) =>\n    toggleAddRecordModalVisibility()\n  )\n\nexportRecordsBtn &&\n  exportRecordsBtn.addEventListener('click', async (e) => {\n    await recordService.exportRecords()\n  })\n\nrecordModalAddBtn &&\n  recordModalAddBtn.addEventListener('click', (e) => {\n    const formData = new FormData(recordModalForm)\n    const formJson = {}\n    for (const pair of formData.entries()) {\n      formJson[pair[0]] = pair[1]\n    }\n    recordService.addRecord(formJson).then((record) => {\n      addRecordCard(record)\n    })\n    toggleAddRecordModalVisibility()\n  })\n\nconst populateDropDown = (element, filter) => {\n  element.replaceChildren()\n  accountService.getAllAccounts(filter).then((accounts) => {\n    accounts\n      .map((account) => accountDropDown(account))\n      .forEach((dropdown) => element.prepend(dropdown))\n  })\n}\nconst expenseTypeChangeHandle = (recordType) => {\n  switch (recordType) {\n    case 'expense':\n      populateDropDown(srcAccountDropDown, { source: 'USER' })\n      populateDropDown(dstAccountDropDown, { type: 'expense' })\n      break\n    case 'income':\n      populateDropDown(srcAccountDropDown, { type: 'income' })\n      populateDropDown(dstAccountDropDown, { source: 'USER' })\n      break\n    case 'transfer':\n      populateDropDown(srcAccountDropDown, { source: 'USER' })\n      populateDropDown(dstAccountDropDown, { source: 'USER' })\n      break\n  }\n}\n\nconst accountDropDown = (account) => {\n  const node = document.createElement('option')\n  node.value = account.id\n  node.innerText = `${account.emoji} ${account.name}`\n  return node\n}\n\nconst addRecordCard = (account) => {\n  recordList && recordList.prepend(recordCardComponent(account))\n}\n","// helper function to return sign of account\n// https://tailwindcss.com/docs/content-configuration#dynamic-class-names\nexport function getBalanceColor (balance) {\n  if (balance < 0) {\n    return 'text-red-600'\n  } else {\n    return 'text-green-600'\n  }\n}\n\n// helper function to return currency with balance as string\nexport function getBalanceWithCurrency (balance, currency) {\n  const currencySign = getCurrencySign(currency)\n  if (balance < 0) {\n    return '-' + currencySign + Math.abs(balance).toString()\n  } else {\n    return currencySign + balance.toString()\n  }\n}\n\n// helper function to return sign of account\n\n// helper function to return account type name to be displayed\nexport function getAccountType (accountTypeString) {\n  switch (accountTypeString) {\n    case 'checking-account':\n      return 'Checking Account'\n    case 'savings-account':\n      return 'Savings Account'\n    case 'cash':\n      return 'Cash'\n    case 'credit-card':\n      return 'Credit Card'\n    default:\n      return ''\n  }\n}\n\n// helper function to return sign of currency\nexport function getCurrencySign (currencyString) {\n  switch (currencyString) {\n    case 'USD':\n      return '$'\n    case 'INR':\n      return ''\n    case 'EUR':\n      return ''\n    default:\n      return ''\n  }\n}\n","/*\n * Dexie.js - a minimalistic wrapper for IndexedDB\n * ===============================================\n *\n * By David Fahlander, david.fahlander@gmail.com\n *\n * Version 3.2.2, Wed Apr 27 2022\n *\n * https://dexie.org\n *\n * Apache License Version 2.0, January 2004, http://www.apache.org/licenses/\n */\n \nconst _global = typeof globalThis !== 'undefined' ? globalThis :\n    typeof self !== 'undefined' ? self :\n        typeof window !== 'undefined' ? window :\n            global;\n\nconst keys = Object.keys;\nconst isArray = Array.isArray;\nif (typeof Promise !== 'undefined' && !_global.Promise) {\n    _global.Promise = Promise;\n}\nfunction extend(obj, extension) {\n    if (typeof extension !== 'object')\n        return obj;\n    keys(extension).forEach(function (key) {\n        obj[key] = extension[key];\n    });\n    return obj;\n}\nconst getProto = Object.getPrototypeOf;\nconst _hasOwn = {}.hasOwnProperty;\nfunction hasOwn(obj, prop) {\n    return _hasOwn.call(obj, prop);\n}\nfunction props(proto, extension) {\n    if (typeof extension === 'function')\n        extension = extension(getProto(proto));\n    (typeof Reflect === \"undefined\" ? keys : Reflect.ownKeys)(extension).forEach(key => {\n        setProp(proto, key, extension[key]);\n    });\n}\nconst defineProperty = Object.defineProperty;\nfunction setProp(obj, prop, functionOrGetSet, options) {\n    defineProperty(obj, prop, extend(functionOrGetSet && hasOwn(functionOrGetSet, \"get\") && typeof functionOrGetSet.get === 'function' ?\n        { get: functionOrGetSet.get, set: functionOrGetSet.set, configurable: true } :\n        { value: functionOrGetSet, configurable: true, writable: true }, options));\n}\nfunction derive(Child) {\n    return {\n        from: function (Parent) {\n            Child.prototype = Object.create(Parent.prototype);\n            setProp(Child.prototype, \"constructor\", Child);\n            return {\n                extend: props.bind(null, Child.prototype)\n            };\n        }\n    };\n}\nconst getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\nfunction getPropertyDescriptor(obj, prop) {\n    const pd = getOwnPropertyDescriptor(obj, prop);\n    let proto;\n    return pd || (proto = getProto(obj)) && getPropertyDescriptor(proto, prop);\n}\nconst _slice = [].slice;\nfunction slice(args, start, end) {\n    return _slice.call(args, start, end);\n}\nfunction override(origFunc, overridedFactory) {\n    return overridedFactory(origFunc);\n}\nfunction assert(b) {\n    if (!b)\n        throw new Error(\"Assertion Failed\");\n}\nfunction asap$1(fn) {\n    if (_global.setImmediate)\n        setImmediate(fn);\n    else\n        setTimeout(fn, 0);\n}\nfunction arrayToObject(array, extractor) {\n    return array.reduce((result, item, i) => {\n        var nameAndValue = extractor(item, i);\n        if (nameAndValue)\n            result[nameAndValue[0]] = nameAndValue[1];\n        return result;\n    }, {});\n}\nfunction tryCatch(fn, onerror, args) {\n    try {\n        fn.apply(null, args);\n    }\n    catch (ex) {\n        onerror && onerror(ex);\n    }\n}\nfunction getByKeyPath(obj, keyPath) {\n    if (hasOwn(obj, keyPath))\n        return obj[keyPath];\n    if (!keyPath)\n        return obj;\n    if (typeof keyPath !== 'string') {\n        var rv = [];\n        for (var i = 0, l = keyPath.length; i < l; ++i) {\n            var val = getByKeyPath(obj, keyPath[i]);\n            rv.push(val);\n        }\n        return rv;\n    }\n    var period = keyPath.indexOf('.');\n    if (period !== -1) {\n        var innerObj = obj[keyPath.substr(0, period)];\n        return innerObj === undefined ? undefined : getByKeyPath(innerObj, keyPath.substr(period + 1));\n    }\n    return undefined;\n}\nfunction setByKeyPath(obj, keyPath, value) {\n    if (!obj || keyPath === undefined)\n        return;\n    if ('isFrozen' in Object && Object.isFrozen(obj))\n        return;\n    if (typeof keyPath !== 'string' && 'length' in keyPath) {\n        assert(typeof value !== 'string' && 'length' in value);\n        for (var i = 0, l = keyPath.length; i < l; ++i) {\n            setByKeyPath(obj, keyPath[i], value[i]);\n        }\n    }\n    else {\n        var period = keyPath.indexOf('.');\n        if (period !== -1) {\n            var currentKeyPath = keyPath.substr(0, period);\n            var remainingKeyPath = keyPath.substr(period + 1);\n            if (remainingKeyPath === \"\")\n                if (value === undefined) {\n                    if (isArray(obj) && !isNaN(parseInt(currentKeyPath)))\n                        obj.splice(currentKeyPath, 1);\n                    else\n                        delete obj[currentKeyPath];\n                }\n                else\n                    obj[currentKeyPath] = value;\n            else {\n                var innerObj = obj[currentKeyPath];\n                if (!innerObj || !hasOwn(obj, currentKeyPath))\n                    innerObj = (obj[currentKeyPath] = {});\n                setByKeyPath(innerObj, remainingKeyPath, value);\n            }\n        }\n        else {\n            if (value === undefined) {\n                if (isArray(obj) && !isNaN(parseInt(keyPath)))\n                    obj.splice(keyPath, 1);\n                else\n                    delete obj[keyPath];\n            }\n            else\n                obj[keyPath] = value;\n        }\n    }\n}\nfunction delByKeyPath(obj, keyPath) {\n    if (typeof keyPath === 'string')\n        setByKeyPath(obj, keyPath, undefined);\n    else if ('length' in keyPath)\n        [].map.call(keyPath, function (kp) {\n            setByKeyPath(obj, kp, undefined);\n        });\n}\nfunction shallowClone(obj) {\n    var rv = {};\n    for (var m in obj) {\n        if (hasOwn(obj, m))\n            rv[m] = obj[m];\n    }\n    return rv;\n}\nconst concat = [].concat;\nfunction flatten(a) {\n    return concat.apply([], a);\n}\nconst intrinsicTypeNames = \"Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey\"\n    .split(',').concat(flatten([8, 16, 32, 64].map(num => [\"Int\", \"Uint\", \"Float\"].map(t => t + num + \"Array\")))).filter(t => _global[t]);\nconst intrinsicTypes = intrinsicTypeNames.map(t => _global[t]);\narrayToObject(intrinsicTypeNames, x => [x, true]);\nlet circularRefs = null;\nfunction deepClone(any) {\n    circularRefs = typeof WeakMap !== 'undefined' && new WeakMap();\n    const rv = innerDeepClone(any);\n    circularRefs = null;\n    return rv;\n}\nfunction innerDeepClone(any) {\n    if (!any || typeof any !== 'object')\n        return any;\n    let rv = circularRefs && circularRefs.get(any);\n    if (rv)\n        return rv;\n    if (isArray(any)) {\n        rv = [];\n        circularRefs && circularRefs.set(any, rv);\n        for (var i = 0, l = any.length; i < l; ++i) {\n            rv.push(innerDeepClone(any[i]));\n        }\n    }\n    else if (intrinsicTypes.indexOf(any.constructor) >= 0) {\n        rv = any;\n    }\n    else {\n        const proto = getProto(any);\n        rv = proto === Object.prototype ? {} : Object.create(proto);\n        circularRefs && circularRefs.set(any, rv);\n        for (var prop in any) {\n            if (hasOwn(any, prop)) {\n                rv[prop] = innerDeepClone(any[prop]);\n            }\n        }\n    }\n    return rv;\n}\nconst { toString } = {};\nfunction toStringTag(o) {\n    return toString.call(o).slice(8, -1);\n}\nconst iteratorSymbol = typeof Symbol !== 'undefined' ?\n    Symbol.iterator :\n    '@@iterator';\nconst getIteratorOf = typeof iteratorSymbol === \"symbol\" ? function (x) {\n    var i;\n    return x != null && (i = x[iteratorSymbol]) && i.apply(x);\n} : function () { return null; };\nconst NO_CHAR_ARRAY = {};\nfunction getArrayOf(arrayLike) {\n    var i, a, x, it;\n    if (arguments.length === 1) {\n        if (isArray(arrayLike))\n            return arrayLike.slice();\n        if (this === NO_CHAR_ARRAY && typeof arrayLike === 'string')\n            return [arrayLike];\n        if ((it = getIteratorOf(arrayLike))) {\n            a = [];\n            while ((x = it.next()), !x.done)\n                a.push(x.value);\n            return a;\n        }\n        if (arrayLike == null)\n            return [arrayLike];\n        i = arrayLike.length;\n        if (typeof i === 'number') {\n            a = new Array(i);\n            while (i--)\n                a[i] = arrayLike[i];\n            return a;\n        }\n        return [arrayLike];\n    }\n    i = arguments.length;\n    a = new Array(i);\n    while (i--)\n        a[i] = arguments[i];\n    return a;\n}\nconst isAsyncFunction = typeof Symbol !== 'undefined'\n    ? (fn) => fn[Symbol.toStringTag] === 'AsyncFunction'\n    : () => false;\n\nvar debug = typeof location !== 'undefined' &&\n    /^(http|https):\\/\\/(localhost|127\\.0\\.0\\.1)/.test(location.href);\nfunction setDebug(value, filter) {\n    debug = value;\n    libraryFilter = filter;\n}\nvar libraryFilter = () => true;\nconst NEEDS_THROW_FOR_STACK = !new Error(\"\").stack;\nfunction getErrorWithStack() {\n    if (NEEDS_THROW_FOR_STACK)\n        try {\n            getErrorWithStack.arguments;\n            throw new Error();\n        }\n        catch (e) {\n            return e;\n        }\n    return new Error();\n}\nfunction prettyStack(exception, numIgnoredFrames) {\n    var stack = exception.stack;\n    if (!stack)\n        return \"\";\n    numIgnoredFrames = (numIgnoredFrames || 0);\n    if (stack.indexOf(exception.name) === 0)\n        numIgnoredFrames += (exception.name + exception.message).split('\\n').length;\n    return stack.split('\\n')\n        .slice(numIgnoredFrames)\n        .filter(libraryFilter)\n        .map(frame => \"\\n\" + frame)\n        .join('');\n}\n\nvar dexieErrorNames = [\n    'Modify',\n    'Bulk',\n    'OpenFailed',\n    'VersionChange',\n    'Schema',\n    'Upgrade',\n    'InvalidTable',\n    'MissingAPI',\n    'NoSuchDatabase',\n    'InvalidArgument',\n    'SubTransaction',\n    'Unsupported',\n    'Internal',\n    'DatabaseClosed',\n    'PrematureCommit',\n    'ForeignAwait'\n];\nvar idbDomErrorNames = [\n    'Unknown',\n    'Constraint',\n    'Data',\n    'TransactionInactive',\n    'ReadOnly',\n    'Version',\n    'NotFound',\n    'InvalidState',\n    'InvalidAccess',\n    'Abort',\n    'Timeout',\n    'QuotaExceeded',\n    'Syntax',\n    'DataClone'\n];\nvar errorList = dexieErrorNames.concat(idbDomErrorNames);\nvar defaultTexts = {\n    VersionChanged: \"Database version changed by other database connection\",\n    DatabaseClosed: \"Database has been closed\",\n    Abort: \"Transaction aborted\",\n    TransactionInactive: \"Transaction has already completed or failed\",\n    MissingAPI: \"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb\"\n};\nfunction DexieError(name, msg) {\n    this._e = getErrorWithStack();\n    this.name = name;\n    this.message = msg;\n}\nderive(DexieError).from(Error).extend({\n    stack: {\n        get: function () {\n            return this._stack ||\n                (this._stack = this.name + \": \" + this.message + prettyStack(this._e, 2));\n        }\n    },\n    toString: function () { return this.name + \": \" + this.message; }\n});\nfunction getMultiErrorMessage(msg, failures) {\n    return msg + \". Errors: \" + Object.keys(failures)\n        .map(key => failures[key].toString())\n        .filter((v, i, s) => s.indexOf(v) === i)\n        .join('\\n');\n}\nfunction ModifyError(msg, failures, successCount, failedKeys) {\n    this._e = getErrorWithStack();\n    this.failures = failures;\n    this.failedKeys = failedKeys;\n    this.successCount = successCount;\n    this.message = getMultiErrorMessage(msg, failures);\n}\nderive(ModifyError).from(DexieError);\nfunction BulkError(msg, failures) {\n    this._e = getErrorWithStack();\n    this.name = \"BulkError\";\n    this.failures = Object.keys(failures).map(pos => failures[pos]);\n    this.failuresByPos = failures;\n    this.message = getMultiErrorMessage(msg, failures);\n}\nderive(BulkError).from(DexieError);\nvar errnames = errorList.reduce((obj, name) => (obj[name] = name + \"Error\", obj), {});\nconst BaseException = DexieError;\nvar exceptions = errorList.reduce((obj, name) => {\n    var fullName = name + \"Error\";\n    function DexieError(msgOrInner, inner) {\n        this._e = getErrorWithStack();\n        this.name = fullName;\n        if (!msgOrInner) {\n            this.message = defaultTexts[name] || fullName;\n            this.inner = null;\n        }\n        else if (typeof msgOrInner === 'string') {\n            this.message = `${msgOrInner}${!inner ? '' : '\\n ' + inner}`;\n            this.inner = inner || null;\n        }\n        else if (typeof msgOrInner === 'object') {\n            this.message = `${msgOrInner.name} ${msgOrInner.message}`;\n            this.inner = msgOrInner;\n        }\n    }\n    derive(DexieError).from(BaseException);\n    obj[name] = DexieError;\n    return obj;\n}, {});\nexceptions.Syntax = SyntaxError;\nexceptions.Type = TypeError;\nexceptions.Range = RangeError;\nvar exceptionMap = idbDomErrorNames.reduce((obj, name) => {\n    obj[name + \"Error\"] = exceptions[name];\n    return obj;\n}, {});\nfunction mapError(domError, message) {\n    if (!domError || domError instanceof DexieError || domError instanceof TypeError || domError instanceof SyntaxError || !domError.name || !exceptionMap[domError.name])\n        return domError;\n    var rv = new exceptionMap[domError.name](message || domError.message, domError);\n    if (\"stack\" in domError) {\n        setProp(rv, \"stack\", { get: function () {\n                return this.inner.stack;\n            } });\n    }\n    return rv;\n}\nvar fullNameExceptions = errorList.reduce((obj, name) => {\n    if ([\"Syntax\", \"Type\", \"Range\"].indexOf(name) === -1)\n        obj[name + \"Error\"] = exceptions[name];\n    return obj;\n}, {});\nfullNameExceptions.ModifyError = ModifyError;\nfullNameExceptions.DexieError = DexieError;\nfullNameExceptions.BulkError = BulkError;\n\nfunction nop() { }\nfunction mirror(val) { return val; }\nfunction pureFunctionChain(f1, f2) {\n    if (f1 == null || f1 === mirror)\n        return f2;\n    return function (val) {\n        return f2(f1(val));\n    };\n}\nfunction callBoth(on1, on2) {\n    return function () {\n        on1.apply(this, arguments);\n        on2.apply(this, arguments);\n    };\n}\nfunction hookCreatingChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        var res = f1.apply(this, arguments);\n        if (res !== undefined)\n            arguments[0] = res;\n        var onsuccess = this.onsuccess,\n        onerror = this.onerror;\n        this.onsuccess = null;\n        this.onerror = null;\n        var res2 = f2.apply(this, arguments);\n        if (onsuccess)\n            this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n        if (onerror)\n            this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n        return res2 !== undefined ? res2 : res;\n    };\n}\nfunction hookDeletingChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        f1.apply(this, arguments);\n        var onsuccess = this.onsuccess,\n        onerror = this.onerror;\n        this.onsuccess = this.onerror = null;\n        f2.apply(this, arguments);\n        if (onsuccess)\n            this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n        if (onerror)\n            this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n    };\n}\nfunction hookUpdatingChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function (modifications) {\n        var res = f1.apply(this, arguments);\n        extend(modifications, res);\n        var onsuccess = this.onsuccess,\n        onerror = this.onerror;\n        this.onsuccess = null;\n        this.onerror = null;\n        var res2 = f2.apply(this, arguments);\n        if (onsuccess)\n            this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n        if (onerror)\n            this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n        return res === undefined ?\n            (res2 === undefined ? undefined : res2) :\n            (extend(res, res2));\n    };\n}\nfunction reverseStoppableEventChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        if (f2.apply(this, arguments) === false)\n            return false;\n        return f1.apply(this, arguments);\n    };\n}\nfunction promisableChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        var res = f1.apply(this, arguments);\n        if (res && typeof res.then === 'function') {\n            var thiz = this, i = arguments.length, args = new Array(i);\n            while (i--)\n                args[i] = arguments[i];\n            return res.then(function () {\n                return f2.apply(thiz, args);\n            });\n        }\n        return f2.apply(this, arguments);\n    };\n}\n\nvar INTERNAL = {};\nconst LONG_STACKS_CLIP_LIMIT = 100,\nMAX_LONG_STACKS = 20, ZONE_ECHO_LIMIT = 100, [resolvedNativePromise, nativePromiseProto, resolvedGlobalPromise] = typeof Promise === 'undefined' ?\n    [] :\n    (() => {\n        let globalP = Promise.resolve();\n        if (typeof crypto === 'undefined' || !crypto.subtle)\n            return [globalP, getProto(globalP), globalP];\n        const nativeP = crypto.subtle.digest(\"SHA-512\", new Uint8Array([0]));\n        return [\n            nativeP,\n            getProto(nativeP),\n            globalP\n        ];\n    })(), nativePromiseThen = nativePromiseProto && nativePromiseProto.then;\nconst NativePromise = resolvedNativePromise && resolvedNativePromise.constructor;\nconst patchGlobalPromise = !!resolvedGlobalPromise;\nvar stack_being_generated = false;\nvar schedulePhysicalTick = resolvedGlobalPromise ?\n    () => { resolvedGlobalPromise.then(physicalTick); }\n    :\n        _global.setImmediate ?\n            setImmediate.bind(null, physicalTick) :\n            _global.MutationObserver ?\n                () => {\n                    var hiddenDiv = document.createElement(\"div\");\n                    (new MutationObserver(() => {\n                        physicalTick();\n                        hiddenDiv = null;\n                    })).observe(hiddenDiv, { attributes: true });\n                    hiddenDiv.setAttribute('i', '1');\n                } :\n                () => { setTimeout(physicalTick, 0); };\nvar asap = function (callback, args) {\n    microtickQueue.push([callback, args]);\n    if (needsNewPhysicalTick) {\n        schedulePhysicalTick();\n        needsNewPhysicalTick = false;\n    }\n};\nvar isOutsideMicroTick = true,\nneedsNewPhysicalTick = true,\nunhandledErrors = [],\nrejectingErrors = [],\ncurrentFulfiller = null, rejectionMapper = mirror;\nvar globalPSD = {\n    id: 'global',\n    global: true,\n    ref: 0,\n    unhandleds: [],\n    onunhandled: globalError,\n    pgp: false,\n    env: {},\n    finalize: function () {\n        this.unhandleds.forEach(uh => {\n            try {\n                globalError(uh[0], uh[1]);\n            }\n            catch (e) { }\n        });\n    }\n};\nvar PSD = globalPSD;\nvar microtickQueue = [];\nvar numScheduledCalls = 0;\nvar tickFinalizers = [];\nfunction DexiePromise(fn) {\n    if (typeof this !== 'object')\n        throw new TypeError('Promises must be constructed via new');\n    this._listeners = [];\n    this.onuncatched = nop;\n    this._lib = false;\n    var psd = (this._PSD = PSD);\n    if (debug) {\n        this._stackHolder = getErrorWithStack();\n        this._prev = null;\n        this._numPrev = 0;\n    }\n    if (typeof fn !== 'function') {\n        if (fn !== INTERNAL)\n            throw new TypeError('Not a function');\n        this._state = arguments[1];\n        this._value = arguments[2];\n        if (this._state === false)\n            handleRejection(this, this._value);\n        return;\n    }\n    this._state = null;\n    this._value = null;\n    ++psd.ref;\n    executePromiseTask(this, fn);\n}\nconst thenProp = {\n    get: function () {\n        var psd = PSD, microTaskId = totalEchoes;\n        function then(onFulfilled, onRejected) {\n            var possibleAwait = !psd.global && (psd !== PSD || microTaskId !== totalEchoes);\n            const cleanup = possibleAwait && !decrementExpectedAwaits();\n            var rv = new DexiePromise((resolve, reject) => {\n                propagateToListener(this, new Listener(nativeAwaitCompatibleWrap(onFulfilled, psd, possibleAwait, cleanup), nativeAwaitCompatibleWrap(onRejected, psd, possibleAwait, cleanup), resolve, reject, psd));\n            });\n            debug && linkToPreviousPromise(rv, this);\n            return rv;\n        }\n        then.prototype = INTERNAL;\n        return then;\n    },\n    set: function (value) {\n        setProp(this, 'then', value && value.prototype === INTERNAL ?\n            thenProp :\n            {\n                get: function () {\n                    return value;\n                },\n                set: thenProp.set\n            });\n    }\n};\nprops(DexiePromise.prototype, {\n    then: thenProp,\n    _then: function (onFulfilled, onRejected) {\n        propagateToListener(this, new Listener(null, null, onFulfilled, onRejected, PSD));\n    },\n    catch: function (onRejected) {\n        if (arguments.length === 1)\n            return this.then(null, onRejected);\n        var type = arguments[0], handler = arguments[1];\n        return typeof type === 'function' ? this.then(null, err =>\n        err instanceof type ? handler(err) : PromiseReject(err))\n            : this.then(null, err =>\n            err && err.name === type ? handler(err) : PromiseReject(err));\n    },\n    finally: function (onFinally) {\n        return this.then(value => {\n            onFinally();\n            return value;\n        }, err => {\n            onFinally();\n            return PromiseReject(err);\n        });\n    },\n    stack: {\n        get: function () {\n            if (this._stack)\n                return this._stack;\n            try {\n                stack_being_generated = true;\n                var stacks = getStack(this, [], MAX_LONG_STACKS);\n                var stack = stacks.join(\"\\nFrom previous: \");\n                if (this._state !== null)\n                    this._stack = stack;\n                return stack;\n            }\n            finally {\n                stack_being_generated = false;\n            }\n        }\n    },\n    timeout: function (ms, msg) {\n        return ms < Infinity ?\n            new DexiePromise((resolve, reject) => {\n                var handle = setTimeout(() => reject(new exceptions.Timeout(msg)), ms);\n                this.then(resolve, reject).finally(clearTimeout.bind(null, handle));\n            }) : this;\n    }\n});\nif (typeof Symbol !== 'undefined' && Symbol.toStringTag)\n    setProp(DexiePromise.prototype, Symbol.toStringTag, 'Dexie.Promise');\nglobalPSD.env = snapShot();\nfunction Listener(onFulfilled, onRejected, resolve, reject, zone) {\n    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n    this.resolve = resolve;\n    this.reject = reject;\n    this.psd = zone;\n}\nprops(DexiePromise, {\n    all: function () {\n        var values = getArrayOf.apply(null, arguments)\n            .map(onPossibleParallellAsync);\n        return new DexiePromise(function (resolve, reject) {\n            if (values.length === 0)\n                resolve([]);\n            var remaining = values.length;\n            values.forEach((a, i) => DexiePromise.resolve(a).then(x => {\n                values[i] = x;\n                if (!--remaining)\n                    resolve(values);\n            }, reject));\n        });\n    },\n    resolve: value => {\n        if (value instanceof DexiePromise)\n            return value;\n        if (value && typeof value.then === 'function')\n            return new DexiePromise((resolve, reject) => {\n                value.then(resolve, reject);\n            });\n        var rv = new DexiePromise(INTERNAL, true, value);\n        linkToPreviousPromise(rv, currentFulfiller);\n        return rv;\n    },\n    reject: PromiseReject,\n    race: function () {\n        var values = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n        return new DexiePromise((resolve, reject) => {\n            values.map(value => DexiePromise.resolve(value).then(resolve, reject));\n        });\n    },\n    PSD: {\n        get: () => PSD,\n        set: value => PSD = value\n    },\n    totalEchoes: { get: () => totalEchoes },\n    newPSD: newScope,\n    usePSD: usePSD,\n    scheduler: {\n        get: () => asap,\n        set: value => { asap = value; }\n    },\n    rejectionMapper: {\n        get: () => rejectionMapper,\n        set: value => { rejectionMapper = value; }\n    },\n    follow: (fn, zoneProps) => {\n        return new DexiePromise((resolve, reject) => {\n            return newScope((resolve, reject) => {\n                var psd = PSD;\n                psd.unhandleds = [];\n                psd.onunhandled = reject;\n                psd.finalize = callBoth(function () {\n                    run_at_end_of_this_or_next_physical_tick(() => {\n                        this.unhandleds.length === 0 ? resolve() : reject(this.unhandleds[0]);\n                    });\n                }, psd.finalize);\n                fn();\n            }, zoneProps, resolve, reject);\n        });\n    }\n});\nif (NativePromise) {\n    if (NativePromise.allSettled)\n        setProp(DexiePromise, \"allSettled\", function () {\n            const possiblePromises = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n            return new DexiePromise(resolve => {\n                if (possiblePromises.length === 0)\n                    resolve([]);\n                let remaining = possiblePromises.length;\n                const results = new Array(remaining);\n                possiblePromises.forEach((p, i) => DexiePromise.resolve(p).then(value => results[i] = { status: \"fulfilled\", value }, reason => results[i] = { status: \"rejected\", reason })\n                    .then(() => --remaining || resolve(results)));\n            });\n        });\n    if (NativePromise.any && typeof AggregateError !== 'undefined')\n        setProp(DexiePromise, \"any\", function () {\n            const possiblePromises = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n            return new DexiePromise((resolve, reject) => {\n                if (possiblePromises.length === 0)\n                    reject(new AggregateError([]));\n                let remaining = possiblePromises.length;\n                const failures = new Array(remaining);\n                possiblePromises.forEach((p, i) => DexiePromise.resolve(p).then(value => resolve(value), failure => {\n                    failures[i] = failure;\n                    if (!--remaining)\n                        reject(new AggregateError(failures));\n                }));\n            });\n        });\n}\nfunction executePromiseTask(promise, fn) {\n    try {\n        fn(value => {\n            if (promise._state !== null)\n                return;\n            if (value === promise)\n                throw new TypeError('A promise cannot be resolved with itself.');\n            var shouldExecuteTick = promise._lib && beginMicroTickScope();\n            if (value && typeof value.then === 'function') {\n                executePromiseTask(promise, (resolve, reject) => {\n                    value instanceof DexiePromise ?\n                        value._then(resolve, reject) :\n                        value.then(resolve, reject);\n                });\n            }\n            else {\n                promise._state = true;\n                promise._value = value;\n                propagateAllListeners(promise);\n            }\n            if (shouldExecuteTick)\n                endMicroTickScope();\n        }, handleRejection.bind(null, promise));\n    }\n    catch (ex) {\n        handleRejection(promise, ex);\n    }\n}\nfunction handleRejection(promise, reason) {\n    rejectingErrors.push(reason);\n    if (promise._state !== null)\n        return;\n    var shouldExecuteTick = promise._lib && beginMicroTickScope();\n    reason = rejectionMapper(reason);\n    promise._state = false;\n    promise._value = reason;\n    debug && reason !== null && typeof reason === 'object' && !reason._promise && tryCatch(() => {\n        var origProp = getPropertyDescriptor(reason, \"stack\");\n        reason._promise = promise;\n        setProp(reason, \"stack\", {\n            get: () => stack_being_generated ?\n                origProp && (origProp.get ?\n                    origProp.get.apply(reason) :\n                    origProp.value) :\n                promise.stack\n        });\n    });\n    addPossiblyUnhandledError(promise);\n    propagateAllListeners(promise);\n    if (shouldExecuteTick)\n        endMicroTickScope();\n}\nfunction propagateAllListeners(promise) {\n    var listeners = promise._listeners;\n    promise._listeners = [];\n    for (var i = 0, len = listeners.length; i < len; ++i) {\n        propagateToListener(promise, listeners[i]);\n    }\n    var psd = promise._PSD;\n    --psd.ref || psd.finalize();\n    if (numScheduledCalls === 0) {\n        ++numScheduledCalls;\n        asap(() => {\n            if (--numScheduledCalls === 0)\n                finalizePhysicalTick();\n        }, []);\n    }\n}\nfunction propagateToListener(promise, listener) {\n    if (promise._state === null) {\n        promise._listeners.push(listener);\n        return;\n    }\n    var cb = promise._state ? listener.onFulfilled : listener.onRejected;\n    if (cb === null) {\n        return (promise._state ? listener.resolve : listener.reject)(promise._value);\n    }\n    ++listener.psd.ref;\n    ++numScheduledCalls;\n    asap(callListener, [cb, promise, listener]);\n}\nfunction callListener(cb, promise, listener) {\n    try {\n        currentFulfiller = promise;\n        var ret, value = promise._value;\n        if (promise._state) {\n            ret = cb(value);\n        }\n        else {\n            if (rejectingErrors.length)\n                rejectingErrors = [];\n            ret = cb(value);\n            if (rejectingErrors.indexOf(value) === -1)\n                markErrorAsHandled(promise);\n        }\n        listener.resolve(ret);\n    }\n    catch (e) {\n        listener.reject(e);\n    }\n    finally {\n        currentFulfiller = null;\n        if (--numScheduledCalls === 0)\n            finalizePhysicalTick();\n        --listener.psd.ref || listener.psd.finalize();\n    }\n}\nfunction getStack(promise, stacks, limit) {\n    if (stacks.length === limit)\n        return stacks;\n    var stack = \"\";\n    if (promise._state === false) {\n        var failure = promise._value, errorName, message;\n        if (failure != null) {\n            errorName = failure.name || \"Error\";\n            message = failure.message || failure;\n            stack = prettyStack(failure, 0);\n        }\n        else {\n            errorName = failure;\n            message = \"\";\n        }\n        stacks.push(errorName + (message ? \": \" + message : \"\") + stack);\n    }\n    if (debug) {\n        stack = prettyStack(promise._stackHolder, 2);\n        if (stack && stacks.indexOf(stack) === -1)\n            stacks.push(stack);\n        if (promise._prev)\n            getStack(promise._prev, stacks, limit);\n    }\n    return stacks;\n}\nfunction linkToPreviousPromise(promise, prev) {\n    var numPrev = prev ? prev._numPrev + 1 : 0;\n    if (numPrev < LONG_STACKS_CLIP_LIMIT) {\n        promise._prev = prev;\n        promise._numPrev = numPrev;\n    }\n}\nfunction physicalTick() {\n    beginMicroTickScope() && endMicroTickScope();\n}\nfunction beginMicroTickScope() {\n    var wasRootExec = isOutsideMicroTick;\n    isOutsideMicroTick = false;\n    needsNewPhysicalTick = false;\n    return wasRootExec;\n}\nfunction endMicroTickScope() {\n    var callbacks, i, l;\n    do {\n        while (microtickQueue.length > 0) {\n            callbacks = microtickQueue;\n            microtickQueue = [];\n            l = callbacks.length;\n            for (i = 0; i < l; ++i) {\n                var item = callbacks[i];\n                item[0].apply(null, item[1]);\n            }\n        }\n    } while (microtickQueue.length > 0);\n    isOutsideMicroTick = true;\n    needsNewPhysicalTick = true;\n}\nfunction finalizePhysicalTick() {\n    var unhandledErrs = unhandledErrors;\n    unhandledErrors = [];\n    unhandledErrs.forEach(p => {\n        p._PSD.onunhandled.call(null, p._value, p);\n    });\n    var finalizers = tickFinalizers.slice(0);\n    var i = finalizers.length;\n    while (i)\n        finalizers[--i]();\n}\nfunction run_at_end_of_this_or_next_physical_tick(fn) {\n    function finalizer() {\n        fn();\n        tickFinalizers.splice(tickFinalizers.indexOf(finalizer), 1);\n    }\n    tickFinalizers.push(finalizer);\n    ++numScheduledCalls;\n    asap(() => {\n        if (--numScheduledCalls === 0)\n            finalizePhysicalTick();\n    }, []);\n}\nfunction addPossiblyUnhandledError(promise) {\n    if (!unhandledErrors.some(p => p._value === promise._value))\n        unhandledErrors.push(promise);\n}\nfunction markErrorAsHandled(promise) {\n    var i = unhandledErrors.length;\n    while (i)\n        if (unhandledErrors[--i]._value === promise._value) {\n            unhandledErrors.splice(i, 1);\n            return;\n        }\n}\nfunction PromiseReject(reason) {\n    return new DexiePromise(INTERNAL, false, reason);\n}\nfunction wrap(fn, errorCatcher) {\n    var psd = PSD;\n    return function () {\n        var wasRootExec = beginMicroTickScope(), outerScope = PSD;\n        try {\n            switchToZone(psd, true);\n            return fn.apply(this, arguments);\n        }\n        catch (e) {\n            errorCatcher && errorCatcher(e);\n        }\n        finally {\n            switchToZone(outerScope, false);\n            if (wasRootExec)\n                endMicroTickScope();\n        }\n    };\n}\nconst task = { awaits: 0, echoes: 0, id: 0 };\nvar taskCounter = 0;\nvar zoneStack = [];\nvar zoneEchoes = 0;\nvar totalEchoes = 0;\nvar zone_id_counter = 0;\nfunction newScope(fn, props, a1, a2) {\n    var parent = PSD, psd = Object.create(parent);\n    psd.parent = parent;\n    psd.ref = 0;\n    psd.global = false;\n    psd.id = ++zone_id_counter;\n    var globalEnv = globalPSD.env;\n    psd.env = patchGlobalPromise ? {\n        Promise: DexiePromise,\n        PromiseProp: { value: DexiePromise, configurable: true, writable: true },\n        all: DexiePromise.all,\n        race: DexiePromise.race,\n        allSettled: DexiePromise.allSettled,\n        any: DexiePromise.any,\n        resolve: DexiePromise.resolve,\n        reject: DexiePromise.reject,\n        nthen: getPatchedPromiseThen(globalEnv.nthen, psd),\n        gthen: getPatchedPromiseThen(globalEnv.gthen, psd)\n    } : {};\n    if (props)\n        extend(psd, props);\n    ++parent.ref;\n    psd.finalize = function () {\n        --this.parent.ref || this.parent.finalize();\n    };\n    var rv = usePSD(psd, fn, a1, a2);\n    if (psd.ref === 0)\n        psd.finalize();\n    return rv;\n}\nfunction incrementExpectedAwaits() {\n    if (!task.id)\n        task.id = ++taskCounter;\n    ++task.awaits;\n    task.echoes += ZONE_ECHO_LIMIT;\n    return task.id;\n}\nfunction decrementExpectedAwaits() {\n    if (!task.awaits)\n        return false;\n    if (--task.awaits === 0)\n        task.id = 0;\n    task.echoes = task.awaits * ZONE_ECHO_LIMIT;\n    return true;\n}\nif (('' + nativePromiseThen).indexOf('[native code]') === -1) {\n    incrementExpectedAwaits = decrementExpectedAwaits = nop;\n}\nfunction onPossibleParallellAsync(possiblePromise) {\n    if (task.echoes && possiblePromise && possiblePromise.constructor === NativePromise) {\n        incrementExpectedAwaits();\n        return possiblePromise.then(x => {\n            decrementExpectedAwaits();\n            return x;\n        }, e => {\n            decrementExpectedAwaits();\n            return rejection(e);\n        });\n    }\n    return possiblePromise;\n}\nfunction zoneEnterEcho(targetZone) {\n    ++totalEchoes;\n    if (!task.echoes || --task.echoes === 0) {\n        task.echoes = task.id = 0;\n    }\n    zoneStack.push(PSD);\n    switchToZone(targetZone, true);\n}\nfunction zoneLeaveEcho() {\n    var zone = zoneStack[zoneStack.length - 1];\n    zoneStack.pop();\n    switchToZone(zone, false);\n}\nfunction switchToZone(targetZone, bEnteringZone) {\n    var currentZone = PSD;\n    if (bEnteringZone ? task.echoes && (!zoneEchoes++ || targetZone !== PSD) : zoneEchoes && (!--zoneEchoes || targetZone !== PSD)) {\n        enqueueNativeMicroTask(bEnteringZone ? zoneEnterEcho.bind(null, targetZone) : zoneLeaveEcho);\n    }\n    if (targetZone === PSD)\n        return;\n    PSD = targetZone;\n    if (currentZone === globalPSD)\n        globalPSD.env = snapShot();\n    if (patchGlobalPromise) {\n        var GlobalPromise = globalPSD.env.Promise;\n        var targetEnv = targetZone.env;\n        nativePromiseProto.then = targetEnv.nthen;\n        GlobalPromise.prototype.then = targetEnv.gthen;\n        if (currentZone.global || targetZone.global) {\n            Object.defineProperty(_global, 'Promise', targetEnv.PromiseProp);\n            GlobalPromise.all = targetEnv.all;\n            GlobalPromise.race = targetEnv.race;\n            GlobalPromise.resolve = targetEnv.resolve;\n            GlobalPromise.reject = targetEnv.reject;\n            if (targetEnv.allSettled)\n                GlobalPromise.allSettled = targetEnv.allSettled;\n            if (targetEnv.any)\n                GlobalPromise.any = targetEnv.any;\n        }\n    }\n}\nfunction snapShot() {\n    var GlobalPromise = _global.Promise;\n    return patchGlobalPromise ? {\n        Promise: GlobalPromise,\n        PromiseProp: Object.getOwnPropertyDescriptor(_global, \"Promise\"),\n        all: GlobalPromise.all,\n        race: GlobalPromise.race,\n        allSettled: GlobalPromise.allSettled,\n        any: GlobalPromise.any,\n        resolve: GlobalPromise.resolve,\n        reject: GlobalPromise.reject,\n        nthen: nativePromiseProto.then,\n        gthen: GlobalPromise.prototype.then\n    } : {};\n}\nfunction usePSD(psd, fn, a1, a2, a3) {\n    var outerScope = PSD;\n    try {\n        switchToZone(psd, true);\n        return fn(a1, a2, a3);\n    }\n    finally {\n        switchToZone(outerScope, false);\n    }\n}\nfunction enqueueNativeMicroTask(job) {\n    nativePromiseThen.call(resolvedNativePromise, job);\n}\nfunction nativeAwaitCompatibleWrap(fn, zone, possibleAwait, cleanup) {\n    return typeof fn !== 'function' ? fn : function () {\n        var outerZone = PSD;\n        if (possibleAwait)\n            incrementExpectedAwaits();\n        switchToZone(zone, true);\n        try {\n            return fn.apply(this, arguments);\n        }\n        finally {\n            switchToZone(outerZone, false);\n            if (cleanup)\n                enqueueNativeMicroTask(decrementExpectedAwaits);\n        }\n    };\n}\nfunction getPatchedPromiseThen(origThen, zone) {\n    return function (onResolved, onRejected) {\n        return origThen.call(this, nativeAwaitCompatibleWrap(onResolved, zone), nativeAwaitCompatibleWrap(onRejected, zone));\n    };\n}\nconst UNHANDLEDREJECTION = \"unhandledrejection\";\nfunction globalError(err, promise) {\n    var rv;\n    try {\n        rv = promise.onuncatched(err);\n    }\n    catch (e) { }\n    if (rv !== false)\n        try {\n            var event, eventData = { promise: promise, reason: err };\n            if (_global.document && document.createEvent) {\n                event = document.createEvent('Event');\n                event.initEvent(UNHANDLEDREJECTION, true, true);\n                extend(event, eventData);\n            }\n            else if (_global.CustomEvent) {\n                event = new CustomEvent(UNHANDLEDREJECTION, { detail: eventData });\n                extend(event, eventData);\n            }\n            if (event && _global.dispatchEvent) {\n                dispatchEvent(event);\n                if (!_global.PromiseRejectionEvent && _global.onunhandledrejection)\n                    try {\n                        _global.onunhandledrejection(event);\n                    }\n                    catch (_) { }\n            }\n            if (debug && event && !event.defaultPrevented) {\n                console.warn(`Unhandled rejection: ${err.stack || err}`);\n            }\n        }\n        catch (e) { }\n}\nvar rejection = DexiePromise.reject;\n\nfunction tempTransaction(db, mode, storeNames, fn) {\n    if (!db.idbdb || (!db._state.openComplete && (!PSD.letThrough && !db._vip))) {\n        if (db._state.openComplete) {\n            return rejection(new exceptions.DatabaseClosed(db._state.dbOpenError));\n        }\n        if (!db._state.isBeingOpened) {\n            if (!db._options.autoOpen)\n                return rejection(new exceptions.DatabaseClosed());\n            db.open().catch(nop);\n        }\n        return db._state.dbReadyPromise.then(() => tempTransaction(db, mode, storeNames, fn));\n    }\n    else {\n        var trans = db._createTransaction(mode, storeNames, db._dbSchema);\n        try {\n            trans.create();\n            db._state.PR1398_maxLoop = 3;\n        }\n        catch (ex) {\n            if (ex.name === errnames.InvalidState && db.isOpen() && --db._state.PR1398_maxLoop > 0) {\n                console.warn('Dexie: Need to reopen db');\n                db._close();\n                return db.open().then(() => tempTransaction(db, mode, storeNames, fn));\n            }\n            return rejection(ex);\n        }\n        return trans._promise(mode, (resolve, reject) => {\n            return newScope(() => {\n                PSD.trans = trans;\n                return fn(resolve, reject, trans);\n            });\n        }).then(result => {\n            return trans._completion.then(() => result);\n        });\n    }\n}\n\nconst DEXIE_VERSION = '3.2.2';\nconst maxString = String.fromCharCode(65535);\nconst minKey = -Infinity;\nconst INVALID_KEY_ARGUMENT = \"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.\";\nconst STRING_EXPECTED = \"String expected.\";\nconst connections = [];\nconst isIEOrEdge = typeof navigator !== 'undefined' && /(MSIE|Trident|Edge)/.test(navigator.userAgent);\nconst hasIEDeleteObjectStoreBug = isIEOrEdge;\nconst hangsOnDeleteLargeKeyRange = isIEOrEdge;\nconst dexieStackFrameFilter = frame => !/(dexie\\.js|dexie\\.min\\.js)/.test(frame);\nconst DBNAMES_DB = '__dbnames';\nconst READONLY = 'readonly';\nconst READWRITE = 'readwrite';\n\nfunction combine(filter1, filter2) {\n    return filter1 ?\n        filter2 ?\n            function () { return filter1.apply(this, arguments) && filter2.apply(this, arguments); } :\n            filter1 :\n        filter2;\n}\n\nconst AnyRange = {\n    type: 3 ,\n    lower: -Infinity,\n    lowerOpen: false,\n    upper: [[]],\n    upperOpen: false\n};\n\nfunction workaroundForUndefinedPrimKey(keyPath) {\n    return typeof keyPath === \"string\" && !/\\./.test(keyPath)\n        ? (obj) => {\n            if (obj[keyPath] === undefined && (keyPath in obj)) {\n                obj = deepClone(obj);\n                delete obj[keyPath];\n            }\n            return obj;\n        }\n        : (obj) => obj;\n}\n\nclass Table {\n    _trans(mode, fn, writeLocked) {\n        const trans = this._tx || PSD.trans;\n        const tableName = this.name;\n        function checkTableInTransaction(resolve, reject, trans) {\n            if (!trans.schema[tableName])\n                throw new exceptions.NotFound(\"Table \" + tableName + \" not part of transaction\");\n            return fn(trans.idbtrans, trans);\n        }\n        const wasRootExec = beginMicroTickScope();\n        try {\n            return trans && trans.db === this.db ?\n                trans === PSD.trans ?\n                    trans._promise(mode, checkTableInTransaction, writeLocked) :\n                    newScope(() => trans._promise(mode, checkTableInTransaction, writeLocked), { trans: trans, transless: PSD.transless || PSD }) :\n                tempTransaction(this.db, mode, [this.name], checkTableInTransaction);\n        }\n        finally {\n            if (wasRootExec)\n                endMicroTickScope();\n        }\n    }\n    get(keyOrCrit, cb) {\n        if (keyOrCrit && keyOrCrit.constructor === Object)\n            return this.where(keyOrCrit).first(cb);\n        return this._trans('readonly', (trans) => {\n            return this.core.get({ trans, key: keyOrCrit })\n                .then(res => this.hook.reading.fire(res));\n        }).then(cb);\n    }\n    where(indexOrCrit) {\n        if (typeof indexOrCrit === 'string')\n            return new this.db.WhereClause(this, indexOrCrit);\n        if (isArray(indexOrCrit))\n            return new this.db.WhereClause(this, `[${indexOrCrit.join('+')}]`);\n        const keyPaths = keys(indexOrCrit);\n        if (keyPaths.length === 1)\n            return this\n                .where(keyPaths[0])\n                .equals(indexOrCrit[keyPaths[0]]);\n        const compoundIndex = this.schema.indexes.concat(this.schema.primKey).filter(ix => ix.compound &&\n            keyPaths.every(keyPath => ix.keyPath.indexOf(keyPath) >= 0) &&\n            ix.keyPath.every(keyPath => keyPaths.indexOf(keyPath) >= 0))[0];\n        if (compoundIndex && this.db._maxKey !== maxString)\n            return this\n                .where(compoundIndex.name)\n                .equals(compoundIndex.keyPath.map(kp => indexOrCrit[kp]));\n        if (!compoundIndex && debug)\n            console.warn(`The query ${JSON.stringify(indexOrCrit)} on ${this.name} would benefit of a ` +\n                `compound index [${keyPaths.join('+')}]`);\n        const { idxByName } = this.schema;\n        const idb = this.db._deps.indexedDB;\n        function equals(a, b) {\n            try {\n                return idb.cmp(a, b) === 0;\n            }\n            catch (e) {\n                return false;\n            }\n        }\n        const [idx, filterFunction] = keyPaths.reduce(([prevIndex, prevFilterFn], keyPath) => {\n            const index = idxByName[keyPath];\n            const value = indexOrCrit[keyPath];\n            return [\n                prevIndex || index,\n                prevIndex || !index ?\n                    combine(prevFilterFn, index && index.multi ?\n                        x => {\n                            const prop = getByKeyPath(x, keyPath);\n                            return isArray(prop) && prop.some(item => equals(value, item));\n                        } : x => equals(value, getByKeyPath(x, keyPath)))\n                    : prevFilterFn\n            ];\n        }, [null, null]);\n        return idx ?\n            this.where(idx.name).equals(indexOrCrit[idx.keyPath])\n                .filter(filterFunction) :\n            compoundIndex ?\n                this.filter(filterFunction) :\n                this.where(keyPaths).equals('');\n    }\n    filter(filterFunction) {\n        return this.toCollection().and(filterFunction);\n    }\n    count(thenShortcut) {\n        return this.toCollection().count(thenShortcut);\n    }\n    offset(offset) {\n        return this.toCollection().offset(offset);\n    }\n    limit(numRows) {\n        return this.toCollection().limit(numRows);\n    }\n    each(callback) {\n        return this.toCollection().each(callback);\n    }\n    toArray(thenShortcut) {\n        return this.toCollection().toArray(thenShortcut);\n    }\n    toCollection() {\n        return new this.db.Collection(new this.db.WhereClause(this));\n    }\n    orderBy(index) {\n        return new this.db.Collection(new this.db.WhereClause(this, isArray(index) ?\n            `[${index.join('+')}]` :\n            index));\n    }\n    reverse() {\n        return this.toCollection().reverse();\n    }\n    mapToClass(constructor) {\n        this.schema.mappedClass = constructor;\n        const readHook = obj => {\n            if (!obj)\n                return obj;\n            const res = Object.create(constructor.prototype);\n            for (var m in obj)\n                if (hasOwn(obj, m))\n                    try {\n                        res[m] = obj[m];\n                    }\n                    catch (_) { }\n            return res;\n        };\n        if (this.schema.readHook) {\n            this.hook.reading.unsubscribe(this.schema.readHook);\n        }\n        this.schema.readHook = readHook;\n        this.hook(\"reading\", readHook);\n        return constructor;\n    }\n    defineClass() {\n        function Class(content) {\n            extend(this, content);\n        }\n        return this.mapToClass(Class);\n    }\n    add(obj, key) {\n        const { auto, keyPath } = this.schema.primKey;\n        let objToAdd = obj;\n        if (keyPath && auto) {\n            objToAdd = workaroundForUndefinedPrimKey(keyPath)(obj);\n        }\n        return this._trans('readwrite', trans => {\n            return this.core.mutate({ trans, type: 'add', keys: key != null ? [key] : null, values: [objToAdd] });\n        }).then(res => res.numFailures ? DexiePromise.reject(res.failures[0]) : res.lastResult)\n            .then(lastResult => {\n            if (keyPath) {\n                try {\n                    setByKeyPath(obj, keyPath, lastResult);\n                }\n                catch (_) { }\n            }\n            return lastResult;\n        });\n    }\n    update(keyOrObject, modifications) {\n        if (typeof keyOrObject === 'object' && !isArray(keyOrObject)) {\n            const key = getByKeyPath(keyOrObject, this.schema.primKey.keyPath);\n            if (key === undefined)\n                return rejection(new exceptions.InvalidArgument(\"Given object does not contain its primary key\"));\n            try {\n                if (typeof modifications !== \"function\") {\n                    keys(modifications).forEach(keyPath => {\n                        setByKeyPath(keyOrObject, keyPath, modifications[keyPath]);\n                    });\n                }\n                else {\n                    modifications(keyOrObject, { value: keyOrObject, primKey: key });\n                }\n            }\n            catch (_a) {\n            }\n            return this.where(\":id\").equals(key).modify(modifications);\n        }\n        else {\n            return this.where(\":id\").equals(keyOrObject).modify(modifications);\n        }\n    }\n    put(obj, key) {\n        const { auto, keyPath } = this.schema.primKey;\n        let objToAdd = obj;\n        if (keyPath && auto) {\n            objToAdd = workaroundForUndefinedPrimKey(keyPath)(obj);\n        }\n        return this._trans('readwrite', trans => this.core.mutate({ trans, type: 'put', values: [objToAdd], keys: key != null ? [key] : null }))\n            .then(res => res.numFailures ? DexiePromise.reject(res.failures[0]) : res.lastResult)\n            .then(lastResult => {\n            if (keyPath) {\n                try {\n                    setByKeyPath(obj, keyPath, lastResult);\n                }\n                catch (_) { }\n            }\n            return lastResult;\n        });\n    }\n    delete(key) {\n        return this._trans('readwrite', trans => this.core.mutate({ trans, type: 'delete', keys: [key] }))\n            .then(res => res.numFailures ? DexiePromise.reject(res.failures[0]) : undefined);\n    }\n    clear() {\n        return this._trans('readwrite', trans => this.core.mutate({ trans, type: 'deleteRange', range: AnyRange }))\n            .then(res => res.numFailures ? DexiePromise.reject(res.failures[0]) : undefined);\n    }\n    bulkGet(keys) {\n        return this._trans('readonly', trans => {\n            return this.core.getMany({\n                keys,\n                trans\n            }).then(result => result.map(res => this.hook.reading.fire(res)));\n        });\n    }\n    bulkAdd(objects, keysOrOptions, options) {\n        const keys = Array.isArray(keysOrOptions) ? keysOrOptions : undefined;\n        options = options || (keys ? undefined : keysOrOptions);\n        const wantResults = options ? options.allKeys : undefined;\n        return this._trans('readwrite', trans => {\n            const { auto, keyPath } = this.schema.primKey;\n            if (keyPath && keys)\n                throw new exceptions.InvalidArgument(\"bulkAdd(): keys argument invalid on tables with inbound keys\");\n            if (keys && keys.length !== objects.length)\n                throw new exceptions.InvalidArgument(\"Arguments objects and keys must have the same length\");\n            const numObjects = objects.length;\n            let objectsToAdd = keyPath && auto ?\n                objects.map(workaroundForUndefinedPrimKey(keyPath)) :\n                objects;\n            return this.core.mutate({ trans, type: 'add', keys: keys, values: objectsToAdd, wantResults })\n                .then(({ numFailures, results, lastResult, failures }) => {\n                const result = wantResults ? results : lastResult;\n                if (numFailures === 0)\n                    return result;\n                throw new BulkError(`${this.name}.bulkAdd(): ${numFailures} of ${numObjects} operations failed`, failures);\n            });\n        });\n    }\n    bulkPut(objects, keysOrOptions, options) {\n        const keys = Array.isArray(keysOrOptions) ? keysOrOptions : undefined;\n        options = options || (keys ? undefined : keysOrOptions);\n        const wantResults = options ? options.allKeys : undefined;\n        return this._trans('readwrite', trans => {\n            const { auto, keyPath } = this.schema.primKey;\n            if (keyPath && keys)\n                throw new exceptions.InvalidArgument(\"bulkPut(): keys argument invalid on tables with inbound keys\");\n            if (keys && keys.length !== objects.length)\n                throw new exceptions.InvalidArgument(\"Arguments objects and keys must have the same length\");\n            const numObjects = objects.length;\n            let objectsToPut = keyPath && auto ?\n                objects.map(workaroundForUndefinedPrimKey(keyPath)) :\n                objects;\n            return this.core.mutate({ trans, type: 'put', keys: keys, values: objectsToPut, wantResults })\n                .then(({ numFailures, results, lastResult, failures }) => {\n                const result = wantResults ? results : lastResult;\n                if (numFailures === 0)\n                    return result;\n                throw new BulkError(`${this.name}.bulkPut(): ${numFailures} of ${numObjects} operations failed`, failures);\n            });\n        });\n    }\n    bulkDelete(keys) {\n        const numKeys = keys.length;\n        return this._trans('readwrite', trans => {\n            return this.core.mutate({ trans, type: 'delete', keys: keys });\n        }).then(({ numFailures, lastResult, failures }) => {\n            if (numFailures === 0)\n                return lastResult;\n            throw new BulkError(`${this.name}.bulkDelete(): ${numFailures} of ${numKeys} operations failed`, failures);\n        });\n    }\n}\n\nfunction Events(ctx) {\n    var evs = {};\n    var rv = function (eventName, subscriber) {\n        if (subscriber) {\n            var i = arguments.length, args = new Array(i - 1);\n            while (--i)\n                args[i - 1] = arguments[i];\n            evs[eventName].subscribe.apply(null, args);\n            return ctx;\n        }\n        else if (typeof (eventName) === 'string') {\n            return evs[eventName];\n        }\n    };\n    rv.addEventType = add;\n    for (var i = 1, l = arguments.length; i < l; ++i) {\n        add(arguments[i]);\n    }\n    return rv;\n    function add(eventName, chainFunction, defaultFunction) {\n        if (typeof eventName === 'object')\n            return addConfiguredEvents(eventName);\n        if (!chainFunction)\n            chainFunction = reverseStoppableEventChain;\n        if (!defaultFunction)\n            defaultFunction = nop;\n        var context = {\n            subscribers: [],\n            fire: defaultFunction,\n            subscribe: function (cb) {\n                if (context.subscribers.indexOf(cb) === -1) {\n                    context.subscribers.push(cb);\n                    context.fire = chainFunction(context.fire, cb);\n                }\n            },\n            unsubscribe: function (cb) {\n                context.subscribers = context.subscribers.filter(function (fn) { return fn !== cb; });\n                context.fire = context.subscribers.reduce(chainFunction, defaultFunction);\n            }\n        };\n        evs[eventName] = rv[eventName] = context;\n        return context;\n    }\n    function addConfiguredEvents(cfg) {\n        keys(cfg).forEach(function (eventName) {\n            var args = cfg[eventName];\n            if (isArray(args)) {\n                add(eventName, cfg[eventName][0], cfg[eventName][1]);\n            }\n            else if (args === 'asap') {\n                var context = add(eventName, mirror, function fire() {\n                    var i = arguments.length, args = new Array(i);\n                    while (i--)\n                        args[i] = arguments[i];\n                    context.subscribers.forEach(function (fn) {\n                        asap$1(function fireEvent() {\n                            fn.apply(null, args);\n                        });\n                    });\n                });\n            }\n            else\n                throw new exceptions.InvalidArgument(\"Invalid event config\");\n        });\n    }\n}\n\nfunction makeClassConstructor(prototype, constructor) {\n    derive(constructor).from({ prototype });\n    return constructor;\n}\n\nfunction createTableConstructor(db) {\n    return makeClassConstructor(Table.prototype, function Table(name, tableSchema, trans) {\n        this.db = db;\n        this._tx = trans;\n        this.name = name;\n        this.schema = tableSchema;\n        this.hook = db._allTables[name] ? db._allTables[name].hook : Events(null, {\n            \"creating\": [hookCreatingChain, nop],\n            \"reading\": [pureFunctionChain, mirror],\n            \"updating\": [hookUpdatingChain, nop],\n            \"deleting\": [hookDeletingChain, nop]\n        });\n    });\n}\n\nfunction isPlainKeyRange(ctx, ignoreLimitFilter) {\n    return !(ctx.filter || ctx.algorithm || ctx.or) &&\n        (ignoreLimitFilter ? ctx.justLimit : !ctx.replayFilter);\n}\nfunction addFilter(ctx, fn) {\n    ctx.filter = combine(ctx.filter, fn);\n}\nfunction addReplayFilter(ctx, factory, isLimitFilter) {\n    var curr = ctx.replayFilter;\n    ctx.replayFilter = curr ? () => combine(curr(), factory()) : factory;\n    ctx.justLimit = isLimitFilter && !curr;\n}\nfunction addMatchFilter(ctx, fn) {\n    ctx.isMatch = combine(ctx.isMatch, fn);\n}\nfunction getIndexOrStore(ctx, coreSchema) {\n    if (ctx.isPrimKey)\n        return coreSchema.primaryKey;\n    const index = coreSchema.getIndexByKeyPath(ctx.index);\n    if (!index)\n        throw new exceptions.Schema(\"KeyPath \" + ctx.index + \" on object store \" + coreSchema.name + \" is not indexed\");\n    return index;\n}\nfunction openCursor(ctx, coreTable, trans) {\n    const index = getIndexOrStore(ctx, coreTable.schema);\n    return coreTable.openCursor({\n        trans,\n        values: !ctx.keysOnly,\n        reverse: ctx.dir === 'prev',\n        unique: !!ctx.unique,\n        query: {\n            index,\n            range: ctx.range\n        }\n    });\n}\nfunction iter(ctx, fn, coreTrans, coreTable) {\n    const filter = ctx.replayFilter ? combine(ctx.filter, ctx.replayFilter()) : ctx.filter;\n    if (!ctx.or) {\n        return iterate(openCursor(ctx, coreTable, coreTrans), combine(ctx.algorithm, filter), fn, !ctx.keysOnly && ctx.valueMapper);\n    }\n    else {\n        const set = {};\n        const union = (item, cursor, advance) => {\n            if (!filter || filter(cursor, advance, result => cursor.stop(result), err => cursor.fail(err))) {\n                var primaryKey = cursor.primaryKey;\n                var key = '' + primaryKey;\n                if (key === '[object ArrayBuffer]')\n                    key = '' + new Uint8Array(primaryKey);\n                if (!hasOwn(set, key)) {\n                    set[key] = true;\n                    fn(item, cursor, advance);\n                }\n            }\n        };\n        return Promise.all([\n            ctx.or._iterate(union, coreTrans),\n            iterate(openCursor(ctx, coreTable, coreTrans), ctx.algorithm, union, !ctx.keysOnly && ctx.valueMapper)\n        ]);\n    }\n}\nfunction iterate(cursorPromise, filter, fn, valueMapper) {\n    var mappedFn = valueMapper ? (x, c, a) => fn(valueMapper(x), c, a) : fn;\n    var wrappedFn = wrap(mappedFn);\n    return cursorPromise.then(cursor => {\n        if (cursor) {\n            return cursor.start(() => {\n                var c = () => cursor.continue();\n                if (!filter || filter(cursor, advancer => c = advancer, val => { cursor.stop(val); c = nop; }, e => { cursor.fail(e); c = nop; }))\n                    wrappedFn(cursor.value, cursor, advancer => c = advancer);\n                c();\n            });\n        }\n    });\n}\n\nfunction cmp(a, b) {\n    try {\n        const ta = type(a);\n        const tb = type(b);\n        if (ta !== tb) {\n            if (ta === 'Array')\n                return 1;\n            if (tb === 'Array')\n                return -1;\n            if (ta === 'binary')\n                return 1;\n            if (tb === 'binary')\n                return -1;\n            if (ta === 'string')\n                return 1;\n            if (tb === 'string')\n                return -1;\n            if (ta === 'Date')\n                return 1;\n            if (tb !== 'Date')\n                return NaN;\n            return -1;\n        }\n        switch (ta) {\n            case 'number':\n            case 'Date':\n            case 'string':\n                return a > b ? 1 : a < b ? -1 : 0;\n            case 'binary': {\n                return compareUint8Arrays(getUint8Array(a), getUint8Array(b));\n            }\n            case 'Array':\n                return compareArrays(a, b);\n        }\n    }\n    catch (_a) { }\n    return NaN;\n}\nfunction compareArrays(a, b) {\n    const al = a.length;\n    const bl = b.length;\n    const l = al < bl ? al : bl;\n    for (let i = 0; i < l; ++i) {\n        const res = cmp(a[i], b[i]);\n        if (res !== 0)\n            return res;\n    }\n    return al === bl ? 0 : al < bl ? -1 : 1;\n}\nfunction compareUint8Arrays(a, b) {\n    const al = a.length;\n    const bl = b.length;\n    const l = al < bl ? al : bl;\n    for (let i = 0; i < l; ++i) {\n        if (a[i] !== b[i])\n            return a[i] < b[i] ? -1 : 1;\n    }\n    return al === bl ? 0 : al < bl ? -1 : 1;\n}\nfunction type(x) {\n    const t = typeof x;\n    if (t !== 'object')\n        return t;\n    if (ArrayBuffer.isView(x))\n        return 'binary';\n    const tsTag = toStringTag(x);\n    return tsTag === 'ArrayBuffer' ? 'binary' : tsTag;\n}\nfunction getUint8Array(a) {\n    if (a instanceof Uint8Array)\n        return a;\n    if (ArrayBuffer.isView(a))\n        return new Uint8Array(a.buffer, a.byteOffset, a.byteLength);\n    return new Uint8Array(a);\n}\n\nclass Collection {\n    _read(fn, cb) {\n        var ctx = this._ctx;\n        return ctx.error ?\n            ctx.table._trans(null, rejection.bind(null, ctx.error)) :\n            ctx.table._trans('readonly', fn).then(cb);\n    }\n    _write(fn) {\n        var ctx = this._ctx;\n        return ctx.error ?\n            ctx.table._trans(null, rejection.bind(null, ctx.error)) :\n            ctx.table._trans('readwrite', fn, \"locked\");\n    }\n    _addAlgorithm(fn) {\n        var ctx = this._ctx;\n        ctx.algorithm = combine(ctx.algorithm, fn);\n    }\n    _iterate(fn, coreTrans) {\n        return iter(this._ctx, fn, coreTrans, this._ctx.table.core);\n    }\n    clone(props) {\n        var rv = Object.create(this.constructor.prototype), ctx = Object.create(this._ctx);\n        if (props)\n            extend(ctx, props);\n        rv._ctx = ctx;\n        return rv;\n    }\n    raw() {\n        this._ctx.valueMapper = null;\n        return this;\n    }\n    each(fn) {\n        var ctx = this._ctx;\n        return this._read(trans => iter(ctx, fn, trans, ctx.table.core));\n    }\n    count(cb) {\n        return this._read(trans => {\n            const ctx = this._ctx;\n            const coreTable = ctx.table.core;\n            if (isPlainKeyRange(ctx, true)) {\n                return coreTable.count({\n                    trans,\n                    query: {\n                        index: getIndexOrStore(ctx, coreTable.schema),\n                        range: ctx.range\n                    }\n                }).then(count => Math.min(count, ctx.limit));\n            }\n            else {\n                var count = 0;\n                return iter(ctx, () => { ++count; return false; }, trans, coreTable)\n                    .then(() => count);\n            }\n        }).then(cb);\n    }\n    sortBy(keyPath, cb) {\n        const parts = keyPath.split('.').reverse(), lastPart = parts[0], lastIndex = parts.length - 1;\n        function getval(obj, i) {\n            if (i)\n                return getval(obj[parts[i]], i - 1);\n            return obj[lastPart];\n        }\n        var order = this._ctx.dir === \"next\" ? 1 : -1;\n        function sorter(a, b) {\n            var aVal = getval(a, lastIndex), bVal = getval(b, lastIndex);\n            return aVal < bVal ? -order : aVal > bVal ? order : 0;\n        }\n        return this.toArray(function (a) {\n            return a.sort(sorter);\n        }).then(cb);\n    }\n    toArray(cb) {\n        return this._read(trans => {\n            var ctx = this._ctx;\n            if (ctx.dir === 'next' && isPlainKeyRange(ctx, true) && ctx.limit > 0) {\n                const { valueMapper } = ctx;\n                const index = getIndexOrStore(ctx, ctx.table.core.schema);\n                return ctx.table.core.query({\n                    trans,\n                    limit: ctx.limit,\n                    values: true,\n                    query: {\n                        index,\n                        range: ctx.range\n                    }\n                }).then(({ result }) => valueMapper ? result.map(valueMapper) : result);\n            }\n            else {\n                const a = [];\n                return iter(ctx, item => a.push(item), trans, ctx.table.core).then(() => a);\n            }\n        }, cb);\n    }\n    offset(offset) {\n        var ctx = this._ctx;\n        if (offset <= 0)\n            return this;\n        ctx.offset += offset;\n        if (isPlainKeyRange(ctx)) {\n            addReplayFilter(ctx, () => {\n                var offsetLeft = offset;\n                return (cursor, advance) => {\n                    if (offsetLeft === 0)\n                        return true;\n                    if (offsetLeft === 1) {\n                        --offsetLeft;\n                        return false;\n                    }\n                    advance(() => {\n                        cursor.advance(offsetLeft);\n                        offsetLeft = 0;\n                    });\n                    return false;\n                };\n            });\n        }\n        else {\n            addReplayFilter(ctx, () => {\n                var offsetLeft = offset;\n                return () => (--offsetLeft < 0);\n            });\n        }\n        return this;\n    }\n    limit(numRows) {\n        this._ctx.limit = Math.min(this._ctx.limit, numRows);\n        addReplayFilter(this._ctx, () => {\n            var rowsLeft = numRows;\n            return function (cursor, advance, resolve) {\n                if (--rowsLeft <= 0)\n                    advance(resolve);\n                return rowsLeft >= 0;\n            };\n        }, true);\n        return this;\n    }\n    until(filterFunction, bIncludeStopEntry) {\n        addFilter(this._ctx, function (cursor, advance, resolve) {\n            if (filterFunction(cursor.value)) {\n                advance(resolve);\n                return bIncludeStopEntry;\n            }\n            else {\n                return true;\n            }\n        });\n        return this;\n    }\n    first(cb) {\n        return this.limit(1).toArray(function (a) { return a[0]; }).then(cb);\n    }\n    last(cb) {\n        return this.reverse().first(cb);\n    }\n    filter(filterFunction) {\n        addFilter(this._ctx, function (cursor) {\n            return filterFunction(cursor.value);\n        });\n        addMatchFilter(this._ctx, filterFunction);\n        return this;\n    }\n    and(filter) {\n        return this.filter(filter);\n    }\n    or(indexName) {\n        return new this.db.WhereClause(this._ctx.table, indexName, this);\n    }\n    reverse() {\n        this._ctx.dir = (this._ctx.dir === \"prev\" ? \"next\" : \"prev\");\n        if (this._ondirectionchange)\n            this._ondirectionchange(this._ctx.dir);\n        return this;\n    }\n    desc() {\n        return this.reverse();\n    }\n    eachKey(cb) {\n        var ctx = this._ctx;\n        ctx.keysOnly = !ctx.isMatch;\n        return this.each(function (val, cursor) { cb(cursor.key, cursor); });\n    }\n    eachUniqueKey(cb) {\n        this._ctx.unique = \"unique\";\n        return this.eachKey(cb);\n    }\n    eachPrimaryKey(cb) {\n        var ctx = this._ctx;\n        ctx.keysOnly = !ctx.isMatch;\n        return this.each(function (val, cursor) { cb(cursor.primaryKey, cursor); });\n    }\n    keys(cb) {\n        var ctx = this._ctx;\n        ctx.keysOnly = !ctx.isMatch;\n        var a = [];\n        return this.each(function (item, cursor) {\n            a.push(cursor.key);\n        }).then(function () {\n            return a;\n        }).then(cb);\n    }\n    primaryKeys(cb) {\n        var ctx = this._ctx;\n        if (ctx.dir === 'next' && isPlainKeyRange(ctx, true) && ctx.limit > 0) {\n            return this._read(trans => {\n                var index = getIndexOrStore(ctx, ctx.table.core.schema);\n                return ctx.table.core.query({\n                    trans,\n                    values: false,\n                    limit: ctx.limit,\n                    query: {\n                        index,\n                        range: ctx.range\n                    }\n                });\n            }).then(({ result }) => result).then(cb);\n        }\n        ctx.keysOnly = !ctx.isMatch;\n        var a = [];\n        return this.each(function (item, cursor) {\n            a.push(cursor.primaryKey);\n        }).then(function () {\n            return a;\n        }).then(cb);\n    }\n    uniqueKeys(cb) {\n        this._ctx.unique = \"unique\";\n        return this.keys(cb);\n    }\n    firstKey(cb) {\n        return this.limit(1).keys(function (a) { return a[0]; }).then(cb);\n    }\n    lastKey(cb) {\n        return this.reverse().firstKey(cb);\n    }\n    distinct() {\n        var ctx = this._ctx, idx = ctx.index && ctx.table.schema.idxByName[ctx.index];\n        if (!idx || !idx.multi)\n            return this;\n        var set = {};\n        addFilter(this._ctx, function (cursor) {\n            var strKey = cursor.primaryKey.toString();\n            var found = hasOwn(set, strKey);\n            set[strKey] = true;\n            return !found;\n        });\n        return this;\n    }\n    modify(changes) {\n        var ctx = this._ctx;\n        return this._write(trans => {\n            var modifyer;\n            if (typeof changes === 'function') {\n                modifyer = changes;\n            }\n            else {\n                var keyPaths = keys(changes);\n                var numKeys = keyPaths.length;\n                modifyer = function (item) {\n                    var anythingModified = false;\n                    for (var i = 0; i < numKeys; ++i) {\n                        var keyPath = keyPaths[i], val = changes[keyPath];\n                        if (getByKeyPath(item, keyPath) !== val) {\n                            setByKeyPath(item, keyPath, val);\n                            anythingModified = true;\n                        }\n                    }\n                    return anythingModified;\n                };\n            }\n            const coreTable = ctx.table.core;\n            const { outbound, extractKey } = coreTable.schema.primaryKey;\n            const limit = this.db._options.modifyChunkSize || 200;\n            const totalFailures = [];\n            let successCount = 0;\n            const failedKeys = [];\n            const applyMutateResult = (expectedCount, res) => {\n                const { failures, numFailures } = res;\n                successCount += expectedCount - numFailures;\n                for (let pos of keys(failures)) {\n                    totalFailures.push(failures[pos]);\n                }\n            };\n            return this.clone().primaryKeys().then(keys => {\n                const nextChunk = (offset) => {\n                    const count = Math.min(limit, keys.length - offset);\n                    return coreTable.getMany({\n                        trans,\n                        keys: keys.slice(offset, offset + count),\n                        cache: \"immutable\"\n                    }).then(values => {\n                        const addValues = [];\n                        const putValues = [];\n                        const putKeys = outbound ? [] : null;\n                        const deleteKeys = [];\n                        for (let i = 0; i < count; ++i) {\n                            const origValue = values[i];\n                            const ctx = {\n                                value: deepClone(origValue),\n                                primKey: keys[offset + i]\n                            };\n                            if (modifyer.call(ctx, ctx.value, ctx) !== false) {\n                                if (ctx.value == null) {\n                                    deleteKeys.push(keys[offset + i]);\n                                }\n                                else if (!outbound && cmp(extractKey(origValue), extractKey(ctx.value)) !== 0) {\n                                    deleteKeys.push(keys[offset + i]);\n                                    addValues.push(ctx.value);\n                                }\n                                else {\n                                    putValues.push(ctx.value);\n                                    if (outbound)\n                                        putKeys.push(keys[offset + i]);\n                                }\n                            }\n                        }\n                        const criteria = isPlainKeyRange(ctx) &&\n                            ctx.limit === Infinity &&\n                            (typeof changes !== 'function' || changes === deleteCallback) && {\n                            index: ctx.index,\n                            range: ctx.range\n                        };\n                        return Promise.resolve(addValues.length > 0 &&\n                            coreTable.mutate({ trans, type: 'add', values: addValues })\n                                .then(res => {\n                                for (let pos in res.failures) {\n                                    deleteKeys.splice(parseInt(pos), 1);\n                                }\n                                applyMutateResult(addValues.length, res);\n                            })).then(() => (putValues.length > 0 || (criteria && typeof changes === 'object')) &&\n                            coreTable.mutate({\n                                trans,\n                                type: 'put',\n                                keys: putKeys,\n                                values: putValues,\n                                criteria,\n                                changeSpec: typeof changes !== 'function'\n                                    && changes\n                            }).then(res => applyMutateResult(putValues.length, res))).then(() => (deleteKeys.length > 0 || (criteria && changes === deleteCallback)) &&\n                            coreTable.mutate({\n                                trans,\n                                type: 'delete',\n                                keys: deleteKeys,\n                                criteria\n                            }).then(res => applyMutateResult(deleteKeys.length, res))).then(() => {\n                            return keys.length > offset + count && nextChunk(offset + limit);\n                        });\n                    });\n                };\n                return nextChunk(0).then(() => {\n                    if (totalFailures.length > 0)\n                        throw new ModifyError(\"Error modifying one or more objects\", totalFailures, successCount, failedKeys);\n                    return keys.length;\n                });\n            });\n        });\n    }\n    delete() {\n        var ctx = this._ctx, range = ctx.range;\n        if (isPlainKeyRange(ctx) &&\n            ((ctx.isPrimKey && !hangsOnDeleteLargeKeyRange) || range.type === 3 ))\n         {\n            return this._write(trans => {\n                const { primaryKey } = ctx.table.core.schema;\n                const coreRange = range;\n                return ctx.table.core.count({ trans, query: { index: primaryKey, range: coreRange } }).then(count => {\n                    return ctx.table.core.mutate({ trans, type: 'deleteRange', range: coreRange })\n                        .then(({ failures, lastResult, results, numFailures }) => {\n                        if (numFailures)\n                            throw new ModifyError(\"Could not delete some values\", Object.keys(failures).map(pos => failures[pos]), count - numFailures);\n                        return count - numFailures;\n                    });\n                });\n            });\n        }\n        return this.modify(deleteCallback);\n    }\n}\nconst deleteCallback = (value, ctx) => ctx.value = null;\n\nfunction createCollectionConstructor(db) {\n    return makeClassConstructor(Collection.prototype, function Collection(whereClause, keyRangeGenerator) {\n        this.db = db;\n        let keyRange = AnyRange, error = null;\n        if (keyRangeGenerator)\n            try {\n                keyRange = keyRangeGenerator();\n            }\n            catch (ex) {\n                error = ex;\n            }\n        const whereCtx = whereClause._ctx;\n        const table = whereCtx.table;\n        const readingHook = table.hook.reading.fire;\n        this._ctx = {\n            table: table,\n            index: whereCtx.index,\n            isPrimKey: (!whereCtx.index || (table.schema.primKey.keyPath && whereCtx.index === table.schema.primKey.name)),\n            range: keyRange,\n            keysOnly: false,\n            dir: \"next\",\n            unique: \"\",\n            algorithm: null,\n            filter: null,\n            replayFilter: null,\n            justLimit: true,\n            isMatch: null,\n            offset: 0,\n            limit: Infinity,\n            error: error,\n            or: whereCtx.or,\n            valueMapper: readingHook !== mirror ? readingHook : null\n        };\n    });\n}\n\nfunction simpleCompare(a, b) {\n    return a < b ? -1 : a === b ? 0 : 1;\n}\nfunction simpleCompareReverse(a, b) {\n    return a > b ? -1 : a === b ? 0 : 1;\n}\n\nfunction fail(collectionOrWhereClause, err, T) {\n    var collection = collectionOrWhereClause instanceof WhereClause ?\n        new collectionOrWhereClause.Collection(collectionOrWhereClause) :\n        collectionOrWhereClause;\n    collection._ctx.error = T ? new T(err) : new TypeError(err);\n    return collection;\n}\nfunction emptyCollection(whereClause) {\n    return new whereClause.Collection(whereClause, () => rangeEqual(\"\")).limit(0);\n}\nfunction upperFactory(dir) {\n    return dir === \"next\" ?\n        (s) => s.toUpperCase() :\n        (s) => s.toLowerCase();\n}\nfunction lowerFactory(dir) {\n    return dir === \"next\" ?\n        (s) => s.toLowerCase() :\n        (s) => s.toUpperCase();\n}\nfunction nextCasing(key, lowerKey, upperNeedle, lowerNeedle, cmp, dir) {\n    var length = Math.min(key.length, lowerNeedle.length);\n    var llp = -1;\n    for (var i = 0; i < length; ++i) {\n        var lwrKeyChar = lowerKey[i];\n        if (lwrKeyChar !== lowerNeedle[i]) {\n            if (cmp(key[i], upperNeedle[i]) < 0)\n                return key.substr(0, i) + upperNeedle[i] + upperNeedle.substr(i + 1);\n            if (cmp(key[i], lowerNeedle[i]) < 0)\n                return key.substr(0, i) + lowerNeedle[i] + upperNeedle.substr(i + 1);\n            if (llp >= 0)\n                return key.substr(0, llp) + lowerKey[llp] + upperNeedle.substr(llp + 1);\n            return null;\n        }\n        if (cmp(key[i], lwrKeyChar) < 0)\n            llp = i;\n    }\n    if (length < lowerNeedle.length && dir === \"next\")\n        return key + upperNeedle.substr(key.length);\n    if (length < key.length && dir === \"prev\")\n        return key.substr(0, upperNeedle.length);\n    return (llp < 0 ? null : key.substr(0, llp) + lowerNeedle[llp] + upperNeedle.substr(llp + 1));\n}\nfunction addIgnoreCaseAlgorithm(whereClause, match, needles, suffix) {\n    var upper, lower, compare, upperNeedles, lowerNeedles, direction, nextKeySuffix, needlesLen = needles.length;\n    if (!needles.every(s => typeof s === 'string')) {\n        return fail(whereClause, STRING_EXPECTED);\n    }\n    function initDirection(dir) {\n        upper = upperFactory(dir);\n        lower = lowerFactory(dir);\n        compare = (dir === \"next\" ? simpleCompare : simpleCompareReverse);\n        var needleBounds = needles.map(function (needle) {\n            return { lower: lower(needle), upper: upper(needle) };\n        }).sort(function (a, b) {\n            return compare(a.lower, b.lower);\n        });\n        upperNeedles = needleBounds.map(function (nb) { return nb.upper; });\n        lowerNeedles = needleBounds.map(function (nb) { return nb.lower; });\n        direction = dir;\n        nextKeySuffix = (dir === \"next\" ? \"\" : suffix);\n    }\n    initDirection(\"next\");\n    var c = new whereClause.Collection(whereClause, () => createRange(upperNeedles[0], lowerNeedles[needlesLen - 1] + suffix));\n    c._ondirectionchange = function (direction) {\n        initDirection(direction);\n    };\n    var firstPossibleNeedle = 0;\n    c._addAlgorithm(function (cursor, advance, resolve) {\n        var key = cursor.key;\n        if (typeof key !== 'string')\n            return false;\n        var lowerKey = lower(key);\n        if (match(lowerKey, lowerNeedles, firstPossibleNeedle)) {\n            return true;\n        }\n        else {\n            var lowestPossibleCasing = null;\n            for (var i = firstPossibleNeedle; i < needlesLen; ++i) {\n                var casing = nextCasing(key, lowerKey, upperNeedles[i], lowerNeedles[i], compare, direction);\n                if (casing === null && lowestPossibleCasing === null)\n                    firstPossibleNeedle = i + 1;\n                else if (lowestPossibleCasing === null || compare(lowestPossibleCasing, casing) > 0) {\n                    lowestPossibleCasing = casing;\n                }\n            }\n            if (lowestPossibleCasing !== null) {\n                advance(function () { cursor.continue(lowestPossibleCasing + nextKeySuffix); });\n            }\n            else {\n                advance(resolve);\n            }\n            return false;\n        }\n    });\n    return c;\n}\nfunction createRange(lower, upper, lowerOpen, upperOpen) {\n    return {\n        type: 2 ,\n        lower,\n        upper,\n        lowerOpen,\n        upperOpen\n    };\n}\nfunction rangeEqual(value) {\n    return {\n        type: 1 ,\n        lower: value,\n        upper: value\n    };\n}\n\nclass WhereClause {\n    get Collection() {\n        return this._ctx.table.db.Collection;\n    }\n    between(lower, upper, includeLower, includeUpper) {\n        includeLower = includeLower !== false;\n        includeUpper = includeUpper === true;\n        try {\n            if ((this._cmp(lower, upper) > 0) ||\n                (this._cmp(lower, upper) === 0 && (includeLower || includeUpper) && !(includeLower && includeUpper)))\n                return emptyCollection(this);\n            return new this.Collection(this, () => createRange(lower, upper, !includeLower, !includeUpper));\n        }\n        catch (e) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n    }\n    equals(value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, () => rangeEqual(value));\n    }\n    above(value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, () => createRange(value, undefined, true));\n    }\n    aboveOrEqual(value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, () => createRange(value, undefined, false));\n    }\n    below(value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, () => createRange(undefined, value, false, true));\n    }\n    belowOrEqual(value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, () => createRange(undefined, value));\n    }\n    startsWith(str) {\n        if (typeof str !== 'string')\n            return fail(this, STRING_EXPECTED);\n        return this.between(str, str + maxString, true, true);\n    }\n    startsWithIgnoreCase(str) {\n        if (str === \"\")\n            return this.startsWith(str);\n        return addIgnoreCaseAlgorithm(this, (x, a) => x.indexOf(a[0]) === 0, [str], maxString);\n    }\n    equalsIgnoreCase(str) {\n        return addIgnoreCaseAlgorithm(this, (x, a) => x === a[0], [str], \"\");\n    }\n    anyOfIgnoreCase() {\n        var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (set.length === 0)\n            return emptyCollection(this);\n        return addIgnoreCaseAlgorithm(this, (x, a) => a.indexOf(x) !== -1, set, \"\");\n    }\n    startsWithAnyOfIgnoreCase() {\n        var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (set.length === 0)\n            return emptyCollection(this);\n        return addIgnoreCaseAlgorithm(this, (x, a) => a.some(n => x.indexOf(n) === 0), set, maxString);\n    }\n    anyOf() {\n        const set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        let compare = this._cmp;\n        try {\n            set.sort(compare);\n        }\n        catch (e) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n        if (set.length === 0)\n            return emptyCollection(this);\n        const c = new this.Collection(this, () => createRange(set[0], set[set.length - 1]));\n        c._ondirectionchange = direction => {\n            compare = (direction === \"next\" ?\n                this._ascending :\n                this._descending);\n            set.sort(compare);\n        };\n        let i = 0;\n        c._addAlgorithm((cursor, advance, resolve) => {\n            const key = cursor.key;\n            while (compare(key, set[i]) > 0) {\n                ++i;\n                if (i === set.length) {\n                    advance(resolve);\n                    return false;\n                }\n            }\n            if (compare(key, set[i]) === 0) {\n                return true;\n            }\n            else {\n                advance(() => { cursor.continue(set[i]); });\n                return false;\n            }\n        });\n        return c;\n    }\n    notEqual(value) {\n        return this.inAnyRange([[minKey, value], [value, this.db._maxKey]], { includeLowers: false, includeUppers: false });\n    }\n    noneOf() {\n        const set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (set.length === 0)\n            return new this.Collection(this);\n        try {\n            set.sort(this._ascending);\n        }\n        catch (e) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n        const ranges = set.reduce((res, val) => res ?\n            res.concat([[res[res.length - 1][1], val]]) :\n            [[minKey, val]], null);\n        ranges.push([set[set.length - 1], this.db._maxKey]);\n        return this.inAnyRange(ranges, { includeLowers: false, includeUppers: false });\n    }\n    inAnyRange(ranges, options) {\n        const cmp = this._cmp, ascending = this._ascending, descending = this._descending, min = this._min, max = this._max;\n        if (ranges.length === 0)\n            return emptyCollection(this);\n        if (!ranges.every(range => range[0] !== undefined &&\n            range[1] !== undefined &&\n            ascending(range[0], range[1]) <= 0)) {\n            return fail(this, \"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower\", exceptions.InvalidArgument);\n        }\n        const includeLowers = !options || options.includeLowers !== false;\n        const includeUppers = options && options.includeUppers === true;\n        function addRange(ranges, newRange) {\n            let i = 0, l = ranges.length;\n            for (; i < l; ++i) {\n                const range = ranges[i];\n                if (cmp(newRange[0], range[1]) < 0 && cmp(newRange[1], range[0]) > 0) {\n                    range[0] = min(range[0], newRange[0]);\n                    range[1] = max(range[1], newRange[1]);\n                    break;\n                }\n            }\n            if (i === l)\n                ranges.push(newRange);\n            return ranges;\n        }\n        let sortDirection = ascending;\n        function rangeSorter(a, b) { return sortDirection(a[0], b[0]); }\n        let set;\n        try {\n            set = ranges.reduce(addRange, []);\n            set.sort(rangeSorter);\n        }\n        catch (ex) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n        let rangePos = 0;\n        const keyIsBeyondCurrentEntry = includeUppers ?\n            key => ascending(key, set[rangePos][1]) > 0 :\n            key => ascending(key, set[rangePos][1]) >= 0;\n        const keyIsBeforeCurrentEntry = includeLowers ?\n            key => descending(key, set[rangePos][0]) > 0 :\n            key => descending(key, set[rangePos][0]) >= 0;\n        function keyWithinCurrentRange(key) {\n            return !keyIsBeyondCurrentEntry(key) && !keyIsBeforeCurrentEntry(key);\n        }\n        let checkKey = keyIsBeyondCurrentEntry;\n        const c = new this.Collection(this, () => createRange(set[0][0], set[set.length - 1][1], !includeLowers, !includeUppers));\n        c._ondirectionchange = direction => {\n            if (direction === \"next\") {\n                checkKey = keyIsBeyondCurrentEntry;\n                sortDirection = ascending;\n            }\n            else {\n                checkKey = keyIsBeforeCurrentEntry;\n                sortDirection = descending;\n            }\n            set.sort(rangeSorter);\n        };\n        c._addAlgorithm((cursor, advance, resolve) => {\n            var key = cursor.key;\n            while (checkKey(key)) {\n                ++rangePos;\n                if (rangePos === set.length) {\n                    advance(resolve);\n                    return false;\n                }\n            }\n            if (keyWithinCurrentRange(key)) {\n                return true;\n            }\n            else if (this._cmp(key, set[rangePos][1]) === 0 || this._cmp(key, set[rangePos][0]) === 0) {\n                return false;\n            }\n            else {\n                advance(() => {\n                    if (sortDirection === ascending)\n                        cursor.continue(set[rangePos][0]);\n                    else\n                        cursor.continue(set[rangePos][1]);\n                });\n                return false;\n            }\n        });\n        return c;\n    }\n    startsWithAnyOf() {\n        const set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (!set.every(s => typeof s === 'string')) {\n            return fail(this, \"startsWithAnyOf() only works with strings\");\n        }\n        if (set.length === 0)\n            return emptyCollection(this);\n        return this.inAnyRange(set.map((str) => [str, str + maxString]));\n    }\n}\n\nfunction createWhereClauseConstructor(db) {\n    return makeClassConstructor(WhereClause.prototype, function WhereClause(table, index, orCollection) {\n        this.db = db;\n        this._ctx = {\n            table: table,\n            index: index === \":id\" ? null : index,\n            or: orCollection\n        };\n        const indexedDB = db._deps.indexedDB;\n        if (!indexedDB)\n            throw new exceptions.MissingAPI();\n        this._cmp = this._ascending = indexedDB.cmp.bind(indexedDB);\n        this._descending = (a, b) => indexedDB.cmp(b, a);\n        this._max = (a, b) => indexedDB.cmp(a, b) > 0 ? a : b;\n        this._min = (a, b) => indexedDB.cmp(a, b) < 0 ? a : b;\n        this._IDBKeyRange = db._deps.IDBKeyRange;\n    });\n}\n\nfunction eventRejectHandler(reject) {\n    return wrap(function (event) {\n        preventDefault(event);\n        reject(event.target.error);\n        return false;\n    });\n}\nfunction preventDefault(event) {\n    if (event.stopPropagation)\n        event.stopPropagation();\n    if (event.preventDefault)\n        event.preventDefault();\n}\n\nconst DEXIE_STORAGE_MUTATED_EVENT_NAME = 'storagemutated';\nconst STORAGE_MUTATED_DOM_EVENT_NAME = 'x-storagemutated-1';\nconst globalEvents = Events(null, DEXIE_STORAGE_MUTATED_EVENT_NAME);\n\nclass Transaction {\n    _lock() {\n        assert(!PSD.global);\n        ++this._reculock;\n        if (this._reculock === 1 && !PSD.global)\n            PSD.lockOwnerFor = this;\n        return this;\n    }\n    _unlock() {\n        assert(!PSD.global);\n        if (--this._reculock === 0) {\n            if (!PSD.global)\n                PSD.lockOwnerFor = null;\n            while (this._blockedFuncs.length > 0 && !this._locked()) {\n                var fnAndPSD = this._blockedFuncs.shift();\n                try {\n                    usePSD(fnAndPSD[1], fnAndPSD[0]);\n                }\n                catch (e) { }\n            }\n        }\n        return this;\n    }\n    _locked() {\n        return this._reculock && PSD.lockOwnerFor !== this;\n    }\n    create(idbtrans) {\n        if (!this.mode)\n            return this;\n        const idbdb = this.db.idbdb;\n        const dbOpenError = this.db._state.dbOpenError;\n        assert(!this.idbtrans);\n        if (!idbtrans && !idbdb) {\n            switch (dbOpenError && dbOpenError.name) {\n                case \"DatabaseClosedError\":\n                    throw new exceptions.DatabaseClosed(dbOpenError);\n                case \"MissingAPIError\":\n                    throw new exceptions.MissingAPI(dbOpenError.message, dbOpenError);\n                default:\n                    throw new exceptions.OpenFailed(dbOpenError);\n            }\n        }\n        if (!this.active)\n            throw new exceptions.TransactionInactive();\n        assert(this._completion._state === null);\n        idbtrans = this.idbtrans = idbtrans ||\n            (this.db.core\n                ? this.db.core.transaction(this.storeNames, this.mode, { durability: this.chromeTransactionDurability })\n                : idbdb.transaction(this.storeNames, this.mode, { durability: this.chromeTransactionDurability }));\n        idbtrans.onerror = wrap(ev => {\n            preventDefault(ev);\n            this._reject(idbtrans.error);\n        });\n        idbtrans.onabort = wrap(ev => {\n            preventDefault(ev);\n            this.active && this._reject(new exceptions.Abort(idbtrans.error));\n            this.active = false;\n            this.on(\"abort\").fire(ev);\n        });\n        idbtrans.oncomplete = wrap(() => {\n            this.active = false;\n            this._resolve();\n            if ('mutatedParts' in idbtrans) {\n                globalEvents.storagemutated.fire(idbtrans[\"mutatedParts\"]);\n            }\n        });\n        return this;\n    }\n    _promise(mode, fn, bWriteLock) {\n        if (mode === 'readwrite' && this.mode !== 'readwrite')\n            return rejection(new exceptions.ReadOnly(\"Transaction is readonly\"));\n        if (!this.active)\n            return rejection(new exceptions.TransactionInactive());\n        if (this._locked()) {\n            return new DexiePromise((resolve, reject) => {\n                this._blockedFuncs.push([() => {\n                        this._promise(mode, fn, bWriteLock).then(resolve, reject);\n                    }, PSD]);\n            });\n        }\n        else if (bWriteLock) {\n            return newScope(() => {\n                var p = new DexiePromise((resolve, reject) => {\n                    this._lock();\n                    const rv = fn(resolve, reject, this);\n                    if (rv && rv.then)\n                        rv.then(resolve, reject);\n                });\n                p.finally(() => this._unlock());\n                p._lib = true;\n                return p;\n            });\n        }\n        else {\n            var p = new DexiePromise((resolve, reject) => {\n                var rv = fn(resolve, reject, this);\n                if (rv && rv.then)\n                    rv.then(resolve, reject);\n            });\n            p._lib = true;\n            return p;\n        }\n    }\n    _root() {\n        return this.parent ? this.parent._root() : this;\n    }\n    waitFor(promiseLike) {\n        var root = this._root();\n        const promise = DexiePromise.resolve(promiseLike);\n        if (root._waitingFor) {\n            root._waitingFor = root._waitingFor.then(() => promise);\n        }\n        else {\n            root._waitingFor = promise;\n            root._waitingQueue = [];\n            var store = root.idbtrans.objectStore(root.storeNames[0]);\n            (function spin() {\n                ++root._spinCount;\n                while (root._waitingQueue.length)\n                    (root._waitingQueue.shift())();\n                if (root._waitingFor)\n                    store.get(-Infinity).onsuccess = spin;\n            }());\n        }\n        var currentWaitPromise = root._waitingFor;\n        return new DexiePromise((resolve, reject) => {\n            promise.then(res => root._waitingQueue.push(wrap(resolve.bind(null, res))), err => root._waitingQueue.push(wrap(reject.bind(null, err)))).finally(() => {\n                if (root._waitingFor === currentWaitPromise) {\n                    root._waitingFor = null;\n                }\n            });\n        });\n    }\n    abort() {\n        if (this.active) {\n            this.active = false;\n            if (this.idbtrans)\n                this.idbtrans.abort();\n            this._reject(new exceptions.Abort());\n        }\n    }\n    table(tableName) {\n        const memoizedTables = (this._memoizedTables || (this._memoizedTables = {}));\n        if (hasOwn(memoizedTables, tableName))\n            return memoizedTables[tableName];\n        const tableSchema = this.schema[tableName];\n        if (!tableSchema) {\n            throw new exceptions.NotFound(\"Table \" + tableName + \" not part of transaction\");\n        }\n        const transactionBoundTable = new this.db.Table(tableName, tableSchema, this);\n        transactionBoundTable.core = this.db.core.table(tableName);\n        memoizedTables[tableName] = transactionBoundTable;\n        return transactionBoundTable;\n    }\n}\n\nfunction createTransactionConstructor(db) {\n    return makeClassConstructor(Transaction.prototype, function Transaction(mode, storeNames, dbschema, chromeTransactionDurability, parent) {\n        this.db = db;\n        this.mode = mode;\n        this.storeNames = storeNames;\n        this.schema = dbschema;\n        this.chromeTransactionDurability = chromeTransactionDurability;\n        this.idbtrans = null;\n        this.on = Events(this, \"complete\", \"error\", \"abort\");\n        this.parent = parent || null;\n        this.active = true;\n        this._reculock = 0;\n        this._blockedFuncs = [];\n        this._resolve = null;\n        this._reject = null;\n        this._waitingFor = null;\n        this._waitingQueue = null;\n        this._spinCount = 0;\n        this._completion = new DexiePromise((resolve, reject) => {\n            this._resolve = resolve;\n            this._reject = reject;\n        });\n        this._completion.then(() => {\n            this.active = false;\n            this.on.complete.fire();\n        }, e => {\n            var wasActive = this.active;\n            this.active = false;\n            this.on.error.fire(e);\n            this.parent ?\n                this.parent._reject(e) :\n                wasActive && this.idbtrans && this.idbtrans.abort();\n            return rejection(e);\n        });\n    });\n}\n\nfunction createIndexSpec(name, keyPath, unique, multi, auto, compound, isPrimKey) {\n    return {\n        name,\n        keyPath,\n        unique,\n        multi,\n        auto,\n        compound,\n        src: (unique && !isPrimKey ? '&' : '') + (multi ? '*' : '') + (auto ? \"++\" : \"\") + nameFromKeyPath(keyPath)\n    };\n}\nfunction nameFromKeyPath(keyPath) {\n    return typeof keyPath === 'string' ?\n        keyPath :\n        keyPath ? ('[' + [].join.call(keyPath, '+') + ']') : \"\";\n}\n\nfunction createTableSchema(name, primKey, indexes) {\n    return {\n        name,\n        primKey,\n        indexes,\n        mappedClass: null,\n        idxByName: arrayToObject(indexes, index => [index.name, index])\n    };\n}\n\nfunction safariMultiStoreFix(storeNames) {\n    return storeNames.length === 1 ? storeNames[0] : storeNames;\n}\nlet getMaxKey = (IdbKeyRange) => {\n    try {\n        IdbKeyRange.only([[]]);\n        getMaxKey = () => [[]];\n        return [[]];\n    }\n    catch (e) {\n        getMaxKey = () => maxString;\n        return maxString;\n    }\n};\n\nfunction getKeyExtractor(keyPath) {\n    if (keyPath == null) {\n        return () => undefined;\n    }\n    else if (typeof keyPath === 'string') {\n        return getSinglePathKeyExtractor(keyPath);\n    }\n    else {\n        return obj => getByKeyPath(obj, keyPath);\n    }\n}\nfunction getSinglePathKeyExtractor(keyPath) {\n    const split = keyPath.split('.');\n    if (split.length === 1) {\n        return obj => obj[keyPath];\n    }\n    else {\n        return obj => getByKeyPath(obj, keyPath);\n    }\n}\n\nfunction arrayify(arrayLike) {\n    return [].slice.call(arrayLike);\n}\nlet _id_counter = 0;\nfunction getKeyPathAlias(keyPath) {\n    return keyPath == null ?\n        \":id\" :\n        typeof keyPath === 'string' ?\n            keyPath :\n            `[${keyPath.join('+')}]`;\n}\nfunction createDBCore(db, IdbKeyRange, tmpTrans) {\n    function extractSchema(db, trans) {\n        const tables = arrayify(db.objectStoreNames);\n        return {\n            schema: {\n                name: db.name,\n                tables: tables.map(table => trans.objectStore(table)).map(store => {\n                    const { keyPath, autoIncrement } = store;\n                    const compound = isArray(keyPath);\n                    const outbound = keyPath == null;\n                    const indexByKeyPath = {};\n                    const result = {\n                        name: store.name,\n                        primaryKey: {\n                            name: null,\n                            isPrimaryKey: true,\n                            outbound,\n                            compound,\n                            keyPath,\n                            autoIncrement,\n                            unique: true,\n                            extractKey: getKeyExtractor(keyPath)\n                        },\n                        indexes: arrayify(store.indexNames).map(indexName => store.index(indexName))\n                            .map(index => {\n                            const { name, unique, multiEntry, keyPath } = index;\n                            const compound = isArray(keyPath);\n                            const result = {\n                                name,\n                                compound,\n                                keyPath,\n                                unique,\n                                multiEntry,\n                                extractKey: getKeyExtractor(keyPath)\n                            };\n                            indexByKeyPath[getKeyPathAlias(keyPath)] = result;\n                            return result;\n                        }),\n                        getIndexByKeyPath: (keyPath) => indexByKeyPath[getKeyPathAlias(keyPath)]\n                    };\n                    indexByKeyPath[\":id\"] = result.primaryKey;\n                    if (keyPath != null) {\n                        indexByKeyPath[getKeyPathAlias(keyPath)] = result.primaryKey;\n                    }\n                    return result;\n                })\n            },\n            hasGetAll: tables.length > 0 && ('getAll' in trans.objectStore(tables[0])) &&\n                !(typeof navigator !== 'undefined' && /Safari/.test(navigator.userAgent) &&\n                    !/(Chrome\\/|Edge\\/)/.test(navigator.userAgent) &&\n                    [].concat(navigator.userAgent.match(/Safari\\/(\\d*)/))[1] < 604)\n        };\n    }\n    function makeIDBKeyRange(range) {\n        if (range.type === 3 )\n            return null;\n        if (range.type === 4 )\n            throw new Error(\"Cannot convert never type to IDBKeyRange\");\n        const { lower, upper, lowerOpen, upperOpen } = range;\n        const idbRange = lower === undefined ?\n            upper === undefined ?\n                null :\n                IdbKeyRange.upperBound(upper, !!upperOpen) :\n            upper === undefined ?\n                IdbKeyRange.lowerBound(lower, !!lowerOpen) :\n                IdbKeyRange.bound(lower, upper, !!lowerOpen, !!upperOpen);\n        return idbRange;\n    }\n    function createDbCoreTable(tableSchema) {\n        const tableName = tableSchema.name;\n        function mutate({ trans, type, keys, values, range }) {\n            return new Promise((resolve, reject) => {\n                resolve = wrap(resolve);\n                const store = trans.objectStore(tableName);\n                const outbound = store.keyPath == null;\n                const isAddOrPut = type === \"put\" || type === \"add\";\n                if (!isAddOrPut && type !== 'delete' && type !== 'deleteRange')\n                    throw new Error(\"Invalid operation type: \" + type);\n                const { length } = keys || values || { length: 1 };\n                if (keys && values && keys.length !== values.length) {\n                    throw new Error(\"Given keys array must have same length as given values array.\");\n                }\n                if (length === 0)\n                    return resolve({ numFailures: 0, failures: {}, results: [], lastResult: undefined });\n                let req;\n                const reqs = [];\n                const failures = [];\n                let numFailures = 0;\n                const errorHandler = event => {\n                    ++numFailures;\n                    preventDefault(event);\n                };\n                if (type === 'deleteRange') {\n                    if (range.type === 4 )\n                        return resolve({ numFailures, failures, results: [], lastResult: undefined });\n                    if (range.type === 3 )\n                        reqs.push(req = store.clear());\n                    else\n                        reqs.push(req = store.delete(makeIDBKeyRange(range)));\n                }\n                else {\n                    const [args1, args2] = isAddOrPut ?\n                        outbound ?\n                            [values, keys] :\n                            [values, null] :\n                        [keys, null];\n                    if (isAddOrPut) {\n                        for (let i = 0; i < length; ++i) {\n                            reqs.push(req = (args2 && args2[i] !== undefined ?\n                                store[type](args1[i], args2[i]) :\n                                store[type](args1[i])));\n                            req.onerror = errorHandler;\n                        }\n                    }\n                    else {\n                        for (let i = 0; i < length; ++i) {\n                            reqs.push(req = store[type](args1[i]));\n                            req.onerror = errorHandler;\n                        }\n                    }\n                }\n                const done = event => {\n                    const lastResult = event.target.result;\n                    reqs.forEach((req, i) => req.error != null && (failures[i] = req.error));\n                    resolve({\n                        numFailures,\n                        failures,\n                        results: type === \"delete\" ? keys : reqs.map(req => req.result),\n                        lastResult\n                    });\n                };\n                req.onerror = event => {\n                    errorHandler(event);\n                    done(event);\n                };\n                req.onsuccess = done;\n            });\n        }\n        function openCursor({ trans, values, query, reverse, unique }) {\n            return new Promise((resolve, reject) => {\n                resolve = wrap(resolve);\n                const { index, range } = query;\n                const store = trans.objectStore(tableName);\n                const source = index.isPrimaryKey ?\n                    store :\n                    store.index(index.name);\n                const direction = reverse ?\n                    unique ?\n                        \"prevunique\" :\n                        \"prev\" :\n                    unique ?\n                        \"nextunique\" :\n                        \"next\";\n                const req = values || !('openKeyCursor' in source) ?\n                    source.openCursor(makeIDBKeyRange(range), direction) :\n                    source.openKeyCursor(makeIDBKeyRange(range), direction);\n                req.onerror = eventRejectHandler(reject);\n                req.onsuccess = wrap(ev => {\n                    const cursor = req.result;\n                    if (!cursor) {\n                        resolve(null);\n                        return;\n                    }\n                    cursor.___id = ++_id_counter;\n                    cursor.done = false;\n                    const _cursorContinue = cursor.continue.bind(cursor);\n                    let _cursorContinuePrimaryKey = cursor.continuePrimaryKey;\n                    if (_cursorContinuePrimaryKey)\n                        _cursorContinuePrimaryKey = _cursorContinuePrimaryKey.bind(cursor);\n                    const _cursorAdvance = cursor.advance.bind(cursor);\n                    const doThrowCursorIsNotStarted = () => { throw new Error(\"Cursor not started\"); };\n                    const doThrowCursorIsStopped = () => { throw new Error(\"Cursor not stopped\"); };\n                    cursor.trans = trans;\n                    cursor.stop = cursor.continue = cursor.continuePrimaryKey = cursor.advance = doThrowCursorIsNotStarted;\n                    cursor.fail = wrap(reject);\n                    cursor.next = function () {\n                        let gotOne = 1;\n                        return this.start(() => gotOne-- ? this.continue() : this.stop()).then(() => this);\n                    };\n                    cursor.start = (callback) => {\n                        const iterationPromise = new Promise((resolveIteration, rejectIteration) => {\n                            resolveIteration = wrap(resolveIteration);\n                            req.onerror = eventRejectHandler(rejectIteration);\n                            cursor.fail = rejectIteration;\n                            cursor.stop = value => {\n                                cursor.stop = cursor.continue = cursor.continuePrimaryKey = cursor.advance = doThrowCursorIsStopped;\n                                resolveIteration(value);\n                            };\n                        });\n                        const guardedCallback = () => {\n                            if (req.result) {\n                                try {\n                                    callback();\n                                }\n                                catch (err) {\n                                    cursor.fail(err);\n                                }\n                            }\n                            else {\n                                cursor.done = true;\n                                cursor.start = () => { throw new Error(\"Cursor behind last entry\"); };\n                                cursor.stop();\n                            }\n                        };\n                        req.onsuccess = wrap(ev => {\n                            req.onsuccess = guardedCallback;\n                            guardedCallback();\n                        });\n                        cursor.continue = _cursorContinue;\n                        cursor.continuePrimaryKey = _cursorContinuePrimaryKey;\n                        cursor.advance = _cursorAdvance;\n                        guardedCallback();\n                        return iterationPromise;\n                    };\n                    resolve(cursor);\n                }, reject);\n            });\n        }\n        function query(hasGetAll) {\n            return (request) => {\n                return new Promise((resolve, reject) => {\n                    resolve = wrap(resolve);\n                    const { trans, values, limit, query } = request;\n                    const nonInfinitLimit = limit === Infinity ? undefined : limit;\n                    const { index, range } = query;\n                    const store = trans.objectStore(tableName);\n                    const source = index.isPrimaryKey ? store : store.index(index.name);\n                    const idbKeyRange = makeIDBKeyRange(range);\n                    if (limit === 0)\n                        return resolve({ result: [] });\n                    if (hasGetAll) {\n                        const req = values ?\n                            source.getAll(idbKeyRange, nonInfinitLimit) :\n                            source.getAllKeys(idbKeyRange, nonInfinitLimit);\n                        req.onsuccess = event => resolve({ result: event.target.result });\n                        req.onerror = eventRejectHandler(reject);\n                    }\n                    else {\n                        let count = 0;\n                        const req = values || !('openKeyCursor' in source) ?\n                            source.openCursor(idbKeyRange) :\n                            source.openKeyCursor(idbKeyRange);\n                        const result = [];\n                        req.onsuccess = event => {\n                            const cursor = req.result;\n                            if (!cursor)\n                                return resolve({ result });\n                            result.push(values ? cursor.value : cursor.primaryKey);\n                            if (++count === limit)\n                                return resolve({ result });\n                            cursor.continue();\n                        };\n                        req.onerror = eventRejectHandler(reject);\n                    }\n                });\n            };\n        }\n        return {\n            name: tableName,\n            schema: tableSchema,\n            mutate,\n            getMany({ trans, keys }) {\n                return new Promise((resolve, reject) => {\n                    resolve = wrap(resolve);\n                    const store = trans.objectStore(tableName);\n                    const length = keys.length;\n                    const result = new Array(length);\n                    let keyCount = 0;\n                    let callbackCount = 0;\n                    let req;\n                    const successHandler = event => {\n                        const req = event.target;\n                        if ((result[req._pos] = req.result) != null)\n                            ;\n                        if (++callbackCount === keyCount)\n                            resolve(result);\n                    };\n                    const errorHandler = eventRejectHandler(reject);\n                    for (let i = 0; i < length; ++i) {\n                        const key = keys[i];\n                        if (key != null) {\n                            req = store.get(keys[i]);\n                            req._pos = i;\n                            req.onsuccess = successHandler;\n                            req.onerror = errorHandler;\n                            ++keyCount;\n                        }\n                    }\n                    if (keyCount === 0)\n                        resolve(result);\n                });\n            },\n            get({ trans, key }) {\n                return new Promise((resolve, reject) => {\n                    resolve = wrap(resolve);\n                    const store = trans.objectStore(tableName);\n                    const req = store.get(key);\n                    req.onsuccess = event => resolve(event.target.result);\n                    req.onerror = eventRejectHandler(reject);\n                });\n            },\n            query: query(hasGetAll),\n            openCursor,\n            count({ query, trans }) {\n                const { index, range } = query;\n                return new Promise((resolve, reject) => {\n                    const store = trans.objectStore(tableName);\n                    const source = index.isPrimaryKey ? store : store.index(index.name);\n                    const idbKeyRange = makeIDBKeyRange(range);\n                    const req = idbKeyRange ? source.count(idbKeyRange) : source.count();\n                    req.onsuccess = wrap(ev => resolve(ev.target.result));\n                    req.onerror = eventRejectHandler(reject);\n                });\n            }\n        };\n    }\n    const { schema, hasGetAll } = extractSchema(db, tmpTrans);\n    const tables = schema.tables.map(tableSchema => createDbCoreTable(tableSchema));\n    const tableMap = {};\n    tables.forEach(table => tableMap[table.name] = table);\n    return {\n        stack: \"dbcore\",\n        transaction: db.transaction.bind(db),\n        table(name) {\n            const result = tableMap[name];\n            if (!result)\n                throw new Error(`Table '${name}' not found`);\n            return tableMap[name];\n        },\n        MIN_KEY: -Infinity,\n        MAX_KEY: getMaxKey(IdbKeyRange),\n        schema\n    };\n}\n\nfunction createMiddlewareStack(stackImpl, middlewares) {\n    return middlewares.reduce((down, { create }) => ({ ...down, ...create(down) }), stackImpl);\n}\nfunction createMiddlewareStacks(middlewares, idbdb, { IDBKeyRange, indexedDB }, tmpTrans) {\n    const dbcore = createMiddlewareStack(createDBCore(idbdb, IDBKeyRange, tmpTrans), middlewares.dbcore);\n    return {\n        dbcore\n    };\n}\nfunction generateMiddlewareStacks({ _novip: db }, tmpTrans) {\n    const idbdb = tmpTrans.db;\n    const stacks = createMiddlewareStacks(db._middlewares, idbdb, db._deps, tmpTrans);\n    db.core = stacks.dbcore;\n    db.tables.forEach(table => {\n        const tableName = table.name;\n        if (db.core.schema.tables.some(tbl => tbl.name === tableName)) {\n            table.core = db.core.table(tableName);\n            if (db[tableName] instanceof db.Table) {\n                db[tableName].core = table.core;\n            }\n        }\n    });\n}\n\nfunction setApiOnPlace({ _novip: db }, objs, tableNames, dbschema) {\n    tableNames.forEach(tableName => {\n        const schema = dbschema[tableName];\n        objs.forEach(obj => {\n            const propDesc = getPropertyDescriptor(obj, tableName);\n            if (!propDesc || (\"value\" in propDesc && propDesc.value === undefined)) {\n                if (obj === db.Transaction.prototype || obj instanceof db.Transaction) {\n                    setProp(obj, tableName, {\n                        get() { return this.table(tableName); },\n                        set(value) {\n                            defineProperty(this, tableName, { value, writable: true, configurable: true, enumerable: true });\n                        }\n                    });\n                }\n                else {\n                    obj[tableName] = new db.Table(tableName, schema);\n                }\n            }\n        });\n    });\n}\nfunction removeTablesApi({ _novip: db }, objs) {\n    objs.forEach(obj => {\n        for (let key in obj) {\n            if (obj[key] instanceof db.Table)\n                delete obj[key];\n        }\n    });\n}\nfunction lowerVersionFirst(a, b) {\n    return a._cfg.version - b._cfg.version;\n}\nfunction runUpgraders(db, oldVersion, idbUpgradeTrans, reject) {\n    const globalSchema = db._dbSchema;\n    const trans = db._createTransaction('readwrite', db._storeNames, globalSchema);\n    trans.create(idbUpgradeTrans);\n    trans._completion.catch(reject);\n    const rejectTransaction = trans._reject.bind(trans);\n    const transless = PSD.transless || PSD;\n    newScope(() => {\n        PSD.trans = trans;\n        PSD.transless = transless;\n        if (oldVersion === 0) {\n            keys(globalSchema).forEach(tableName => {\n                createTable(idbUpgradeTrans, tableName, globalSchema[tableName].primKey, globalSchema[tableName].indexes);\n            });\n            generateMiddlewareStacks(db, idbUpgradeTrans);\n            DexiePromise.follow(() => db.on.populate.fire(trans)).catch(rejectTransaction);\n        }\n        else\n            updateTablesAndIndexes(db, oldVersion, trans, idbUpgradeTrans).catch(rejectTransaction);\n    });\n}\nfunction updateTablesAndIndexes({ _novip: db }, oldVersion, trans, idbUpgradeTrans) {\n    const queue = [];\n    const versions = db._versions;\n    let globalSchema = db._dbSchema = buildGlobalSchema(db, db.idbdb, idbUpgradeTrans);\n    let anyContentUpgraderHasRun = false;\n    const versToRun = versions.filter(v => v._cfg.version >= oldVersion);\n    versToRun.forEach(version => {\n        queue.push(() => {\n            const oldSchema = globalSchema;\n            const newSchema = version._cfg.dbschema;\n            adjustToExistingIndexNames(db, oldSchema, idbUpgradeTrans);\n            adjustToExistingIndexNames(db, newSchema, idbUpgradeTrans);\n            globalSchema = db._dbSchema = newSchema;\n            const diff = getSchemaDiff(oldSchema, newSchema);\n            diff.add.forEach(tuple => {\n                createTable(idbUpgradeTrans, tuple[0], tuple[1].primKey, tuple[1].indexes);\n            });\n            diff.change.forEach(change => {\n                if (change.recreate) {\n                    throw new exceptions.Upgrade(\"Not yet support for changing primary key\");\n                }\n                else {\n                    const store = idbUpgradeTrans.objectStore(change.name);\n                    change.add.forEach(idx => addIndex(store, idx));\n                    change.change.forEach(idx => {\n                        store.deleteIndex(idx.name);\n                        addIndex(store, idx);\n                    });\n                    change.del.forEach(idxName => store.deleteIndex(idxName));\n                }\n            });\n            const contentUpgrade = version._cfg.contentUpgrade;\n            if (contentUpgrade && version._cfg.version > oldVersion) {\n                generateMiddlewareStacks(db, idbUpgradeTrans);\n                trans._memoizedTables = {};\n                anyContentUpgraderHasRun = true;\n                let upgradeSchema = shallowClone(newSchema);\n                diff.del.forEach(table => {\n                    upgradeSchema[table] = oldSchema[table];\n                });\n                removeTablesApi(db, [db.Transaction.prototype]);\n                setApiOnPlace(db, [db.Transaction.prototype], keys(upgradeSchema), upgradeSchema);\n                trans.schema = upgradeSchema;\n                const contentUpgradeIsAsync = isAsyncFunction(contentUpgrade);\n                if (contentUpgradeIsAsync) {\n                    incrementExpectedAwaits();\n                }\n                let returnValue;\n                const promiseFollowed = DexiePromise.follow(() => {\n                    returnValue = contentUpgrade(trans);\n                    if (returnValue) {\n                        if (contentUpgradeIsAsync) {\n                            var decrementor = decrementExpectedAwaits.bind(null, null);\n                            returnValue.then(decrementor, decrementor);\n                        }\n                    }\n                });\n                return (returnValue && typeof returnValue.then === 'function' ?\n                    DexiePromise.resolve(returnValue) : promiseFollowed.then(() => returnValue));\n            }\n        });\n        queue.push(idbtrans => {\n            if (!anyContentUpgraderHasRun || !hasIEDeleteObjectStoreBug) {\n                const newSchema = version._cfg.dbschema;\n                deleteRemovedTables(newSchema, idbtrans);\n            }\n            removeTablesApi(db, [db.Transaction.prototype]);\n            setApiOnPlace(db, [db.Transaction.prototype], db._storeNames, db._dbSchema);\n            trans.schema = db._dbSchema;\n        });\n    });\n    function runQueue() {\n        return queue.length ? DexiePromise.resolve(queue.shift()(trans.idbtrans)).then(runQueue) :\n            DexiePromise.resolve();\n    }\n    return runQueue().then(() => {\n        createMissingTables(globalSchema, idbUpgradeTrans);\n    });\n}\nfunction getSchemaDiff(oldSchema, newSchema) {\n    const diff = {\n        del: [],\n        add: [],\n        change: []\n    };\n    let table;\n    for (table in oldSchema) {\n        if (!newSchema[table])\n            diff.del.push(table);\n    }\n    for (table in newSchema) {\n        const oldDef = oldSchema[table], newDef = newSchema[table];\n        if (!oldDef) {\n            diff.add.push([table, newDef]);\n        }\n        else {\n            const change = {\n                name: table,\n                def: newDef,\n                recreate: false,\n                del: [],\n                add: [],\n                change: []\n            };\n            if ((\n            '' + (oldDef.primKey.keyPath || '')) !== ('' + (newDef.primKey.keyPath || '')) ||\n                (oldDef.primKey.auto !== newDef.primKey.auto && !isIEOrEdge))\n             {\n                change.recreate = true;\n                diff.change.push(change);\n            }\n            else {\n                const oldIndexes = oldDef.idxByName;\n                const newIndexes = newDef.idxByName;\n                let idxName;\n                for (idxName in oldIndexes) {\n                    if (!newIndexes[idxName])\n                        change.del.push(idxName);\n                }\n                for (idxName in newIndexes) {\n                    const oldIdx = oldIndexes[idxName], newIdx = newIndexes[idxName];\n                    if (!oldIdx)\n                        change.add.push(newIdx);\n                    else if (oldIdx.src !== newIdx.src)\n                        change.change.push(newIdx);\n                }\n                if (change.del.length > 0 || change.add.length > 0 || change.change.length > 0) {\n                    diff.change.push(change);\n                }\n            }\n        }\n    }\n    return diff;\n}\nfunction createTable(idbtrans, tableName, primKey, indexes) {\n    const store = idbtrans.db.createObjectStore(tableName, primKey.keyPath ?\n        { keyPath: primKey.keyPath, autoIncrement: primKey.auto } :\n        { autoIncrement: primKey.auto });\n    indexes.forEach(idx => addIndex(store, idx));\n    return store;\n}\nfunction createMissingTables(newSchema, idbtrans) {\n    keys(newSchema).forEach(tableName => {\n        if (!idbtrans.db.objectStoreNames.contains(tableName)) {\n            createTable(idbtrans, tableName, newSchema[tableName].primKey, newSchema[tableName].indexes);\n        }\n    });\n}\nfunction deleteRemovedTables(newSchema, idbtrans) {\n    [].slice.call(idbtrans.db.objectStoreNames).forEach(storeName => newSchema[storeName] == null && idbtrans.db.deleteObjectStore(storeName));\n}\nfunction addIndex(store, idx) {\n    store.createIndex(idx.name, idx.keyPath, { unique: idx.unique, multiEntry: idx.multi });\n}\nfunction buildGlobalSchema(db, idbdb, tmpTrans) {\n    const globalSchema = {};\n    const dbStoreNames = slice(idbdb.objectStoreNames, 0);\n    dbStoreNames.forEach(storeName => {\n        const store = tmpTrans.objectStore(storeName);\n        let keyPath = store.keyPath;\n        const primKey = createIndexSpec(nameFromKeyPath(keyPath), keyPath || \"\", false, false, !!store.autoIncrement, keyPath && typeof keyPath !== \"string\", true);\n        const indexes = [];\n        for (let j = 0; j < store.indexNames.length; ++j) {\n            const idbindex = store.index(store.indexNames[j]);\n            keyPath = idbindex.keyPath;\n            var index = createIndexSpec(idbindex.name, keyPath, !!idbindex.unique, !!idbindex.multiEntry, false, keyPath && typeof keyPath !== \"string\", false);\n            indexes.push(index);\n        }\n        globalSchema[storeName] = createTableSchema(storeName, primKey, indexes);\n    });\n    return globalSchema;\n}\nfunction readGlobalSchema({ _novip: db }, idbdb, tmpTrans) {\n    db.verno = idbdb.version / 10;\n    const globalSchema = db._dbSchema = buildGlobalSchema(db, idbdb, tmpTrans);\n    db._storeNames = slice(idbdb.objectStoreNames, 0);\n    setApiOnPlace(db, [db._allTables], keys(globalSchema), globalSchema);\n}\nfunction verifyInstalledSchema(db, tmpTrans) {\n    const installedSchema = buildGlobalSchema(db, db.idbdb, tmpTrans);\n    const diff = getSchemaDiff(installedSchema, db._dbSchema);\n    return !(diff.add.length || diff.change.some(ch => ch.add.length || ch.change.length));\n}\nfunction adjustToExistingIndexNames({ _novip: db }, schema, idbtrans) {\n    const storeNames = idbtrans.db.objectStoreNames;\n    for (let i = 0; i < storeNames.length; ++i) {\n        const storeName = storeNames[i];\n        const store = idbtrans.objectStore(storeName);\n        db._hasGetAll = 'getAll' in store;\n        for (let j = 0; j < store.indexNames.length; ++j) {\n            const indexName = store.indexNames[j];\n            const keyPath = store.index(indexName).keyPath;\n            const dexieName = typeof keyPath === 'string' ? keyPath : \"[\" + slice(keyPath).join('+') + \"]\";\n            if (schema[storeName]) {\n                const indexSpec = schema[storeName].idxByName[dexieName];\n                if (indexSpec) {\n                    indexSpec.name = indexName;\n                    delete schema[storeName].idxByName[dexieName];\n                    schema[storeName].idxByName[indexName] = indexSpec;\n                }\n            }\n        }\n    }\n    if (typeof navigator !== 'undefined' && /Safari/.test(navigator.userAgent) &&\n        !/(Chrome\\/|Edge\\/)/.test(navigator.userAgent) &&\n        _global.WorkerGlobalScope && _global instanceof _global.WorkerGlobalScope &&\n        [].concat(navigator.userAgent.match(/Safari\\/(\\d*)/))[1] < 604) {\n        db._hasGetAll = false;\n    }\n}\nfunction parseIndexSyntax(primKeyAndIndexes) {\n    return primKeyAndIndexes.split(',').map((index, indexNum) => {\n        index = index.trim();\n        const name = index.replace(/([&*]|\\+\\+)/g, \"\");\n        const keyPath = /^\\[/.test(name) ? name.match(/^\\[(.*)\\]$/)[1].split('+') : name;\n        return createIndexSpec(name, keyPath || null, /\\&/.test(index), /\\*/.test(index), /\\+\\+/.test(index), isArray(keyPath), indexNum === 0);\n    });\n}\n\nclass Version {\n    _parseStoresSpec(stores, outSchema) {\n        keys(stores).forEach(tableName => {\n            if (stores[tableName] !== null) {\n                var indexes = parseIndexSyntax(stores[tableName]);\n                var primKey = indexes.shift();\n                if (primKey.multi)\n                    throw new exceptions.Schema(\"Primary key cannot be multi-valued\");\n                indexes.forEach(idx => {\n                    if (idx.auto)\n                        throw new exceptions.Schema(\"Only primary key can be marked as autoIncrement (++)\");\n                    if (!idx.keyPath)\n                        throw new exceptions.Schema(\"Index must have a name and cannot be an empty string\");\n                });\n                outSchema[tableName] = createTableSchema(tableName, primKey, indexes);\n            }\n        });\n    }\n    stores(stores) {\n        const db = this.db;\n        this._cfg.storesSource = this._cfg.storesSource ?\n            extend(this._cfg.storesSource, stores) :\n            stores;\n        const versions = db._versions;\n        const storesSpec = {};\n        let dbschema = {};\n        versions.forEach(version => {\n            extend(storesSpec, version._cfg.storesSource);\n            dbschema = (version._cfg.dbschema = {});\n            version._parseStoresSpec(storesSpec, dbschema);\n        });\n        db._dbSchema = dbschema;\n        removeTablesApi(db, [db._allTables, db, db.Transaction.prototype]);\n        setApiOnPlace(db, [db._allTables, db, db.Transaction.prototype, this._cfg.tables], keys(dbschema), dbschema);\n        db._storeNames = keys(dbschema);\n        return this;\n    }\n    upgrade(upgradeFunction) {\n        this._cfg.contentUpgrade = promisableChain(this._cfg.contentUpgrade || nop, upgradeFunction);\n        return this;\n    }\n}\n\nfunction createVersionConstructor(db) {\n    return makeClassConstructor(Version.prototype, function Version(versionNumber) {\n        this.db = db;\n        this._cfg = {\n            version: versionNumber,\n            storesSource: null,\n            dbschema: {},\n            tables: {},\n            contentUpgrade: null\n        };\n    });\n}\n\nfunction getDbNamesTable(indexedDB, IDBKeyRange) {\n    let dbNamesDB = indexedDB[\"_dbNamesDB\"];\n    if (!dbNamesDB) {\n        dbNamesDB = indexedDB[\"_dbNamesDB\"] = new Dexie$1(DBNAMES_DB, {\n            addons: [],\n            indexedDB,\n            IDBKeyRange,\n        });\n        dbNamesDB.version(1).stores({ dbnames: \"name\" });\n    }\n    return dbNamesDB.table(\"dbnames\");\n}\nfunction hasDatabasesNative(indexedDB) {\n    return indexedDB && typeof indexedDB.databases === \"function\";\n}\nfunction getDatabaseNames({ indexedDB, IDBKeyRange, }) {\n    return hasDatabasesNative(indexedDB)\n        ? Promise.resolve(indexedDB.databases()).then((infos) => infos\n            .map((info) => info.name)\n            .filter((name) => name !== DBNAMES_DB))\n        : getDbNamesTable(indexedDB, IDBKeyRange).toCollection().primaryKeys();\n}\nfunction _onDatabaseCreated({ indexedDB, IDBKeyRange }, name) {\n    !hasDatabasesNative(indexedDB) &&\n        name !== DBNAMES_DB &&\n        getDbNamesTable(indexedDB, IDBKeyRange).put({ name }).catch(nop);\n}\nfunction _onDatabaseDeleted({ indexedDB, IDBKeyRange }, name) {\n    !hasDatabasesNative(indexedDB) &&\n        name !== DBNAMES_DB &&\n        getDbNamesTable(indexedDB, IDBKeyRange).delete(name).catch(nop);\n}\n\nfunction vip(fn) {\n    return newScope(function () {\n        PSD.letThrough = true;\n        return fn();\n    });\n}\n\nfunction idbReady() {\n    var isSafari = !navigator.userAgentData &&\n        /Safari\\//.test(navigator.userAgent) &&\n        !/Chrom(e|ium)\\//.test(navigator.userAgent);\n    if (!isSafari || !indexedDB.databases)\n        return Promise.resolve();\n    var intervalId;\n    return new Promise(function (resolve) {\n        var tryIdb = function () { return indexedDB.databases().finally(resolve); };\n        intervalId = setInterval(tryIdb, 100);\n        tryIdb();\n    }).finally(function () { return clearInterval(intervalId); });\n}\n\nfunction dexieOpen(db) {\n    const state = db._state;\n    const { indexedDB } = db._deps;\n    if (state.isBeingOpened || db.idbdb)\n        return state.dbReadyPromise.then(() => state.dbOpenError ?\n            rejection(state.dbOpenError) :\n            db);\n    debug && (state.openCanceller._stackHolder = getErrorWithStack());\n    state.isBeingOpened = true;\n    state.dbOpenError = null;\n    state.openComplete = false;\n    const openCanceller = state.openCanceller;\n    function throwIfCancelled() {\n        if (state.openCanceller !== openCanceller)\n            throw new exceptions.DatabaseClosed('db.open() was cancelled');\n    }\n    let resolveDbReady = state.dbReadyResolve,\n    upgradeTransaction = null, wasCreated = false;\n    return DexiePromise.race([openCanceller, (typeof navigator === 'undefined' ? DexiePromise.resolve() : idbReady()).then(() => new DexiePromise((resolve, reject) => {\n            throwIfCancelled();\n            if (!indexedDB)\n                throw new exceptions.MissingAPI();\n            const dbName = db.name;\n            const req = state.autoSchema ?\n                indexedDB.open(dbName) :\n                indexedDB.open(dbName, Math.round(db.verno * 10));\n            if (!req)\n                throw new exceptions.MissingAPI();\n            req.onerror = eventRejectHandler(reject);\n            req.onblocked = wrap(db._fireOnBlocked);\n            req.onupgradeneeded = wrap(e => {\n                upgradeTransaction = req.transaction;\n                if (state.autoSchema && !db._options.allowEmptyDB) {\n                    req.onerror = preventDefault;\n                    upgradeTransaction.abort();\n                    req.result.close();\n                    const delreq = indexedDB.deleteDatabase(dbName);\n                    delreq.onsuccess = delreq.onerror = wrap(() => {\n                        reject(new exceptions.NoSuchDatabase(`Database ${dbName} doesnt exist`));\n                    });\n                }\n                else {\n                    upgradeTransaction.onerror = eventRejectHandler(reject);\n                    var oldVer = e.oldVersion > Math.pow(2, 62) ? 0 : e.oldVersion;\n                    wasCreated = oldVer < 1;\n                    db._novip.idbdb = req.result;\n                    runUpgraders(db, oldVer / 10, upgradeTransaction, reject);\n                }\n            }, reject);\n            req.onsuccess = wrap(() => {\n                upgradeTransaction = null;\n                const idbdb = db._novip.idbdb = req.result;\n                const objectStoreNames = slice(idbdb.objectStoreNames);\n                if (objectStoreNames.length > 0)\n                    try {\n                        const tmpTrans = idbdb.transaction(safariMultiStoreFix(objectStoreNames), 'readonly');\n                        if (state.autoSchema)\n                            readGlobalSchema(db, idbdb, tmpTrans);\n                        else {\n                            adjustToExistingIndexNames(db, db._dbSchema, tmpTrans);\n                            if (!verifyInstalledSchema(db, tmpTrans)) {\n                                console.warn(`Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.`);\n                            }\n                        }\n                        generateMiddlewareStacks(db, tmpTrans);\n                    }\n                    catch (e) {\n                    }\n                connections.push(db);\n                idbdb.onversionchange = wrap(ev => {\n                    state.vcFired = true;\n                    db.on(\"versionchange\").fire(ev);\n                });\n                idbdb.onclose = wrap(ev => {\n                    db.on(\"close\").fire(ev);\n                });\n                if (wasCreated)\n                    _onDatabaseCreated(db._deps, dbName);\n                resolve();\n            }, reject);\n        }))]).then(() => {\n        throwIfCancelled();\n        state.onReadyBeingFired = [];\n        return DexiePromise.resolve(vip(() => db.on.ready.fire(db.vip))).then(function fireRemainders() {\n            if (state.onReadyBeingFired.length > 0) {\n                let remainders = state.onReadyBeingFired.reduce(promisableChain, nop);\n                state.onReadyBeingFired = [];\n                return DexiePromise.resolve(vip(() => remainders(db.vip))).then(fireRemainders);\n            }\n        });\n    }).finally(() => {\n        state.onReadyBeingFired = null;\n        state.isBeingOpened = false;\n    }).then(() => {\n        return db;\n    }).catch(err => {\n        state.dbOpenError = err;\n        try {\n            upgradeTransaction && upgradeTransaction.abort();\n        }\n        catch (_a) { }\n        if (openCanceller === state.openCanceller) {\n            db._close();\n        }\n        return rejection(err);\n    }).finally(() => {\n        state.openComplete = true;\n        resolveDbReady();\n    });\n}\n\nfunction awaitIterator(iterator) {\n    var callNext = result => iterator.next(result), doThrow = error => iterator.throw(error), onSuccess = step(callNext), onError = step(doThrow);\n    function step(getNext) {\n        return (val) => {\n            var next = getNext(val), value = next.value;\n            return next.done ? value :\n                (!value || typeof value.then !== 'function' ?\n                    isArray(value) ? Promise.all(value).then(onSuccess, onError) : onSuccess(value) :\n                    value.then(onSuccess, onError));\n        };\n    }\n    return step(callNext)();\n}\n\nfunction extractTransactionArgs(mode, _tableArgs_, scopeFunc) {\n    var i = arguments.length;\n    if (i < 2)\n        throw new exceptions.InvalidArgument(\"Too few arguments\");\n    var args = new Array(i - 1);\n    while (--i)\n        args[i - 1] = arguments[i];\n    scopeFunc = args.pop();\n    var tables = flatten(args);\n    return [mode, tables, scopeFunc];\n}\nfunction enterTransactionScope(db, mode, storeNames, parentTransaction, scopeFunc) {\n    return DexiePromise.resolve().then(() => {\n        const transless = PSD.transless || PSD;\n        const trans = db._createTransaction(mode, storeNames, db._dbSchema, parentTransaction);\n        const zoneProps = {\n            trans: trans,\n            transless: transless\n        };\n        if (parentTransaction) {\n            trans.idbtrans = parentTransaction.idbtrans;\n        }\n        else {\n            try {\n                trans.create();\n                db._state.PR1398_maxLoop = 3;\n            }\n            catch (ex) {\n                if (ex.name === errnames.InvalidState && db.isOpen() && --db._state.PR1398_maxLoop > 0) {\n                    console.warn('Dexie: Need to reopen db');\n                    db._close();\n                    return db.open().then(() => enterTransactionScope(db, mode, storeNames, null, scopeFunc));\n                }\n                return rejection(ex);\n            }\n        }\n        const scopeFuncIsAsync = isAsyncFunction(scopeFunc);\n        if (scopeFuncIsAsync) {\n            incrementExpectedAwaits();\n        }\n        let returnValue;\n        const promiseFollowed = DexiePromise.follow(() => {\n            returnValue = scopeFunc.call(trans, trans);\n            if (returnValue) {\n                if (scopeFuncIsAsync) {\n                    var decrementor = decrementExpectedAwaits.bind(null, null);\n                    returnValue.then(decrementor, decrementor);\n                }\n                else if (typeof returnValue.next === 'function' && typeof returnValue.throw === 'function') {\n                    returnValue = awaitIterator(returnValue);\n                }\n            }\n        }, zoneProps);\n        return (returnValue && typeof returnValue.then === 'function' ?\n            DexiePromise.resolve(returnValue).then(x => trans.active ?\n                x\n                : rejection(new exceptions.PrematureCommit(\"Transaction committed too early. See http://bit.ly/2kdckMn\")))\n            : promiseFollowed.then(() => returnValue)).then(x => {\n            if (parentTransaction)\n                trans._resolve();\n            return trans._completion.then(() => x);\n        }).catch(e => {\n            trans._reject(e);\n            return rejection(e);\n        });\n    });\n}\n\nfunction pad(a, value, count) {\n    const result = isArray(a) ? a.slice() : [a];\n    for (let i = 0; i < count; ++i)\n        result.push(value);\n    return result;\n}\nfunction createVirtualIndexMiddleware(down) {\n    return {\n        ...down,\n        table(tableName) {\n            const table = down.table(tableName);\n            const { schema } = table;\n            const indexLookup = {};\n            const allVirtualIndexes = [];\n            function addVirtualIndexes(keyPath, keyTail, lowLevelIndex) {\n                const keyPathAlias = getKeyPathAlias(keyPath);\n                const indexList = (indexLookup[keyPathAlias] = indexLookup[keyPathAlias] || []);\n                const keyLength = keyPath == null ? 0 : typeof keyPath === 'string' ? 1 : keyPath.length;\n                const isVirtual = keyTail > 0;\n                const virtualIndex = {\n                    ...lowLevelIndex,\n                    isVirtual,\n                    keyTail,\n                    keyLength,\n                    extractKey: getKeyExtractor(keyPath),\n                    unique: !isVirtual && lowLevelIndex.unique\n                };\n                indexList.push(virtualIndex);\n                if (!virtualIndex.isPrimaryKey) {\n                    allVirtualIndexes.push(virtualIndex);\n                }\n                if (keyLength > 1) {\n                    const virtualKeyPath = keyLength === 2 ?\n                        keyPath[0] :\n                        keyPath.slice(0, keyLength - 1);\n                    addVirtualIndexes(virtualKeyPath, keyTail + 1, lowLevelIndex);\n                }\n                indexList.sort((a, b) => a.keyTail - b.keyTail);\n                return virtualIndex;\n            }\n            const primaryKey = addVirtualIndexes(schema.primaryKey.keyPath, 0, schema.primaryKey);\n            indexLookup[\":id\"] = [primaryKey];\n            for (const index of schema.indexes) {\n                addVirtualIndexes(index.keyPath, 0, index);\n            }\n            function findBestIndex(keyPath) {\n                const result = indexLookup[getKeyPathAlias(keyPath)];\n                return result && result[0];\n            }\n            function translateRange(range, keyTail) {\n                return {\n                    type: range.type === 1  ?\n                        2  :\n                        range.type,\n                    lower: pad(range.lower, range.lowerOpen ? down.MAX_KEY : down.MIN_KEY, keyTail),\n                    lowerOpen: true,\n                    upper: pad(range.upper, range.upperOpen ? down.MIN_KEY : down.MAX_KEY, keyTail),\n                    upperOpen: true\n                };\n            }\n            function translateRequest(req) {\n                const index = req.query.index;\n                return index.isVirtual ? {\n                    ...req,\n                    query: {\n                        index,\n                        range: translateRange(req.query.range, index.keyTail)\n                    }\n                } : req;\n            }\n            const result = {\n                ...table,\n                schema: {\n                    ...schema,\n                    primaryKey,\n                    indexes: allVirtualIndexes,\n                    getIndexByKeyPath: findBestIndex\n                },\n                count(req) {\n                    return table.count(translateRequest(req));\n                },\n                query(req) {\n                    return table.query(translateRequest(req));\n                },\n                openCursor(req) {\n                    const { keyTail, isVirtual, keyLength } = req.query.index;\n                    if (!isVirtual)\n                        return table.openCursor(req);\n                    function createVirtualCursor(cursor) {\n                        function _continue(key) {\n                            key != null ?\n                                cursor.continue(pad(key, req.reverse ? down.MAX_KEY : down.MIN_KEY, keyTail)) :\n                                req.unique ?\n                                    cursor.continue(cursor.key.slice(0, keyLength)\n                                        .concat(req.reverse\n                                        ? down.MIN_KEY\n                                        : down.MAX_KEY, keyTail)) :\n                                    cursor.continue();\n                        }\n                        const virtualCursor = Object.create(cursor, {\n                            continue: { value: _continue },\n                            continuePrimaryKey: {\n                                value(key, primaryKey) {\n                                    cursor.continuePrimaryKey(pad(key, down.MAX_KEY, keyTail), primaryKey);\n                                }\n                            },\n                            primaryKey: {\n                                get() {\n                                    return cursor.primaryKey;\n                                }\n                            },\n                            key: {\n                                get() {\n                                    const key = cursor.key;\n                                    return keyLength === 1 ?\n                                        key[0] :\n                                        key.slice(0, keyLength);\n                                }\n                            },\n                            value: {\n                                get() {\n                                    return cursor.value;\n                                }\n                            }\n                        });\n                        return virtualCursor;\n                    }\n                    return table.openCursor(translateRequest(req))\n                        .then(cursor => cursor && createVirtualCursor(cursor));\n                }\n            };\n            return result;\n        }\n    };\n}\nconst virtualIndexMiddleware = {\n    stack: \"dbcore\",\n    name: \"VirtualIndexMiddleware\",\n    level: 1,\n    create: createVirtualIndexMiddleware\n};\n\nfunction getObjectDiff(a, b, rv, prfx) {\n    rv = rv || {};\n    prfx = prfx || '';\n    keys(a).forEach((prop) => {\n        if (!hasOwn(b, prop)) {\n            rv[prfx + prop] = undefined;\n        }\n        else {\n            var ap = a[prop], bp = b[prop];\n            if (typeof ap === 'object' && typeof bp === 'object' && ap && bp) {\n                const apTypeName = toStringTag(ap);\n                const bpTypeName = toStringTag(bp);\n                if (apTypeName !== bpTypeName) {\n                    rv[prfx + prop] = b[prop];\n                }\n                else if (apTypeName === 'Object') {\n                    getObjectDiff(ap, bp, rv, prfx + prop + '.');\n                }\n                else if (ap !== bp) {\n                    rv[prfx + prop] = b[prop];\n                }\n            }\n            else if (ap !== bp)\n                rv[prfx + prop] = b[prop];\n        }\n    });\n    keys(b).forEach((prop) => {\n        if (!hasOwn(a, prop)) {\n            rv[prfx + prop] = b[prop];\n        }\n    });\n    return rv;\n}\n\nfunction getEffectiveKeys(primaryKey, req) {\n    if (req.type === 'delete')\n        return req.keys;\n    return req.keys || req.values.map(primaryKey.extractKey);\n}\n\nconst hooksMiddleware = {\n    stack: \"dbcore\",\n    name: \"HooksMiddleware\",\n    level: 2,\n    create: (downCore) => ({\n        ...downCore,\n        table(tableName) {\n            const downTable = downCore.table(tableName);\n            const { primaryKey } = downTable.schema;\n            const tableMiddleware = {\n                ...downTable,\n                mutate(req) {\n                    const dxTrans = PSD.trans;\n                    const { deleting, creating, updating } = dxTrans.table(tableName).hook;\n                    switch (req.type) {\n                        case 'add':\n                            if (creating.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', () => addPutOrDelete(req), true);\n                        case 'put':\n                            if (creating.fire === nop && updating.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', () => addPutOrDelete(req), true);\n                        case 'delete':\n                            if (deleting.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', () => addPutOrDelete(req), true);\n                        case 'deleteRange':\n                            if (deleting.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', () => deleteRange(req), true);\n                    }\n                    return downTable.mutate(req);\n                    function addPutOrDelete(req) {\n                        const dxTrans = PSD.trans;\n                        const keys = req.keys || getEffectiveKeys(primaryKey, req);\n                        if (!keys)\n                            throw new Error(\"Keys missing\");\n                        req = req.type === 'add' || req.type === 'put' ?\n                            { ...req, keys } :\n                            { ...req };\n                        if (req.type !== 'delete')\n                            req.values = [...req.values];\n                        if (req.keys)\n                            req.keys = [...req.keys];\n                        return getExistingValues(downTable, req, keys).then(existingValues => {\n                            const contexts = keys.map((key, i) => {\n                                const existingValue = existingValues[i];\n                                const ctx = { onerror: null, onsuccess: null };\n                                if (req.type === 'delete') {\n                                    deleting.fire.call(ctx, key, existingValue, dxTrans);\n                                }\n                                else if (req.type === 'add' || existingValue === undefined) {\n                                    const generatedPrimaryKey = creating.fire.call(ctx, key, req.values[i], dxTrans);\n                                    if (key == null && generatedPrimaryKey != null) {\n                                        key = generatedPrimaryKey;\n                                        req.keys[i] = key;\n                                        if (!primaryKey.outbound) {\n                                            setByKeyPath(req.values[i], primaryKey.keyPath, key);\n                                        }\n                                    }\n                                }\n                                else {\n                                    const objectDiff = getObjectDiff(existingValue, req.values[i]);\n                                    const additionalChanges = updating.fire.call(ctx, objectDiff, key, existingValue, dxTrans);\n                                    if (additionalChanges) {\n                                        const requestedValue = req.values[i];\n                                        Object.keys(additionalChanges).forEach(keyPath => {\n                                            if (hasOwn(requestedValue, keyPath)) {\n                                                requestedValue[keyPath] = additionalChanges[keyPath];\n                                            }\n                                            else {\n                                                setByKeyPath(requestedValue, keyPath, additionalChanges[keyPath]);\n                                            }\n                                        });\n                                    }\n                                }\n                                return ctx;\n                            });\n                            return downTable.mutate(req).then(({ failures, results, numFailures, lastResult }) => {\n                                for (let i = 0; i < keys.length; ++i) {\n                                    const primKey = results ? results[i] : keys[i];\n                                    const ctx = contexts[i];\n                                    if (primKey == null) {\n                                        ctx.onerror && ctx.onerror(failures[i]);\n                                    }\n                                    else {\n                                        ctx.onsuccess && ctx.onsuccess(req.type === 'put' && existingValues[i] ?\n                                            req.values[i] :\n                                            primKey\n                                        );\n                                    }\n                                }\n                                return { failures, results, numFailures, lastResult };\n                            }).catch(error => {\n                                contexts.forEach(ctx => ctx.onerror && ctx.onerror(error));\n                                return Promise.reject(error);\n                            });\n                        });\n                    }\n                    function deleteRange(req) {\n                        return deleteNextChunk(req.trans, req.range, 10000);\n                    }\n                    function deleteNextChunk(trans, range, limit) {\n                        return downTable.query({ trans, values: false, query: { index: primaryKey, range }, limit })\n                            .then(({ result }) => {\n                            return addPutOrDelete({ type: 'delete', keys: result, trans }).then(res => {\n                                if (res.numFailures > 0)\n                                    return Promise.reject(res.failures[0]);\n                                if (result.length < limit) {\n                                    return { failures: [], numFailures: 0, lastResult: undefined };\n                                }\n                                else {\n                                    return deleteNextChunk(trans, { ...range, lower: result[result.length - 1], lowerOpen: true }, limit);\n                                }\n                            });\n                        });\n                    }\n                }\n            };\n            return tableMiddleware;\n        },\n    })\n};\nfunction getExistingValues(table, req, effectiveKeys) {\n    return req.type === \"add\"\n        ? Promise.resolve([])\n        : table.getMany({ trans: req.trans, keys: effectiveKeys, cache: \"immutable\" });\n}\n\nfunction getFromTransactionCache(keys, cache, clone) {\n    try {\n        if (!cache)\n            return null;\n        if (cache.keys.length < keys.length)\n            return null;\n        const result = [];\n        for (let i = 0, j = 0; i < cache.keys.length && j < keys.length; ++i) {\n            if (cmp(cache.keys[i], keys[j]) !== 0)\n                continue;\n            result.push(clone ? deepClone(cache.values[i]) : cache.values[i]);\n            ++j;\n        }\n        return result.length === keys.length ? result : null;\n    }\n    catch (_a) {\n        return null;\n    }\n}\nconst cacheExistingValuesMiddleware = {\n    stack: \"dbcore\",\n    level: -1,\n    create: (core) => {\n        return {\n            table: (tableName) => {\n                const table = core.table(tableName);\n                return {\n                    ...table,\n                    getMany: (req) => {\n                        if (!req.cache) {\n                            return table.getMany(req);\n                        }\n                        const cachedResult = getFromTransactionCache(req.keys, req.trans[\"_cache\"], req.cache === \"clone\");\n                        if (cachedResult) {\n                            return DexiePromise.resolve(cachedResult);\n                        }\n                        return table.getMany(req).then((res) => {\n                            req.trans[\"_cache\"] = {\n                                keys: req.keys,\n                                values: req.cache === \"clone\" ? deepClone(res) : res,\n                            };\n                            return res;\n                        });\n                    },\n                    mutate: (req) => {\n                        if (req.type !== \"add\")\n                            req.trans[\"_cache\"] = null;\n                        return table.mutate(req);\n                    },\n                };\n            },\n        };\n    },\n};\n\nfunction isEmptyRange(node) {\n    return !(\"from\" in node);\n}\nconst RangeSet = function (fromOrTree, to) {\n    if (this) {\n        extend(this, arguments.length ? { d: 1, from: fromOrTree, to: arguments.length > 1 ? to : fromOrTree } : { d: 0 });\n    }\n    else {\n        const rv = new RangeSet();\n        if (fromOrTree && (\"d\" in fromOrTree)) {\n            extend(rv, fromOrTree);\n        }\n        return rv;\n    }\n};\nprops(RangeSet.prototype, {\n    add(rangeSet) {\n        mergeRanges(this, rangeSet);\n        return this;\n    },\n    addKey(key) {\n        addRange(this, key, key);\n        return this;\n    },\n    addKeys(keys) {\n        keys.forEach(key => addRange(this, key, key));\n        return this;\n    },\n    [iteratorSymbol]() {\n        return getRangeSetIterator(this);\n    }\n});\nfunction addRange(target, from, to) {\n    const diff = cmp(from, to);\n    if (isNaN(diff))\n        return;\n    if (diff > 0)\n        throw RangeError();\n    if (isEmptyRange(target))\n        return extend(target, { from, to, d: 1 });\n    const left = target.l;\n    const right = target.r;\n    if (cmp(to, target.from) < 0) {\n        left\n            ? addRange(left, from, to)\n            : (target.l = { from, to, d: 1, l: null, r: null });\n        return rebalance(target);\n    }\n    if (cmp(from, target.to) > 0) {\n        right\n            ? addRange(right, from, to)\n            : (target.r = { from, to, d: 1, l: null, r: null });\n        return rebalance(target);\n    }\n    if (cmp(from, target.from) < 0) {\n        target.from = from;\n        target.l = null;\n        target.d = right ? right.d + 1 : 1;\n    }\n    if (cmp(to, target.to) > 0) {\n        target.to = to;\n        target.r = null;\n        target.d = target.l ? target.l.d + 1 : 1;\n    }\n    const rightWasCutOff = !target.r;\n    if (left && !target.l) {\n        mergeRanges(target, left);\n    }\n    if (right && rightWasCutOff) {\n        mergeRanges(target, right);\n    }\n}\nfunction mergeRanges(target, newSet) {\n    function _addRangeSet(target, { from, to, l, r }) {\n        addRange(target, from, to);\n        if (l)\n            _addRangeSet(target, l);\n        if (r)\n            _addRangeSet(target, r);\n    }\n    if (!isEmptyRange(newSet))\n        _addRangeSet(target, newSet);\n}\nfunction rangesOverlap(rangeSet1, rangeSet2) {\n    const i1 = getRangeSetIterator(rangeSet2);\n    let nextResult1 = i1.next();\n    if (nextResult1.done)\n        return false;\n    let a = nextResult1.value;\n    const i2 = getRangeSetIterator(rangeSet1);\n    let nextResult2 = i2.next(a.from);\n    let b = nextResult2.value;\n    while (!nextResult1.done && !nextResult2.done) {\n        if (cmp(b.from, a.to) <= 0 && cmp(b.to, a.from) >= 0)\n            return true;\n        cmp(a.from, b.from) < 0\n            ? (a = (nextResult1 = i1.next(b.from)).value)\n            : (b = (nextResult2 = i2.next(a.from)).value);\n    }\n    return false;\n}\nfunction getRangeSetIterator(node) {\n    let state = isEmptyRange(node) ? null : { s: 0, n: node };\n    return {\n        next(key) {\n            const keyProvided = arguments.length > 0;\n            while (state) {\n                switch (state.s) {\n                    case 0:\n                        state.s = 1;\n                        if (keyProvided) {\n                            while (state.n.l && cmp(key, state.n.from) < 0)\n                                state = { up: state, n: state.n.l, s: 1 };\n                        }\n                        else {\n                            while (state.n.l)\n                                state = { up: state, n: state.n.l, s: 1 };\n                        }\n                    case 1:\n                        state.s = 2;\n                        if (!keyProvided || cmp(key, state.n.to) <= 0)\n                            return { value: state.n, done: false };\n                    case 2:\n                        if (state.n.r) {\n                            state.s = 3;\n                            state = { up: state, n: state.n.r, s: 0 };\n                            continue;\n                        }\n                    case 3:\n                        state = state.up;\n                }\n            }\n            return { done: true };\n        },\n    };\n}\nfunction rebalance(target) {\n    var _a, _b;\n    const diff = (((_a = target.r) === null || _a === void 0 ? void 0 : _a.d) || 0) - (((_b = target.l) === null || _b === void 0 ? void 0 : _b.d) || 0);\n    const r = diff > 1 ? \"r\" : diff < -1 ? \"l\" : \"\";\n    if (r) {\n        const l = r === \"r\" ? \"l\" : \"r\";\n        const rootClone = { ...target };\n        const oldRootRight = target[r];\n        target.from = oldRootRight.from;\n        target.to = oldRootRight.to;\n        target[r] = oldRootRight[r];\n        rootClone[r] = oldRootRight[l];\n        target[l] = rootClone;\n        rootClone.d = computeDepth(rootClone);\n    }\n    target.d = computeDepth(target);\n}\nfunction computeDepth({ r, l }) {\n    return (r ? (l ? Math.max(r.d, l.d) : r.d) : l ? l.d : 0) + 1;\n}\n\nconst observabilityMiddleware = {\n    stack: \"dbcore\",\n    level: 0,\n    create: (core) => {\n        const dbName = core.schema.name;\n        const FULL_RANGE = new RangeSet(core.MIN_KEY, core.MAX_KEY);\n        return {\n            ...core,\n            table: (tableName) => {\n                const table = core.table(tableName);\n                const { schema } = table;\n                const { primaryKey } = schema;\n                const { extractKey, outbound } = primaryKey;\n                const tableClone = {\n                    ...table,\n                    mutate: (req) => {\n                        const trans = req.trans;\n                        const mutatedParts = trans.mutatedParts || (trans.mutatedParts = {});\n                        const getRangeSet = (indexName) => {\n                            const part = `idb://${dbName}/${tableName}/${indexName}`;\n                            return (mutatedParts[part] ||\n                                (mutatedParts[part] = new RangeSet()));\n                        };\n                        const pkRangeSet = getRangeSet(\"\");\n                        const delsRangeSet = getRangeSet(\":dels\");\n                        const { type } = req;\n                        let [keys, newObjs] = req.type === \"deleteRange\"\n                            ? [req.range]\n                            : req.type === \"delete\"\n                                ? [req.keys]\n                                : req.values.length < 50\n                                    ? [[], req.values]\n                                    : [];\n                        const oldCache = req.trans[\"_cache\"];\n                        return table.mutate(req).then((res) => {\n                            if (isArray(keys)) {\n                                if (type !== \"delete\")\n                                    keys = res.results;\n                                pkRangeSet.addKeys(keys);\n                                const oldObjs = getFromTransactionCache(keys, oldCache);\n                                if (!oldObjs && type !== \"add\") {\n                                    delsRangeSet.addKeys(keys);\n                                }\n                                if (oldObjs || newObjs) {\n                                    trackAffectedIndexes(getRangeSet, schema, oldObjs, newObjs);\n                                }\n                            }\n                            else if (keys) {\n                                const range = { from: keys.lower, to: keys.upper };\n                                delsRangeSet.add(range);\n                                pkRangeSet.add(range);\n                            }\n                            else {\n                                pkRangeSet.add(FULL_RANGE);\n                                delsRangeSet.add(FULL_RANGE);\n                                schema.indexes.forEach(idx => getRangeSet(idx.name).add(FULL_RANGE));\n                            }\n                            return res;\n                        });\n                    },\n                };\n                const getRange = ({ query: { index, range }, }) => {\n                    var _a, _b;\n                    return [\n                        index,\n                        new RangeSet((_a = range.lower) !== null && _a !== void 0 ? _a : core.MIN_KEY, (_b = range.upper) !== null && _b !== void 0 ? _b : core.MAX_KEY),\n                    ];\n                };\n                const readSubscribers = {\n                    get: (req) => [primaryKey, new RangeSet(req.key)],\n                    getMany: (req) => [primaryKey, new RangeSet().addKeys(req.keys)],\n                    count: getRange,\n                    query: getRange,\n                    openCursor: getRange,\n                };\n                keys(readSubscribers).forEach(method => {\n                    tableClone[method] = function (req) {\n                        const { subscr } = PSD;\n                        if (subscr) {\n                            const getRangeSet = (indexName) => {\n                                const part = `idb://${dbName}/${tableName}/${indexName}`;\n                                return (subscr[part] ||\n                                    (subscr[part] = new RangeSet()));\n                            };\n                            const pkRangeSet = getRangeSet(\"\");\n                            const delsRangeSet = getRangeSet(\":dels\");\n                            const [queriedIndex, queriedRanges] = readSubscribers[method](req);\n                            getRangeSet(queriedIndex.name || \"\").add(queriedRanges);\n                            if (!queriedIndex.isPrimaryKey) {\n                                if (method === \"count\") {\n                                    delsRangeSet.add(FULL_RANGE);\n                                }\n                                else {\n                                    const keysPromise = method === \"query\" &&\n                                        outbound &&\n                                        req.values &&\n                                        table.query({\n                                            ...req,\n                                            values: false,\n                                        });\n                                    return table[method].apply(this, arguments).then((res) => {\n                                        if (method === \"query\") {\n                                            if (outbound && req.values) {\n                                                return keysPromise.then(({ result: resultingKeys }) => {\n                                                    pkRangeSet.addKeys(resultingKeys);\n                                                    return res;\n                                                });\n                                            }\n                                            const pKeys = req.values\n                                                ? res.result.map(extractKey)\n                                                : res.result;\n                                            if (req.values) {\n                                                pkRangeSet.addKeys(pKeys);\n                                            }\n                                            else {\n                                                delsRangeSet.addKeys(pKeys);\n                                            }\n                                        }\n                                        else if (method === \"openCursor\") {\n                                            const cursor = res;\n                                            const wantValues = req.values;\n                                            return (cursor &&\n                                                Object.create(cursor, {\n                                                    key: {\n                                                        get() {\n                                                            delsRangeSet.addKey(cursor.primaryKey);\n                                                            return cursor.key;\n                                                        },\n                                                    },\n                                                    primaryKey: {\n                                                        get() {\n                                                            const pkey = cursor.primaryKey;\n                                                            delsRangeSet.addKey(pkey);\n                                                            return pkey;\n                                                        },\n                                                    },\n                                                    value: {\n                                                        get() {\n                                                            wantValues && pkRangeSet.addKey(cursor.primaryKey);\n                                                            return cursor.value;\n                                                        },\n                                                    },\n                                                }));\n                                        }\n                                        return res;\n                                    });\n                                }\n                            }\n                        }\n                        return table[method].apply(this, arguments);\n                    };\n                });\n                return tableClone;\n            },\n        };\n    },\n};\nfunction trackAffectedIndexes(getRangeSet, schema, oldObjs, newObjs) {\n    function addAffectedIndex(ix) {\n        const rangeSet = getRangeSet(ix.name || \"\");\n        function extractKey(obj) {\n            return obj != null ? ix.extractKey(obj) : null;\n        }\n        const addKeyOrKeys = (key) => ix.multiEntry && isArray(key)\n            ? key.forEach(key => rangeSet.addKey(key))\n            : rangeSet.addKey(key);\n        (oldObjs || newObjs).forEach((_, i) => {\n            const oldKey = oldObjs && extractKey(oldObjs[i]);\n            const newKey = newObjs && extractKey(newObjs[i]);\n            if (cmp(oldKey, newKey) !== 0) {\n                if (oldKey != null)\n                    addKeyOrKeys(oldKey);\n                if (newKey != null)\n                    addKeyOrKeys(newKey);\n            }\n        });\n    }\n    schema.indexes.forEach(addAffectedIndex);\n}\n\nclass Dexie$1 {\n    constructor(name, options) {\n        this._middlewares = {};\n        this.verno = 0;\n        const deps = Dexie$1.dependencies;\n        this._options = options = {\n            addons: Dexie$1.addons,\n            autoOpen: true,\n            indexedDB: deps.indexedDB,\n            IDBKeyRange: deps.IDBKeyRange,\n            ...options\n        };\n        this._deps = {\n            indexedDB: options.indexedDB,\n            IDBKeyRange: options.IDBKeyRange\n        };\n        const { addons, } = options;\n        this._dbSchema = {};\n        this._versions = [];\n        this._storeNames = [];\n        this._allTables = {};\n        this.idbdb = null;\n        this._novip = this;\n        const state = {\n            dbOpenError: null,\n            isBeingOpened: false,\n            onReadyBeingFired: null,\n            openComplete: false,\n            dbReadyResolve: nop,\n            dbReadyPromise: null,\n            cancelOpen: nop,\n            openCanceller: null,\n            autoSchema: true,\n            PR1398_maxLoop: 3\n        };\n        state.dbReadyPromise = new DexiePromise(resolve => {\n            state.dbReadyResolve = resolve;\n        });\n        state.openCanceller = new DexiePromise((_, reject) => {\n            state.cancelOpen = reject;\n        });\n        this._state = state;\n        this.name = name;\n        this.on = Events(this, \"populate\", \"blocked\", \"versionchange\", \"close\", { ready: [promisableChain, nop] });\n        this.on.ready.subscribe = override(this.on.ready.subscribe, subscribe => {\n            return (subscriber, bSticky) => {\n                Dexie$1.vip(() => {\n                    const state = this._state;\n                    if (state.openComplete) {\n                        if (!state.dbOpenError)\n                            DexiePromise.resolve().then(subscriber);\n                        if (bSticky)\n                            subscribe(subscriber);\n                    }\n                    else if (state.onReadyBeingFired) {\n                        state.onReadyBeingFired.push(subscriber);\n                        if (bSticky)\n                            subscribe(subscriber);\n                    }\n                    else {\n                        subscribe(subscriber);\n                        const db = this;\n                        if (!bSticky)\n                            subscribe(function unsubscribe() {\n                                db.on.ready.unsubscribe(subscriber);\n                                db.on.ready.unsubscribe(unsubscribe);\n                            });\n                    }\n                });\n            };\n        });\n        this.Collection = createCollectionConstructor(this);\n        this.Table = createTableConstructor(this);\n        this.Transaction = createTransactionConstructor(this);\n        this.Version = createVersionConstructor(this);\n        this.WhereClause = createWhereClauseConstructor(this);\n        this.on(\"versionchange\", ev => {\n            if (ev.newVersion > 0)\n                console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`);\n            else\n                console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`);\n            this.close();\n        });\n        this.on(\"blocked\", ev => {\n            if (!ev.newVersion || ev.newVersion < ev.oldVersion)\n                console.warn(`Dexie.delete('${this.name}') was blocked`);\n            else\n                console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${ev.oldVersion / 10}`);\n        });\n        this._maxKey = getMaxKey(options.IDBKeyRange);\n        this._createTransaction = (mode, storeNames, dbschema, parentTransaction) => new this.Transaction(mode, storeNames, dbschema, this._options.chromeTransactionDurability, parentTransaction);\n        this._fireOnBlocked = ev => {\n            this.on(\"blocked\").fire(ev);\n            connections\n                .filter(c => c.name === this.name && c !== this && !c._state.vcFired)\n                .map(c => c.on(\"versionchange\").fire(ev));\n        };\n        this.use(virtualIndexMiddleware);\n        this.use(hooksMiddleware);\n        this.use(observabilityMiddleware);\n        this.use(cacheExistingValuesMiddleware);\n        this.vip = Object.create(this, { _vip: { value: true } });\n        addons.forEach(addon => addon(this));\n    }\n    version(versionNumber) {\n        if (isNaN(versionNumber) || versionNumber < 0.1)\n            throw new exceptions.Type(`Given version is not a positive number`);\n        versionNumber = Math.round(versionNumber * 10) / 10;\n        if (this.idbdb || this._state.isBeingOpened)\n            throw new exceptions.Schema(\"Cannot add version when database is open\");\n        this.verno = Math.max(this.verno, versionNumber);\n        const versions = this._versions;\n        var versionInstance = versions.filter(v => v._cfg.version === versionNumber)[0];\n        if (versionInstance)\n            return versionInstance;\n        versionInstance = new this.Version(versionNumber);\n        versions.push(versionInstance);\n        versions.sort(lowerVersionFirst);\n        versionInstance.stores({});\n        this._state.autoSchema = false;\n        return versionInstance;\n    }\n    _whenReady(fn) {\n        return (this.idbdb && (this._state.openComplete || PSD.letThrough || this._vip)) ? fn() : new DexiePromise((resolve, reject) => {\n            if (this._state.openComplete) {\n                return reject(new exceptions.DatabaseClosed(this._state.dbOpenError));\n            }\n            if (!this._state.isBeingOpened) {\n                if (!this._options.autoOpen) {\n                    reject(new exceptions.DatabaseClosed());\n                    return;\n                }\n                this.open().catch(nop);\n            }\n            this._state.dbReadyPromise.then(resolve, reject);\n        }).then(fn);\n    }\n    use({ stack, create, level, name }) {\n        if (name)\n            this.unuse({ stack, name });\n        const middlewares = this._middlewares[stack] || (this._middlewares[stack] = []);\n        middlewares.push({ stack, create, level: level == null ? 10 : level, name });\n        middlewares.sort((a, b) => a.level - b.level);\n        return this;\n    }\n    unuse({ stack, name, create }) {\n        if (stack && this._middlewares[stack]) {\n            this._middlewares[stack] = this._middlewares[stack].filter(mw => create ? mw.create !== create :\n                name ? mw.name !== name :\n                    false);\n        }\n        return this;\n    }\n    open() {\n        return dexieOpen(this);\n    }\n    _close() {\n        const state = this._state;\n        const idx = connections.indexOf(this);\n        if (idx >= 0)\n            connections.splice(idx, 1);\n        if (this.idbdb) {\n            try {\n                this.idbdb.close();\n            }\n            catch (e) { }\n            this._novip.idbdb = null;\n        }\n        state.dbReadyPromise = new DexiePromise(resolve => {\n            state.dbReadyResolve = resolve;\n        });\n        state.openCanceller = new DexiePromise((_, reject) => {\n            state.cancelOpen = reject;\n        });\n    }\n    close() {\n        this._close();\n        const state = this._state;\n        this._options.autoOpen = false;\n        state.dbOpenError = new exceptions.DatabaseClosed();\n        if (state.isBeingOpened)\n            state.cancelOpen(state.dbOpenError);\n    }\n    delete() {\n        const hasArguments = arguments.length > 0;\n        const state = this._state;\n        return new DexiePromise((resolve, reject) => {\n            const doDelete = () => {\n                this.close();\n                var req = this._deps.indexedDB.deleteDatabase(this.name);\n                req.onsuccess = wrap(() => {\n                    _onDatabaseDeleted(this._deps, this.name);\n                    resolve();\n                });\n                req.onerror = eventRejectHandler(reject);\n                req.onblocked = this._fireOnBlocked;\n            };\n            if (hasArguments)\n                throw new exceptions.InvalidArgument(\"Arguments not allowed in db.delete()\");\n            if (state.isBeingOpened) {\n                state.dbReadyPromise.then(doDelete);\n            }\n            else {\n                doDelete();\n            }\n        });\n    }\n    backendDB() {\n        return this.idbdb;\n    }\n    isOpen() {\n        return this.idbdb !== null;\n    }\n    hasBeenClosed() {\n        const dbOpenError = this._state.dbOpenError;\n        return dbOpenError && (dbOpenError.name === 'DatabaseClosed');\n    }\n    hasFailed() {\n        return this._state.dbOpenError !== null;\n    }\n    dynamicallyOpened() {\n        return this._state.autoSchema;\n    }\n    get tables() {\n        return keys(this._allTables).map(name => this._allTables[name]);\n    }\n    transaction() {\n        const args = extractTransactionArgs.apply(this, arguments);\n        return this._transaction.apply(this, args);\n    }\n    _transaction(mode, tables, scopeFunc) {\n        let parentTransaction = PSD.trans;\n        if (!parentTransaction || parentTransaction.db !== this || mode.indexOf('!') !== -1)\n            parentTransaction = null;\n        const onlyIfCompatible = mode.indexOf('?') !== -1;\n        mode = mode.replace('!', '').replace('?', '');\n        let idbMode, storeNames;\n        try {\n            storeNames = tables.map(table => {\n                var storeName = table instanceof this.Table ? table.name : table;\n                if (typeof storeName !== 'string')\n                    throw new TypeError(\"Invalid table argument to Dexie.transaction(). Only Table or String are allowed\");\n                return storeName;\n            });\n            if (mode == \"r\" || mode === READONLY)\n                idbMode = READONLY;\n            else if (mode == \"rw\" || mode == READWRITE)\n                idbMode = READWRITE;\n            else\n                throw new exceptions.InvalidArgument(\"Invalid transaction mode: \" + mode);\n            if (parentTransaction) {\n                if (parentTransaction.mode === READONLY && idbMode === READWRITE) {\n                    if (onlyIfCompatible) {\n                        parentTransaction = null;\n                    }\n                    else\n                        throw new exceptions.SubTransaction(\"Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY\");\n                }\n                if (parentTransaction) {\n                    storeNames.forEach(storeName => {\n                        if (parentTransaction && parentTransaction.storeNames.indexOf(storeName) === -1) {\n                            if (onlyIfCompatible) {\n                                parentTransaction = null;\n                            }\n                            else\n                                throw new exceptions.SubTransaction(\"Table \" + storeName +\n                                    \" not included in parent transaction.\");\n                        }\n                    });\n                }\n                if (onlyIfCompatible && parentTransaction && !parentTransaction.active) {\n                    parentTransaction = null;\n                }\n            }\n        }\n        catch (e) {\n            return parentTransaction ?\n                parentTransaction._promise(null, (_, reject) => { reject(e); }) :\n                rejection(e);\n        }\n        const enterTransaction = enterTransactionScope.bind(null, this, idbMode, storeNames, parentTransaction, scopeFunc);\n        return (parentTransaction ?\n            parentTransaction._promise(idbMode, enterTransaction, \"lock\") :\n            PSD.trans ?\n                usePSD(PSD.transless, () => this._whenReady(enterTransaction)) :\n                this._whenReady(enterTransaction));\n    }\n    table(tableName) {\n        if (!hasOwn(this._allTables, tableName)) {\n            throw new exceptions.InvalidTable(`Table ${tableName} does not exist`);\n        }\n        return this._allTables[tableName];\n    }\n}\n\nconst symbolObservable = typeof Symbol !== \"undefined\" && \"observable\" in Symbol\n    ? Symbol.observable\n    : \"@@observable\";\nclass Observable {\n    constructor(subscribe) {\n        this._subscribe = subscribe;\n    }\n    subscribe(x, error, complete) {\n        return this._subscribe(!x || typeof x === \"function\" ? { next: x, error, complete } : x);\n    }\n    [symbolObservable]() {\n        return this;\n    }\n}\n\nfunction extendObservabilitySet(target, newSet) {\n    keys(newSet).forEach(part => {\n        const rangeSet = target[part] || (target[part] = new RangeSet());\n        mergeRanges(rangeSet, newSet[part]);\n    });\n    return target;\n}\n\nfunction liveQuery(querier) {\n    return new Observable((observer) => {\n        const scopeFuncIsAsync = isAsyncFunction(querier);\n        function execute(subscr) {\n            if (scopeFuncIsAsync) {\n                incrementExpectedAwaits();\n            }\n            const exec = () => newScope(querier, { subscr, trans: null });\n            const rv = PSD.trans\n                ?\n                    usePSD(PSD.transless, exec)\n                : exec();\n            if (scopeFuncIsAsync) {\n                rv.then(decrementExpectedAwaits, decrementExpectedAwaits);\n            }\n            return rv;\n        }\n        let closed = false;\n        let accumMuts = {};\n        let currentObs = {};\n        const subscription = {\n            get closed() {\n                return closed;\n            },\n            unsubscribe: () => {\n                closed = true;\n                globalEvents.storagemutated.unsubscribe(mutationListener);\n            },\n        };\n        observer.start && observer.start(subscription);\n        let querying = false, startedListening = false;\n        function shouldNotify() {\n            return keys(currentObs).some((key) => accumMuts[key] && rangesOverlap(accumMuts[key], currentObs[key]));\n        }\n        const mutationListener = (parts) => {\n            extendObservabilitySet(accumMuts, parts);\n            if (shouldNotify()) {\n                doQuery();\n            }\n        };\n        const doQuery = () => {\n            if (querying || closed)\n                return;\n            accumMuts = {};\n            const subscr = {};\n            const ret = execute(subscr);\n            if (!startedListening) {\n                globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, mutationListener);\n                startedListening = true;\n            }\n            querying = true;\n            Promise.resolve(ret).then((result) => {\n                querying = false;\n                if (closed)\n                    return;\n                if (shouldNotify()) {\n                    doQuery();\n                }\n                else {\n                    accumMuts = {};\n                    currentObs = subscr;\n                    observer.next && observer.next(result);\n                }\n            }, (err) => {\n                querying = false;\n                observer.error && observer.error(err);\n                subscription.unsubscribe();\n            });\n        };\n        doQuery();\n        return subscription;\n    });\n}\n\nlet domDeps;\ntry {\n    domDeps = {\n        indexedDB: _global.indexedDB || _global.mozIndexedDB || _global.webkitIndexedDB || _global.msIndexedDB,\n        IDBKeyRange: _global.IDBKeyRange || _global.webkitIDBKeyRange\n    };\n}\ncatch (e) {\n    domDeps = { indexedDB: null, IDBKeyRange: null };\n}\n\nconst Dexie = Dexie$1;\nprops(Dexie, {\n    ...fullNameExceptions,\n    delete(databaseName) {\n        const db = new Dexie(databaseName, { addons: [] });\n        return db.delete();\n    },\n    exists(name) {\n        return new Dexie(name, { addons: [] }).open().then(db => {\n            db.close();\n            return true;\n        }).catch('NoSuchDatabaseError', () => false);\n    },\n    getDatabaseNames(cb) {\n        try {\n            return getDatabaseNames(Dexie.dependencies).then(cb);\n        }\n        catch (_a) {\n            return rejection(new exceptions.MissingAPI());\n        }\n    },\n    defineClass() {\n        function Class(content) {\n            extend(this, content);\n        }\n        return Class;\n    },\n    ignoreTransaction(scopeFunc) {\n        return PSD.trans ?\n            usePSD(PSD.transless, scopeFunc) :\n            scopeFunc();\n    },\n    vip,\n    async: function (generatorFn) {\n        return function () {\n            try {\n                var rv = awaitIterator(generatorFn.apply(this, arguments));\n                if (!rv || typeof rv.then !== 'function')\n                    return DexiePromise.resolve(rv);\n                return rv;\n            }\n            catch (e) {\n                return rejection(e);\n            }\n        };\n    },\n    spawn: function (generatorFn, args, thiz) {\n        try {\n            var rv = awaitIterator(generatorFn.apply(thiz, args || []));\n            if (!rv || typeof rv.then !== 'function')\n                return DexiePromise.resolve(rv);\n            return rv;\n        }\n        catch (e) {\n            return rejection(e);\n        }\n    },\n    currentTransaction: {\n        get: () => PSD.trans || null\n    },\n    waitFor: function (promiseOrFunction, optionalTimeout) {\n        const promise = DexiePromise.resolve(typeof promiseOrFunction === 'function' ?\n            Dexie.ignoreTransaction(promiseOrFunction) :\n            promiseOrFunction)\n            .timeout(optionalTimeout || 60000);\n        return PSD.trans ?\n            PSD.trans.waitFor(promise) :\n            promise;\n    },\n    Promise: DexiePromise,\n    debug: {\n        get: () => debug,\n        set: value => {\n            setDebug(value, value === 'dexie' ? () => true : dexieStackFrameFilter);\n        }\n    },\n    derive: derive,\n    extend: extend,\n    props: props,\n    override: override,\n    Events: Events,\n    on: globalEvents,\n    liveQuery,\n    extendObservabilitySet,\n    getByKeyPath: getByKeyPath,\n    setByKeyPath: setByKeyPath,\n    delByKeyPath: delByKeyPath,\n    shallowClone: shallowClone,\n    deepClone: deepClone,\n    getObjectDiff: getObjectDiff,\n    cmp,\n    asap: asap$1,\n    minKey: minKey,\n    addons: [],\n    connections: connections,\n    errnames: errnames,\n    dependencies: domDeps,\n    semVer: DEXIE_VERSION,\n    version: DEXIE_VERSION.split('.')\n        .map(n => parseInt(n))\n        .reduce((p, c, i) => p + (c / Math.pow(10, i * 2))),\n});\nDexie.maxKey = getMaxKey(Dexie.dependencies.IDBKeyRange);\n\nif (typeof dispatchEvent !== 'undefined' && typeof addEventListener !== 'undefined') {\n    globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, updatedParts => {\n        if (!propagatingLocally) {\n            let event;\n            if (isIEOrEdge) {\n                event = document.createEvent('CustomEvent');\n                event.initCustomEvent(STORAGE_MUTATED_DOM_EVENT_NAME, true, true, updatedParts);\n            }\n            else {\n                event = new CustomEvent(STORAGE_MUTATED_DOM_EVENT_NAME, {\n                    detail: updatedParts\n                });\n            }\n            propagatingLocally = true;\n            dispatchEvent(event);\n            propagatingLocally = false;\n        }\n    });\n    addEventListener(STORAGE_MUTATED_DOM_EVENT_NAME, ({ detail }) => {\n        if (!propagatingLocally) {\n            propagateLocally(detail);\n        }\n    });\n}\nfunction propagateLocally(updateParts) {\n    let wasMe = propagatingLocally;\n    try {\n        propagatingLocally = true;\n        globalEvents.storagemutated.fire(updateParts);\n    }\n    finally {\n        propagatingLocally = wasMe;\n    }\n}\nlet propagatingLocally = false;\n\nif (typeof BroadcastChannel !== 'undefined') {\n    const bc = new BroadcastChannel(STORAGE_MUTATED_DOM_EVENT_NAME);\n    globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, (changedParts) => {\n        if (!propagatingLocally) {\n            bc.postMessage(changedParts);\n        }\n    });\n    bc.onmessage = (ev) => {\n        if (ev.data)\n            propagateLocally(ev.data);\n    };\n}\nelse if (typeof self !== 'undefined' && typeof navigator !== 'undefined') {\n    globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, (changedParts) => {\n        try {\n            if (!propagatingLocally) {\n                if (typeof localStorage !== 'undefined') {\n                    localStorage.setItem(STORAGE_MUTATED_DOM_EVENT_NAME, JSON.stringify({\n                        trig: Math.random(),\n                        changedParts,\n                    }));\n                }\n                if (typeof self['clients'] === 'object') {\n                    [...self['clients'].matchAll({ includeUncontrolled: true })].forEach((client) => client.postMessage({\n                        type: STORAGE_MUTATED_DOM_EVENT_NAME,\n                        changedParts,\n                    }));\n                }\n            }\n        }\n        catch (_a) { }\n    });\n    if (typeof addEventListener !== 'undefined') {\n        addEventListener('storage', (ev) => {\n            if (ev.key === STORAGE_MUTATED_DOM_EVENT_NAME) {\n                const data = JSON.parse(ev.newValue);\n                if (data)\n                    propagateLocally(data.changedParts);\n            }\n        });\n    }\n    const swContainer = self.document && navigator.serviceWorker;\n    if (swContainer) {\n        swContainer.addEventListener('message', propagateMessageLocally);\n    }\n}\nfunction propagateMessageLocally({ data }) {\n    if (data && data.type === STORAGE_MUTATED_DOM_EVENT_NAME) {\n        propagateLocally(data.changedParts);\n    }\n}\n\nDexiePromise.rejectionMapper = mapError;\nsetDebug(debug, dexieStackFrameFilter);\n\nexport { Dexie$1 as Dexie, RangeSet, Dexie$1 as default, liveQuery, mergeRanges, rangesOverlap };\n//# sourceMappingURL=dexie.mjs.map\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":["FUND_EMOJI","cash","async","addAccount","account","passedInfo","name","MissingFieldError","initial_balance","FormattingError","validateNewAccount","source","emoji","type","Number","current_balance","getAllUserAccounts","then","results","toArray","getAllAccounts","filter","ValidationError","Error","constructor","message","super","this","property","InvalidAmountError","addRecord","amount","toFixed","validateNewRecord","result","source_account","destination_account","getAllRecords","records","Promise","all","map","record","exportRecords","donwloadCSV","storeAccount","id","uuidv4","db","catch","e","StorageError","stack","updateAccount","getAccount","getAccountMulti","filters","EXPENSE","Food","Groceries","Alcohol","Shopping","Entertainment","Learning","Transport","Events","Investments","Housing","INCOME","Salary","Interest","Refunds","tx","Object","entries","forEach","Dexie","version","stores","accounts","open","storeRecord","srcAccount","destAccount","updateRecord","prev","getRecord","getRecordsMulti","replace","c","crypto","getRandomValues","Uint8Array","toString","data","filename","formatRow","values","v","join","csvData","anchor","document","createElement","setAttribute","blob","Blob","url","URL","createObjectURL","click","revokeObjectURL","download","keys","object","RECORD_AMOUNT_COLOR_LOOKUP","expense","income","transfer","recordCardComponent","recordCard","classList","innerHTML","created_at","note","currency","accountCardComponent","accountCard","recordModal","modal","role","add","getRecordModal","navBarQuickAdd","querySelector","addAccountModal","addAccountButton","accountModalCancelButton","accountModalAddButton","accountModalAddForm","accountList","addEventListener","body","appendChild","addAccountCard","toggleAddAccountModalVisibility","toggle","toggleAddRecordModalVisibility","formData","FormData","formJson","pair","onkeyup","ctrlKey","key","prepend","recordList","addRecordButton","recordModalRecordType","dstAccountDropDown","srcAccountDropDown","recordModalCancelBtn","recordModalAddBtn","recordModalForm","exportRecordsBtn","expenseTypeChangeHandle","addRecordCard","target","value","populateDropDown","element","replaceChildren","accountDropDown","dropdown","recordType","node","innerText","getBalanceColor","balance","getBalanceWithCurrency","currencySign","getCurrencySign","Math","abs","getAccountType","accountTypeString","currencyString","_global","globalThis","self","window","global","isArray","Array","extend","obj","extension","getProto","getPrototypeOf","_hasOwn","hasOwnProperty","hasOwn","prop","call","props","proto","Reflect","ownKeys","setProp","defineProperty","functionOrGetSet","options","get","set","configurable","writable","derive","Child","from","Parent","prototype","create","bind","getOwnPropertyDescriptor","getPropertyDescriptor","_slice","slice","args","start","end","override","origFunc","overridedFactory","assert","b","asap$1","fn","setImmediate","setTimeout","arrayToObject","array","extractor","reduce","item","i","nameAndValue","getByKeyPath","keyPath","rv","l","length","val","push","period","indexOf","innerObj","substr","undefined","setByKeyPath","isFrozen","currentKeyPath","remainingKeyPath","isNaN","parseInt","splice","shallowClone","m","concat","flatten","a","apply","intrinsicTypeNames","split","num","t","intrinsicTypes","x","circularRefs","deepClone","any","WeakMap","innerDeepClone","toStringTag","o","iteratorSymbol","Symbol","iterator","getIteratorOf","NO_CHAR_ARRAY","getArrayOf","arrayLike","it","arguments","next","done","isAsyncFunction","debug","location","test","href","setDebug","libraryFilter","NEEDS_THROW_FOR_STACK","getErrorWithStack","prettyStack","exception","numIgnoredFrames","frame","idbDomErrorNames","errorList","defaultTexts","VersionChanged","DatabaseClosed","Abort","TransactionInactive","MissingAPI","DexieError","msg","_e","getMultiErrorMessage","failures","s","ModifyError","successCount","failedKeys","BulkError","pos","failuresByPos","_stack","errnames","BaseException","exceptions","fullName","msgOrInner","inner","Syntax","SyntaxError","Type","TypeError","Range","RangeError","exceptionMap","fullNameExceptions","nop","mirror","pureFunctionChain","f1","f2","callBoth","on1","on2","hookCreatingChain","res","onsuccess","onerror","res2","hookDeletingChain","hookUpdatingChain","modifications","reverseStoppableEventChain","promisableChain","thiz","INTERNAL","resolvedNativePromise","nativePromiseProto","resolvedGlobalPromise","globalP","resolve","subtle","nativeP","digest","nativePromiseThen","NativePromise","patchGlobalPromise","stack_being_generated","schedulePhysicalTick","physicalTick","MutationObserver","hiddenDiv","observe","attributes","asap","callback","microtickQueue","needsNewPhysicalTick","isOutsideMicroTick","unhandledErrors","rejectingErrors","currentFulfiller","rejectionMapper","globalPSD","ref","unhandleds","onunhandled","globalError","pgp","env","finalize","uh","PSD","numScheduledCalls","tickFinalizers","DexiePromise","_listeners","onuncatched","_lib","psd","_PSD","_stackHolder","_prev","_numPrev","_state","_value","handleRejection","executePromiseTask","thenProp","microTaskId","totalEchoes","onFulfilled","onRejected","possibleAwait","cleanup","decrementExpectedAwaits","reject","propagateToListener","Listener","nativeAwaitCompatibleWrap","linkToPreviousPromise","zone","promise","shouldExecuteTick","beginMicroTickScope","_then","propagateAllListeners","endMicroTickScope","ex","reason","_promise","tryCatch","origProp","some","p","addPossiblyUnhandledError","listeners","len","finalizePhysicalTick","listener","cb","callListener","ret","markErrorAsHandled","getStack","stacks","limit","errorName","failure","numPrev","wasRootExec","callbacks","unhandledErrs","finalizers","PromiseReject","wrap","errorCatcher","outerScope","switchToZone","handler","err","finally","onFinally","timeout","ms","Infinity","handle","Timeout","clearTimeout","snapShot","onPossibleParallellAsync","remaining","race","newPSD","newScope","usePSD","scheduler","follow","zoneProps","finalizer","run_at_end_of_this_or_next_physical_tick","allSettled","possiblePromises","status","AggregateError","task","awaits","echoes","taskCounter","zoneStack","zoneEchoes","zone_id_counter","a1","a2","parent","globalEnv","PromiseProp","nthen","getPatchedPromiseThen","gthen","incrementExpectedAwaits","possiblePromise","rejection","zoneEnterEcho","targetZone","zoneLeaveEcho","pop","bEnteringZone","currentZone","enqueueNativeMicroTask","GlobalPromise","targetEnv","a3","job","outerZone","origThen","onResolved","UNHANDLEDREJECTION","event","eventData","createEvent","initEvent","CustomEvent","detail","dispatchEvent","PromiseRejectionEvent","onunhandledrejection","_","defaultPrevented","console","warn","tempTransaction","mode","storeNames","idbdb","openComplete","letThrough","_vip","trans","_createTransaction","_dbSchema","PR1398_maxLoop","InvalidState","isOpen","_close","_completion","dbOpenError","isBeingOpened","_options","autoOpen","dbReadyPromise","DEXIE_VERSION","maxString","String","fromCharCode","minKey","INVALID_KEY_ARGUMENT","STRING_EXPECTED","connections","isIEOrEdge","navigator","userAgent","hasIEDeleteObjectStoreBug","hangsOnDeleteLargeKeyRange","dexieStackFrameFilter","DBNAMES_DB","READONLY","READWRITE","combine","filter1","filter2","AnyRange","lower","lowerOpen","upper","upperOpen","workaroundForUndefinedPrimKey","Table","_trans","writeLocked","_tx","tableName","checkTableInTransaction","schema","NotFound","idbtrans","transless","keyOrCrit","where","first","core","hook","reading","fire","indexOrCrit","WhereClause","keyPaths","equals","compoundIndex","indexes","primKey","ix","compound","every","_maxKey","kp","JSON","stringify","idxByName","idb","_deps","indexedDB","cmp","idx","filterFunction","prevIndex","prevFilterFn","index","multi","toCollection","and","count","thenShortcut","offset","numRows","each","Collection","orderBy","reverse","mapToClass","mappedClass","readHook","unsubscribe","defineClass","content","auto","objToAdd","mutate","numFailures","lastResult","update","keyOrObject","modify","InvalidArgument","_a","put","delete","clear","range","bulkGet","getMany","bulkAdd","objects","keysOrOptions","wantResults","allKeys","numObjects","objectsToAdd","bulkPut","objectsToPut","bulkDelete","numKeys","ctx","evs","eventName","subscriber","subscribe","addEventType","chainFunction","defaultFunction","addConfiguredEvents","context","subscribers","cfg","makeClassConstructor","isPlainKeyRange","ignoreLimitFilter","algorithm","or","justLimit","replayFilter","addFilter","addReplayFilter","factory","isLimitFilter","curr","getIndexOrStore","coreSchema","isPrimKey","primaryKey","getIndexByKeyPath","Schema","openCursor","coreTable","keysOnly","dir","unique","query","iter","coreTrans","union","cursor","advance","stop","fail","_iterate","iterate","valueMapper","cursorPromise","wrappedFn","continue","advancer","ta","tb","NaN","al","bl","compareUint8Arrays","getUint8Array","compareArrays","ArrayBuffer","isView","tsTag","buffer","byteOffset","byteLength","_read","_ctx","error","table","_write","_addAlgorithm","clone","raw","min","sortBy","parts","lastPart","lastIndex","getval","order","sorter","aVal","bVal","sort","offsetLeft","rowsLeft","until","bIncludeStopEntry","last","isMatch","indexName","_ondirectionchange","desc","eachKey","eachUniqueKey","eachPrimaryKey","primaryKeys","uniqueKeys","firstKey","lastKey","distinct","strKey","found","changes","modifyer","anythingModified","outbound","extractKey","modifyChunkSize","totalFailures","applyMutateResult","expectedCount","nextChunk","cache","addValues","putValues","putKeys","deleteKeys","origValue","criteria","deleteCallback","changeSpec","coreRange","simpleCompare","simpleCompareReverse","collectionOrWhereClause","T","collection","emptyCollection","whereClause","rangeEqual","nextCasing","lowerKey","upperNeedle","lowerNeedle","llp","lwrKeyChar","addIgnoreCaseAlgorithm","match","needles","suffix","compare","upperNeedles","lowerNeedles","direction","nextKeySuffix","needlesLen","initDirection","toUpperCase","toLowerCase","upperFactory","lowerFactory","needleBounds","needle","nb","createRange","firstPossibleNeedle","lowestPossibleCasing","casing","between","includeLower","includeUpper","_cmp","above","aboveOrEqual","below","belowOrEqual","startsWith","str","startsWithIgnoreCase","equalsIgnoreCase","anyOfIgnoreCase","startsWithAnyOfIgnoreCase","n","anyOf","_ascending","_descending","notEqual","inAnyRange","includeLowers","includeUppers","noneOf","ranges","ascending","descending","_min","max","_max","sortDirection","rangeSorter","newRange","rangePos","keyIsBeyondCurrentEntry","keyIsBeforeCurrentEntry","checkKey","keyWithinCurrentRange","startsWithAnyOf","eventRejectHandler","preventDefault","stopPropagation","DEXIE_STORAGE_MUTATED_EVENT_NAME","STORAGE_MUTATED_DOM_EVENT_NAME","globalEvents","Transaction","_lock","_reculock","lockOwnerFor","_unlock","_blockedFuncs","_locked","fnAndPSD","shift","OpenFailed","active","transaction","durability","chromeTransactionDurability","ev","_reject","onabort","on","oncomplete","_resolve","storagemutated","bWriteLock","ReadOnly","_root","waitFor","promiseLike","root","_waitingFor","_waitingQueue","store","objectStore","spin","_spinCount","currentWaitPromise","abort","memoizedTables","_memoizedTables","tableSchema","transactionBoundTable","createIndexSpec","src","nameFromKeyPath","createTableSchema","getMaxKey","IdbKeyRange","only","getKeyExtractor","getSinglePathKeyExtractor","arrayify","_id_counter","getKeyPathAlias","createDBCore","tmpTrans","makeIDBKeyRange","upperBound","lowerBound","bound","hasGetAll","tables","objectStoreNames","autoIncrement","indexByKeyPath","isPrimaryKey","indexNames","multiEntry","extractSchema","isAddOrPut","req","reqs","errorHandler","args1","args2","keyCount","callbackCount","successHandler","_pos","request","nonInfinitLimit","idbKeyRange","getAll","getAllKeys","openKeyCursor","___id","_cursorContinue","_cursorContinuePrimaryKey","continuePrimaryKey","_cursorAdvance","doThrowCursorIsStopped","gotOne","iterationPromise","resolveIteration","rejectIteration","guardedCallback","createDbCoreTable","tableMap","MIN_KEY","MAX_KEY","generateMiddlewareStacks","_novip","middlewares","IDBKeyRange","dbcore","stackImpl","down","createMiddlewareStack","createMiddlewareStacks","_middlewares","tbl","setApiOnPlace","objs","tableNames","dbschema","propDesc","enumerable","removeTablesApi","lowerVersionFirst","_cfg","runUpgraders","oldVersion","idbUpgradeTrans","globalSchema","_storeNames","rejectTransaction","createTable","populate","queue","versions","_versions","buildGlobalSchema","anyContentUpgraderHasRun","runQueue","oldSchema","newSchema","adjustToExistingIndexNames","diff","getSchemaDiff","tuple","change","recreate","Upgrade","addIndex","deleteIndex","del","idxName","contentUpgrade","upgradeSchema","contentUpgradeIsAsync","returnValue","promiseFollowed","decrementor","storeName","deleteObjectStore","deleteRemovedTables","contains","updateTablesAndIndexes","oldDef","newDef","def","oldIndexes","newIndexes","oldIdx","newIdx","createObjectStore","createIndex","j","idbindex","_hasGetAll","dexieName","indexSpec","WorkerGlobalScope","Version","_parseStoresSpec","outSchema","indexNum","trim","storesSource","storesSpec","_allTables","upgrade","upgradeFunction","getDbNamesTable","dbNamesDB","Dexie$1","addons","dbnames","hasDatabasesNative","databases","vip","idbReady","intervalId","userAgentData","tryIdb","setInterval","clearInterval","dexieOpen","state","openCanceller","throwIfCancelled","resolveDbReady","dbReadyResolve","upgradeTransaction","wasCreated","dbName","autoSchema","round","verno","onblocked","_fireOnBlocked","onupgradeneeded","allowEmptyDB","close","delreq","deleteDatabase","NoSuchDatabase","oldVer","pow","readGlobalSchema","ch","verifyInstalledSchema","onversionchange","vcFired","onclose","_onDatabaseCreated","onReadyBeingFired","ready","fireRemainders","remainders","awaitIterator","callNext","onSuccess","step","onError","throw","getNext","extractTransactionArgs","_tableArgs_","scopeFunc","enterTransactionScope","parentTransaction","scopeFuncIsAsync","PrematureCommit","pad","virtualIndexMiddleware","level","indexLookup","allVirtualIndexes","addVirtualIndexes","keyTail","lowLevelIndex","keyPathAlias","indexList","keyLength","isVirtual","virtualIndex","translateRequest","virtualCursor","createVirtualCursor","getObjectDiff","prfx","ap","bp","apTypeName","hooksMiddleware","downCore","downTable","tableMiddleware","dxTrans","deleting","creating","updating","addPutOrDelete","deleteNextChunk","deleteRange","getEffectiveKeys","effectiveKeys","getExistingValues","existingValues","contexts","existingValue","generatedPrimaryKey","objectDiff","additionalChanges","requestedValue","getFromTransactionCache","cacheExistingValuesMiddleware","cachedResult","isEmptyRange","RangeSet","fromOrTree","to","d","addRange","left","right","r","rebalance","rightWasCutOff","mergeRanges","newSet","_addRangeSet","rangesOverlap","rangeSet1","rangeSet2","i1","getRangeSetIterator","nextResult1","i2","nextResult2","keyProvided","up","_b","rootClone","oldRootRight","computeDepth","rangeSet","addKey","addKeys","observabilityMiddleware","FULL_RANGE","tableClone","mutatedParts","getRangeSet","part","pkRangeSet","delsRangeSet","newObjs","oldCache","oldObjs","addAffectedIndex","addKeyOrKeys","oldKey","newKey","trackAffectedIndexes","getRange","readSubscribers","method","subscr","queriedIndex","queriedRanges","keysPromise","resultingKeys","pKeys","wantValues","pkey","deps","dependencies","cancelOpen","bSticky","keyRangeGenerator","keyRange","whereCtx","readingHook","createTableConstructor","complete","wasActive","createTransactionConstructor","versionNumber","createVersionConstructor","orCollection","_IDBKeyRange","createWhereClauseConstructor","newVersion","use","addon","versionInstance","_whenReady","unuse","mw","hasArguments","doDelete","_onDatabaseDeleted","backendDB","hasBeenClosed","hasFailed","dynamicallyOpened","_transaction","onlyIfCompatible","idbMode","SubTransaction","enterTransaction","InvalidTable","symbolObservable","observable","Observable","_subscribe","extendObservabilitySet","liveQuery","querier","observer","closed","accumMuts","currentObs","subscription","mutationListener","querying","startedListening","shouldNotify","doQuery","exec","execute","domDeps","mozIndexedDB","webkitIndexedDB","msIndexedDB","webkitIDBKeyRange","propagateLocally","updateParts","wasMe","propagatingLocally","databaseName","exists","getDatabaseNames","infos","info","ignoreTransaction","generatorFn","spawn","currentTransaction","promiseOrFunction","optionalTimeout","delByKeyPath","semVer","maxKey","updatedParts","initCustomEvent","BroadcastChannel","bc","changedParts","postMessage","onmessage","localStorage","setItem","trig","random","matchAll","includeUncontrolled","client","parse","newValue","swContainer","serviceWorker","domError","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","definition"],"sourceRoot":""}